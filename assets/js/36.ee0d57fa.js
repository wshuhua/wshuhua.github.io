(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{489:function(e,r,t){"use strict";t.r(r);var n=t(28),s=Object(n.a)({},(function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h3",{attrs:{id:"_01-æ—§æ¶æ„-react15"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_01-æ—§æ¶æ„-react15"}},[e._v("#")]),e._v(" 01. æ—§æ¶æ„ï¼ˆreact15ï¼‰")]),e._v(" "),t("p",[e._v("React15æ¶æ„å¯ä»¥åˆ†ä¸ºä¸¤å±‚ï¼š")]),e._v(" "),t("ul",[t("li",[e._v("Reconcilerï¼ˆstack Reconciler åè°ƒå™¨ï¼‰â€”â€” è´Ÿè´£æ‰¾å‡ºå˜åŒ–çš„ç»„ä»¶")]),e._v(" "),t("li",[e._v("Rendererï¼ˆæ¸²æŸ“å™¨ï¼‰â€”â€” è´Ÿè´£å°†å˜åŒ–çš„ç»„ä»¶æ¸²æŸ“åˆ°é¡µé¢ä¸Š")])]),e._v(" "),t("p",[t("strong",[e._v("Reconciler")]),e._v("ï¼š")]),e._v(" "),t("p",[e._v("æ¯å½“æœ‰æ›´æ–°å‘ç”Ÿæ—¶ï¼ŒReconcilerä¼šåšå¦‚ä¸‹å·¥ä½œï¼š")]),e._v(" "),t("ul",[t("li",[e._v("è°ƒç”¨å‡½æ•°ç»„ä»¶ã€æˆ–classç»„ä»¶çš„renderæ–¹æ³•ï¼Œå°†è¿”å›çš„JSXè½¬åŒ–ä¸ºè™šæ‹ŸDOM")]),e._v(" "),t("li",[e._v("å°†è™šæ‹ŸDOMå’Œä¸Šæ¬¡æ›´æ–°æ—¶çš„è™šæ‹ŸDOMå¯¹æ¯”ï¼ˆé€’å½’å¤„ç†è™šæ‹ŸDOMçš„ï¼‰")]),e._v(" "),t("li",[e._v("é€šè¿‡å¯¹æ¯”æ‰¾å‡ºæœ¬æ¬¡æ›´æ–°ä¸­å˜åŒ–çš„è™šæ‹ŸDOM")]),e._v(" "),t("li",[e._v("é€šçŸ¥Rendererå°†å˜åŒ–çš„è™šæ‹ŸDOMæ¸²æŸ“åˆ°é¡µé¢ä¸Š")])]),e._v(" "),t("p",[e._v("æ¶æ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š\n"),t("img",{attrs:{src:"/images/react/react15%E6%9E%B6%E6%9E%84.png",alt:""}})]),e._v(" "),t("p",[e._v("ç¼ºé™·å‡ºç°åœ¨ stack Reconciler é€’å½’æ›´æ–°ï¼Œæ•°æ®æ”¾åœ¨é€’å½’çš„è°ƒç”¨æ ˆä¸­ï¼Œä¸€æ—¦å¼€å§‹ï¼Œæ— æ³•ç»ˆæ­¢ï¼Œç›´åˆ°éå†å®Œæ•´æ£µæ ‘ï¼Œæ‰èƒ½å°†ä¸»çº¿ç¨‹é‡Šæ”¾ã€‚\nå¦‚æœä¸»çº¿ç¨‹æœ‰ç”¨æˆ·æ“ä½œæˆ–åŠ¨ç”»æ¸²æŸ“æ“ä½œï¼Œå°±å¿…é¡»ç­‰åˆ°ä¸»çº¿ç¨‹é‡Šæ”¾ï¼Œæ‰èƒ½è¢«å“åº”ï¼Œæ— æ³•å¿«é€Ÿå“åº”ï¼Œå³å¤±å¸§ã€‚")]),e._v(" "),t("h3",{attrs:{id:"_02-æ–°æ¶æ„-react16"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_02-æ–°æ¶æ„-react16"}},[e._v("#")]),e._v(" 02. æ–°æ¶æ„ï¼ˆReact16ï¼‰")]),e._v(" "),t("p",[e._v("React16æ¶æ„å¯ä»¥åˆ†ä¸ºä¸‰å±‚ï¼š")]),e._v(" "),t("ul",[t("li",[e._v("Schedulerï¼ˆè°ƒåº¦å™¨ï¼‰â€”â€” è°ƒåº¦ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œé«˜ä¼˜ä»»åŠ¡ä¼˜å…ˆè¿›å…¥Reconciler")]),e._v(" "),t("li",[e._v("Reconcilerï¼ˆfiber Reconcileråè°ƒå™¨ï¼ŒåŸºäºfiberèŠ‚ç‚¹å®ç°çš„ï¼‰â€”â€” è´Ÿè´£æ‰¾å‡ºå˜åŒ–çš„ç»„ä»¶")]),e._v(" "),t("li",[e._v("Rendererï¼ˆæ¸²æŸ“å™¨ï¼‰â€”â€” è´Ÿè´£å°†å˜åŒ–çš„ç»„ä»¶æ¸²æŸ“åˆ°é¡µé¢ä¸Š")])]),e._v(" "),t("p",[e._v("ç›¸å¯¹æ¯”15ã€‚æ–°å¢äº†Schedulerã€‚\næˆ‘ä»¬ä»¥æµè§ˆå™¨æ˜¯å¦æœ‰å‰©ä½™æ—¶é—´ä½œä¸ºä»»åŠ¡ä¸­æ–­çš„æ ‡å‡†ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦ä¸€ç§æœºåˆ¶ï¼Œå½“æµè§ˆå™¨æœ‰å‰©ä½™æ—¶é—´æ—¶é€šçŸ¥æˆ‘ä»¬ã€‚ "),t("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestIdleCallback",target:"_blank",rel:"noopener noreferrer"}},[e._v("requestIdleCallback"),t("OutboundLink")],1),e._v("åœ¨æµè§ˆå™¨ç©ºé—²æ—¶æœŸè¢«è°ƒç”¨ã€‚ç”±äºrequestIdleCallbackå…¼å®¹æ€§é—®é¢˜å’Œè§¦å‘é¢‘ç‡é—®é¢˜ï¼Œreactæ²¡æœ‰é‡‡ç”¨ã€‚")]),e._v(" "),t("p",[e._v("åŸºäºä¸Šè¿°åŸå› ï¼ŒReactå®ç°äº†åŠŸèƒ½æ›´å®Œå¤‡çš„requestIdleCallback polyfillï¼Œå°±æ˜¯"),t("a",{attrs:{href:"https://github.com/facebook/react/tree/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/scheduler",target:"_blank",rel:"noopener noreferrer"}},[e._v("Scheduler"),t("OutboundLink")],1),e._v(",é™¤äº†åœ¨ç©ºé—²æ—¶è§¦å‘å›è°ƒå¤–ï¼ŒSchedulerè¿˜æä¾›å¤šç§è°ƒåº¦ä¼˜å…ˆçº§ä¾›ä»»åŠ¡è®¾ç½®ã€‚")]),e._v(" "),t("p",[t("strong",[e._v("Reconciler")]),e._v("ï¼š")]),e._v(" "),t("p",[e._v("æ›´æ–°å·¥ä½œä»é€’å½’å˜æˆäº†å¯ä»¥ä¸­æ–­çš„å¾ªç¯è¿‡ç¨‹ã€‚æ¯æ¬¡å¾ªç¯éƒ½ä¼šè°ƒç”¨"),t("strong",[e._v("shouldYield")]),e._v("åˆ¤æ–­å½“å‰æ˜¯å¦æœ‰å‰©ä½™æ—¶é—´ã€‚")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("/** @noinline */\nfunction workLoopConcurrent() {\n  // Perform work until Scheduler asks us to yield\n  while (workInProgress !== null && !shouldYield()) {\n    workInProgress = performUnitOfWork(workInProgress);\n  }\n}\n")])])]),t("p",[e._v("Reconcilerä¸Rendererä¸å†æ˜¯äº¤æ›¿å·¥ä½œ,å½“Schedulerå°†ä»»åŠ¡äº¤ç»™Reconcileråï¼ŒReconcilerä¼šä¸ºå˜åŒ–çš„è™šæ‹ŸDOMæ‰“ä¸Šä»£è¡¨å¢/åˆ /æ›´æ–°çš„æ ‡è®°ï¼Œç±»ä¼¼è¿™æ ·")]),e._v(" "),t("p",[e._v("æ•´ä¸ªSchedulerä¸Reconcilerçš„å·¥ä½œéƒ½åœ¨å†…å­˜ä¸­è¿›è¡Œã€‚åªæœ‰å½“æ‰€æœ‰ç»„ä»¶éƒ½å®ŒæˆReconcilerçš„å·¥ä½œï¼Œæ‰ä¼šç»Ÿä¸€äº¤ç»™Rendererã€‚")]),e._v(" "),t("p",[e._v("æ¶æ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š\n"),t("img",{attrs:{src:"/images/react/react16%E6%9E%B6%E6%9E%84.png",alt:""}})]),e._v(" "),t("h3",{attrs:{id:"_03-fiberæ¶æ„çš„å¿ƒæ™ºæ¨¡å‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_03-fiberæ¶æ„çš„å¿ƒæ™ºæ¨¡å‹"}},[e._v("#")]),e._v(" 03. fiberæ¶æ„çš„å¿ƒæ™ºæ¨¡å‹")]),e._v(" "),t("p",[e._v("ç¥é©¬æ˜¯å¿ƒæ™ºæ¨¡å‹ï¼Ÿ")]),e._v(" "),t("p",[e._v("å®˜æ–¹ç®€å•ç†è§£å°±æ˜¯ï¼šå®ƒæ˜¯äººã€ä¸»è§‚ã€‘è®¤è¯†äº‹ç‰©çš„æ–¹æ³•å’Œä¹ æƒ¯ï¼Œæ˜¯éšè—åœ¨ä½ ä¸€åˆ‡è¡Œä¸ºæ–¹å¼ã€æ€è€ƒæ–¹å¼èƒŒåçš„é‚£äº›å½¢å¼å’Œè§„å¾‹ã€‚")]),e._v(" "),t("p",[t("img",{attrs:{src:"/images/react/%E6%A8%A1%E5%9E%8B.png",alt:""}})]),e._v(" "),t("h3",{attrs:{id:"_04-fiberæ¶æ„çš„å®ç°åŸç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_04-fiberæ¶æ„çš„å®ç°åŸç†"}},[e._v("#")]),e._v(" 04. fiberæ¶æ„çš„å®ç°åŸç†")]),e._v(" "),t("ul",[t("li",[e._v("fiberçš„ç»“æ„")])]),e._v(" "),t("p",[e._v("react/packages/react-reconciler/src/ReactFiber.new.js")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("function FiberNode(\n  tag: WorkTag,\n  pendingProps: mixed,\n  key: null | string,\n  mode: TypeOfMode,\n){\n  // ä½œä¸ºé™æ€æ•°æ®ç»“æ„çš„å±æ€§\n  this.tag = tag; // ç»„ä»¶ç±»å‹ï¼Œ\n  this.key = key;\n  this.elementType = null;\n  this.type = null;\n  this.stateNode = null; //çœŸå®domèŠ‚ç‚¹\n\n  // ä½œä¸ºè¿æ¥å…¶ä»–FiberèŠ‚ç‚¹å½¢æˆFiberæ ‘\n  this.return = null;\n  this.child = null;\n  this.sibling = null;\n  this.index = 0; // å¯¹äºåŒçº§èŠ‚ç‚¹ï¼Œä»£è¡¨ä»–ä»¬æ’å…¥çš„ä½ç½®ç´¢å¼•\n\n  this.ref = null;\n   \n  // ä½œä¸ºåŠ¨æ€çš„å·¥ä½œå•å…ƒçš„å±æ€§\n  this.pendingProps = pendingProps;\n  this.memoizedProps = null;\n  this.updateQueue = null;\n  this.memoizedState = null;\n  this.dependencies = null;\n\n  this.mode = mode;\n\n  this.effectTag = NoEffect;\n  this.subtreeTag = NoSubtreeEffect;\n  this.deletions = null;\n  this.nextEffect = null;\n\n  this.firstEffect = null;\n  this.lastEffect = null;\n  \n  // è°ƒåº¦ä¼˜å…ˆçº§ç›¸å…³\n  this.lanes = NoLanes;\n  this.childLanes = NoLanes;\n\n  // æŒ‡å‘è¯¥Fiberåœ¨å¦ä¸€æ¬¡æ›´æ–°æ—¶å¯¹åº”çš„Fiber\n  this.alternate = null;  // fiber æ¶æ„çš„å·¥ä½œæ–¹å¼\n  ...\n}\n")])])]),t("ul",[t("li",[e._v("ä½œä¸ºæ¶æ„æ¥è¯´")])]),e._v(" "),t("p",[e._v("æ¯ä¸ªfiber èŠ‚ç‚¹æœ‰ä¸ªå¯¹åº”çš„React Elementï¼Œå¤šä¸ªfiber èŠ‚ç‚¹ä¾èµ–ä¸‹é¢ä¸‰ä¸ªå±æ€§è¿æ¥ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("this.return = null;  // æŒ‡å‘çˆ¶çº§FiberèŠ‚ç‚¹\n\nthis.child = null; // æŒ‡å‘å­FiberèŠ‚ç‚¹\n\nthis.sibling = null; // æŒ‡å‘å³è¾¹ç¬¬ä¸€ä¸ªå…„å¼ŸFiberèŠ‚ç‚¹\n")])])]),t("p",[e._v("ä¸¾ä¾‹è¯´æ˜ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("function App() {\n  return (\n    <div>\n      wsh\n      <span>age: 18</span>\n    </div>\n  )\n}\n")])])]),t("p",[e._v("å¯¹åº”çš„fiberæ ‘å¦‚ä¸‹ï¼š")]),e._v(" "),t("ul",[t("li",[e._v("ä½œä¸ºé™æ€æ•°æ®ç»“æ„ï¼š")])]),e._v(" "),t("p",[e._v("ä½œä¸ºé™æ€çš„æ•°æ®ç»“æ„ï¼Œä¿å­˜äº†ç»„ä»¶ç›¸å…³ä¿¡æ¯")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("this.tag = tag; // Fiberå¯¹åº”ç»„ä»¶çš„ç±»å‹ Function/Class/Host...\n\nthis.key = key; // keyå±æ€§\n\nthis.elementType = null; // å¤§éƒ¨åˆ†æƒ…å†µåŒtypeï¼ŒæŸäº›æƒ…å†µä¸åŒï¼Œæ¯”å¦‚FunctionComponentä½¿ç”¨React.memoåŒ…è£¹\n\nthis.type = null; // å¯¹äº FunctionComponentï¼ŒæŒ‡å‡½æ•°æœ¬èº«ï¼Œå¯¹äºClassComponentï¼ŒæŒ‡classï¼Œå¯¹äºHostComponentï¼ŒæŒ‡DOMèŠ‚ç‚¹tagName\n\nthis.stateNode = null; // Fiberå¯¹åº”çš„çœŸå®DOMèŠ‚ç‚¹\n")])])]),t("ul",[t("li",[e._v("ä½œä¸ºåŠ¨æ€çš„å·¥ä½œå•å…ƒ:")])]),e._v(" "),t("p",[e._v("ä½œä¸ºåŠ¨æ€çš„å·¥ä½œå•å…ƒï¼ŒFiberä¸­ä¸‹é¢å‚æ•°ä¿å­˜äº†æœ¬æ¬¡æ›´æ–°ç›¸å…³çš„ä¿¡æ¯")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("// ä¿å­˜æœ¬æ¬¡æ›´æ–°é€ æˆçš„çŠ¶æ€å˜åŒ–ç›¸å…³ä¿¡æ¯\nthis.pendingProps = pendingProps;\nthis.menoizedProps = null;\nthis.updateQueue = null;\nthis.memoizedState = null;\nthis.dependencies = null;\n\nthis.mode = mode;\n\n// ä¿å­˜æœ¬æ¬¡æ›´æ–°ä¼šé€ æˆçš„DOMæ“ä½œ\nthis.effectTag = NoEffect;\nthis.nextEffect = null;\n\nthis.firstEffect = null;\nthis.lastEffect = null;\n")])])]),t("p",[e._v("ä¿å­˜è°ƒåº¦ä¼˜å…ˆçº§å­—æ®µåœ¨å¦‚ä¸‹å­—æ®µï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("// è°ƒåº¦ä¼˜å…ˆçº§ç›¸å…³\nthis.lanes = NoLanes;\nthis.childLanes = NoLanes;\n")])])]),t("h4",{attrs:{id:"expirationtime-lanes-ä¼˜å…ˆçº§å¯¹æ¯”pr"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#expirationtime-lanes-ä¼˜å…ˆçº§å¯¹æ¯”pr"}},[e._v("#")]),e._v(" expirationTime/ lanes ä¼˜å…ˆçº§å¯¹æ¯”"),t("a",{attrs:{href:"https://github.com/facebook/react/pull/18796",target:"_blank",rel:"noopener noreferrer"}},[e._v("PR"),t("OutboundLink")],1),e._v("ï¼š")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("Lanes æ¨¡å‹ä¸ Expiration Times æ¨¡å‹ç›¸æ¯”æœ‰ä¸¤ä¸ªä¸»è¦ä¼˜ç‚¹")]),e._v(" "),t("ul",[t("li",[e._v("Laneså°†ä»»åŠ¡ä¼˜å…ˆçº§çš„æ¦‚å¿µï¼ˆä»»åŠ¡ A çš„ä¼˜å…ˆçº§æ˜¯å¦é«˜äºä»»åŠ¡ Bï¼‰ä¸ä»»åŠ¡æ‰¹å¤„ç†ï¼ˆä»»åŠ¡Aæ˜¯è¿™ç»„ä»»åŠ¡çš„ä¸€éƒ¨åˆ†å—ï¼Ÿï¼‰è§£è€¦")]),e._v(" "),t("li",[e._v("Lanes å¯ä»¥ç”¨å•ä¸€çš„ 32 ä½æ•°æ®ç±»å‹è¡¨ç¤ºè®¸å¤šä¸åŒçš„ä»»åŠ¡çº¿ç¨‹ã€‚")])])])]),e._v(" "),t("p",[e._v("åœ¨æ—§æ¨¡å‹ä¸­ï¼Œä¸ºäº†å†³å®šæ˜¯å¦åœ¨æ­£åœ¨å¤„ç†çš„æ‰¹å¤„ç†ä¸­åŒ…å«ç»™å®šçš„å·¥ä½œå•å…ƒï¼Œæˆ‘ä»¬å°†æ¯”è¾ƒå®ƒä»¬çš„ç›¸å¯¹ä¼˜å…ˆçº§ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("const isTaskIncludedInBatch = priorityOfTask >= priorityOfBatch;\n")])])]),t("p",[e._v("è¿™æ˜¯å› ä¸ºreactæ–½åŠ äº†ä¸€ä¸ªçº¦æŸï¼Œå³é™¤éè¿˜åŒ…æ‹¬æ›´é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œå¦åˆ™ä¸å…è®¸å®Œæˆè¾ƒä½ä¼˜å…ˆçº§çš„ä»»åŠ¡ã€‚ç»™å®šä¼˜å…ˆçº§ A > B > Cï¼Œå¦‚æœä¸å¤„ç† Aï¼Œå°±æ— æ³•å¤„ç†Bï¼›å¦‚æœä¸å¤„ç†å®Œæˆ B å’Œ Aï¼Œä½ ä¹Ÿä¸èƒ½å¤„ç† Cã€‚\nè¿™ä¸ªçº¦æŸæ˜¯åœ¨Suspenseå‡ºç°ä¹‹å‰è®¾è®¡çš„ï¼Œè¿™ä¸ªåœ¨å½“æ—¶æ˜¯æœ‰æ„ä¹‰çš„ï¼ˆå…·ä½“ä»€ä¹ˆæ„ä¹‰ï¼Œæˆ‘å°±ä¸æ·±ç©¶äº†ï¼Œ ğŸ˜ï¼‰ã€‚å½“æˆ‘ä»¬çš„æ‰€æœ‰å·¥ä½œéƒ½å— CPU é™åˆ¶æ—¶ï¼Œé™¤äº†æŒ‰ä¼˜å…ˆçº§ä¹‹å¤–ï¼Œæ²’æœ‰å¤ªå¤šç†ç”±æŒ‰ä»»ä½•é¡ºåºå¤„ç†ä»»åŠ¡ã€‚ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬å¼•å…¥ IO å¯†é›†å‹ä»»åŠ¡ï¼ˆå³ Suspenseï¼‰æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°è¾ƒé«˜ä¼˜å…ˆçº§ IO å¯†é›†å‹ä»»åŠ¡é˜»æ­¢è¾ƒä½ä¼˜å…ˆçº§ CPU å¯†é›†å‹ä»»åŠ¡å®Œæˆçš„æƒ…å†µã€‚")]),e._v(" "),t("p",[e._v("Expiration Times çš„ä¸€ä¸ªç±»ä¼¼ç¼ºé™·é™åˆ¶äº†æˆ‘ä»¬å¦‚ä½•è¡¨è¾¾ä¸€ç»„å¤šä¸ªä¼˜å…ˆçº§ã€‚")]),e._v(" "),t("p",[e._v("å°±å†…å­˜æˆ–è®¡ç®—è€Œè¨€ï¼Œä½¿ç”¨ Set å¯¹è±¡æ˜¯ä¸åˆ‡å®é™…çš„ã€‚æˆ‘ä»¬æ­£åœ¨å¤„ç†çš„å­˜åœ¨æ€§æ£€æŸ¥éå¸¸æ™®éï¼Œå› æ­¤å®ƒä»¬éœ€è¦å¿«é€Ÿå¹¶ä½¿ç”¨å°½å¯èƒ½å°‘çš„å†…å­˜ã€‚\nä½œä¸ºå¦¥åï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåšçš„æ˜¯ç»´æŒä¸€ç³»åˆ—ä¼˜å…ˆçº§ã€‚")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("const isTaskIncludedInBatch = taskPriority <= highestPriorityInRange && taskPriority >= lowestPriorityInRange;\n")])])]),t("p",[e._v("æ—§æ¨¡å‹å°† ä¼˜å…ˆçº§å’Œ æ‰¹å¤„ç†è¿™ä¸¤ä¸ªæ¦‚å¿µè€¦åˆåˆ°ä¸€ä¸ªå•ä¸€çš„æ•°æ®ç±»å‹ä¸­ã€‚ æˆ‘ä»¬è¡¨è¾¾å…¶ä¸­ä¸€ä¸ªçš„èƒ½åŠ›æ˜¯æœ‰é™çš„ï¼Œé™¤éç”¨å½±å“å¦ä¸€ä¸ªçš„æœ¯è¯­ã€‚\nåœ¨æ–°æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬å°†è¿™ä¸¤ä¸ªæ¦‚å¿µè§£è€¦ã€‚ ç›¸åï¼Œä»»åŠ¡ç»„ä¸æ˜¯ç”¨ç›¸å¯¹æ•°å­—è¡¨ç¤ºï¼Œè€Œæ˜¯ç”¨ä½æ©ç è¡¨ç¤ºï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("const isTaskIncludedInBatch = (task & batchOfTasks) !== 0;\n")])])]),t("ul",[t("li",[e._v("è¡¨ç¤ºä»»åŠ¡çš„ä½æ©ç ç±»å‹ç§°ä¸º Lane")]),e._v(" "),t("li",[e._v("è¡¨ç¤ºæ‰¹æ¬¡çš„ä½æ©ç ç±»å‹ç§°ä¸º Lanes")])]),e._v(" "),t("p",[e._v("åœ¨æ›´å…·ä½“çš„ React æœ¯è¯­ä¸­ï¼Œç”± setState è°ƒåº¦çš„æ›´æ–°å¯¹è±¡åŒ…å«ä¸€ä¸ªé€šé“å­—æ®µï¼Œä¸€ä¸ªå¯ç”¨å•ä¸ªä½çš„ä½æ©ç ã€‚ è¿™å°†æ›¿æ¢æ—§æ¨¡å‹ä¸­çš„ update.expirationTime å­—æ®µã€‚\nå¦ä¸€æ–¹é¢ï¼Œä¸€ä¸ªfiber ä¸ä»…ä»…ä¸å•ä¸ªæ›´æ–°ç›¸å…³è”ï¼Œè€Œæ˜¯å¯èƒ½ä¸å¤šä¸ªæ›´æ–°ç›¸å…³è”ã€‚ æ‰€ä»¥å®ƒæœ‰ä¸€ä¸ª lanes å­—æ®µï¼Œä¸€ä¸ªå¯ç”¨äº†é›¶ä¸ªæˆ–å¤šä¸ªä½çš„ä½æ©ç ï¼ˆæ—§æ¨¡å‹ä¸­çš„ fiber.expirationTimeï¼‰ï¼› å’Œä¸€ä¸ª childLanes å­—æ®µ (fiber.childExpirationTime)ã€‚å¯ç”¨é›¶ä¸ªæˆ–å¤šä¸ªä½ï¼ˆæ—§æ¨¡å‹ä¸­çš„ fiber.expirationTimeï¼‰å’Œä¸€ä¸ª childLanes å­—æ®µ (fiber.childExpirationTime)ã€‚")]),e._v(" "),t("p",[e._v("Lanesæ˜¯ä¸€ç§ä¸é€æ˜çš„ç±»å‹ã€‚ åªèƒ½åœ¨ ReactFiberLane æ¨¡å—å†…æ‰§è¡Œç›´æ¥ä½æ©ç æ“ä½œã€‚ åœ¨å…¶ä»–åœ°æ–¹ï¼Œå¿…é¡»ä»è¯¥æ¨¡å—å¯¼å…¥ä¸€ä¸ªè¾…åŠ©å‡½æ•°ã€‚ è¿™æ˜¯ä¸€ä¸ªæŠ˜è¡·ï¼Œä½†æˆ‘è®¤ä¸ºæœ€ç»ˆæ˜¯å€¼å¾—çš„ï¼Œå› ä¸ºå¤„ç†Laneså¯èƒ½éå¸¸å¾®å¦™ï¼Œå¹¶ä¸”å°†æ‰€æœ‰é€»è¾‘æ”¾åœ¨ä¸€èµ·å°†ä½¿æˆ‘ä»¬æ›´å®¹æ˜“è°ƒæ•´æˆ‘ä»¬çš„å¯å‘å¼ç®—æ³•ï¼Œè€Œæ— éœ€æ¯æ¬¡è¿›è¡Œå¤§é‡é‡æ„ï¼ˆåƒè¿™æ ·ï¼‰ã€‚")]),e._v(" "),t("p",[e._v("å¸¸è§çš„ Expiration Time å­—æ®µï¼Œè½¬åŒ–ä¸º Lanes")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("renderExpirationtime -> renderLanes\nupdate.expirationTime -> update.lane\nfiber.expirationTime -> fiber.lanes\nfiber.childExpirationTime -> fiber.childLanes\nroot.firstPendingTime and root.lastPendingTime -> fiber.pendingLanes\n")])])]),t("h3",{attrs:{id:"_05-fiberæ¶æ„çš„å·¥ä½œåŸç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_05-fiberæ¶æ„çš„å·¥ä½œåŸç†"}},[e._v("#")]),e._v(" 05. fiberæ¶æ„çš„å·¥ä½œåŸç†")]),e._v(" "),t("h4",{attrs:{id:"ä»€ä¹ˆæ˜¯åŒç¼“å­˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä»€ä¹ˆæ˜¯åŒç¼“å­˜"}},[e._v("#")]),e._v(" ä»€ä¹ˆæ˜¯åŒç¼“å­˜ï¼Ÿ")]),e._v(" "),t("p",[e._v("é€šä¿—æ¥è¯´ï¼Œå½“æˆ‘ä»¬ç”¨canvasç»˜åˆ¶åŠ¨ç”»ï¼Œæ¯ä¸€å¸§ç»˜åˆ¶å‰éƒ½ä¼šè°ƒç”¨ctx.clearRectæ¸…é™¤ä¸Šä¸€å¸§çš„ç”»é¢ã€‚å¦‚æœå½“å‰å¸§ç”»é¢è®¡ç®—é‡æ¯”è¾ƒå¤§ï¼Œå¯¼è‡´æ¸…é™¤ä¸Šä¸€å¸§ç”»é¢åˆ°ç»˜åˆ¶å½“å‰å¸§ç”»é¢ä¹‹é—´æœ‰è¾ƒé•¿é—´éš™ï¼Œå°±ä¼šå‡ºç°ç™½å±ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å†…å­˜ä¸­ç»˜åˆ¶å½“å‰å¸§åŠ¨ç”»ï¼Œç»˜åˆ¶å®Œæ¯•åç›´æ¥ç”¨å½“å‰å¸§æ›¿æ¢ä¸Šä¸€å¸§ç”»é¢ï¼Œç”±äºçœå»äº†ä¸¤å¸§æ›¿æ¢é—´çš„è®¡ç®—æ—¶é—´ï¼Œä¸ä¼šå‡ºç°ä»ç™½å±åˆ°å‡ºç°ç”»é¢çš„é—ªçƒæƒ…å†µã€‚")]),e._v(" "),t("p",[e._v("è¿™ç§åœ¨å†…å­˜ä¸­æ„å»ºå¹¶ç›´æ¥æ›¿æ¢çš„æŠ€æœ¯å«åšåŒç¼“å­˜ã€‚")]),e._v(" "),t("p",[e._v("Reactä½¿ç”¨â€œåŒç¼“å­˜â€æ¥å®ŒæˆFiberæ ‘çš„æ„å»ºä¸æ›¿æ¢â€”â€”å¯¹åº”ç€DOMæ ‘çš„åˆ›å»ºä¸æ›´æ–°ã€‚")]),e._v(" "),t("h4",{attrs:{id:"åŒç¼“å­˜fiberæ ‘"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åŒç¼“å­˜fiberæ ‘"}},[e._v("#")]),e._v(" åŒç¼“å­˜Fiberæ ‘")]),e._v(" "),t("p",[e._v("åœ¨Reactä¸­æœ€å¤šä¼šåŒæ—¶å­˜åœ¨ä¸¤æ£µFiberæ ‘ã€‚")]),e._v(" "),t("ul",[t("li",[e._v("å½“å‰å±å¹•ä¸Šæ˜¾ç¤ºå†…å®¹å¯¹åº”çš„Fiberæ ‘ç§°ä¸º"),t("strong",[e._v("current Fiber")]),e._v(">æ ‘")]),e._v(" "),t("li",[e._v("æ­£åœ¨å†…å­˜ä¸­æ„å»ºçš„Fiberæ ‘ç§°ä¸º"),t("strong",[e._v("workInProgress Fiber")]),e._v("æ ‘")])]),e._v(" "),t("p",[e._v("current Fiberæ ‘ä¸­çš„FiberèŠ‚ç‚¹è¢«ç§°ä¸ºcurrent fiberï¼ŒworkInProgress Fiberæ ‘ä¸­çš„FiberèŠ‚ç‚¹è¢«ç§°ä¸ºworkInProgress fiberï¼Œä»–ä»¬é€šè¿‡alternateå±æ€§è¿æ¥ã€‚")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("currentFiber.alternate === workInProgressFiber;\nworkInProgressFiber.alternate === currentFiber;\n")])])]),t("p",[e._v("Reactåº”ç”¨çš„æ ¹èŠ‚ç‚¹"),t("strong",[e._v("fiber Node")]),e._v("é€šè¿‡ä½¿currentæŒ‡é’ˆåœ¨ä¸åŒFiberæ ‘çš„rootFiberé—´åˆ‡æ¢æ¥å®Œæˆcurrent Fiberæ ‘æŒ‡å‘çš„åˆ‡æ¢ã€‚")]),e._v(" "),t("p",[t("strong",[e._v("åˆ‡æ¢æ—¶æœº")]),e._v("ï¼šå³å½“workInProgress Fiberæ ‘æ„å»ºå®Œæˆäº¤ç»™Rendereræ¸²æŸ“åœ¨é¡µé¢ä¸Šåï¼Œåº”ç”¨æ ¹èŠ‚ç‚¹çš„currentæŒ‡é’ˆæŒ‡å‘workInProgress Fiberæ ‘ï¼Œæ­¤æ—¶workInProgress Fiberæ ‘å°±å˜ä¸ºcurrent Fiberæ ‘ã€‚")]),e._v(" "),t("p",[e._v("æ¯æ¬¡çŠ¶æ€æ›´æ–°éƒ½ä¼šäº§ç”Ÿæ–°çš„workInProgress Fiberæ ‘ï¼Œé€šè¿‡currentä¸workInProgressçš„æ›¿æ¢ï¼Œå®ŒæˆDOMæ›´æ–°ã€‚")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("function App() {\n  const [num, add] = useState(0);\n  return (\n    <p onClick={() => add(num + 1)}>{num}</p>\n  )\n}\n\nReactDOM.render(<App/>, document.getElementById('root'));\n")])])]),t("p",[e._v("é¦–æ¬¡æ¸²æŸ“æ—¶ï¼š")]),e._v(" "),t("ol",[t("li",[e._v("fiberRootNodeçš„currentä¼šæŒ‡å‘å½“å‰é¡µé¢ä¸Šå·²æ¸²æŸ“å†…å®¹å¯¹åº”Fiberæ ‘ï¼Œå³current Fiberæ ‘ã€‚")]),e._v(" "),t("li",[e._v("æ¥ä¸‹æ¥è¿›å…¥renderé˜¶æ®µï¼Œæ ¹æ®ç»„ä»¶è¿”å›çš„JSXåœ¨å†…å­˜ä¸­ä¾æ¬¡åˆ›å»ºFiberèŠ‚ç‚¹å¹¶è¿æ¥åœ¨ä¸€èµ·æ„å»ºFiberæ ‘ï¼Œè¢«ç§°ä¸ºworkInProgress Fiberæ ‘ã€‚ï¼ˆä¸‹å›¾ä¸­å³ä¾§ä¸ºå†…å­˜ä¸­æ„å»ºçš„æ ‘ï¼Œå·¦ä¾§ä¸ºé¡µé¢æ˜¾ç¤ºçš„æ ‘ï¼‰")]),e._v(" "),t("li",[e._v("å›¾ä¸­å³ä¾§å·²æ„å»ºå®Œçš„workInProgress Fiberæ ‘åœ¨commité˜¶æ®µæ¸²æŸ“åˆ°é¡µé¢ã€‚\næ­¤æ—¶DOMæ›´æ–°ä¸ºå³ä¾§æ ‘å¯¹åº”çš„æ ·å­ã€‚fiberRootNodeçš„currentæŒ‡é’ˆæŒ‡å‘workInProgress Fiberæ ‘ä½¿å…¶å˜ä¸ºcurrent Fiber æ ‘")])]),e._v(" "),t("p",[t("img",{attrs:{src:"/images/react/%E6%96%B0%E5%BB%BA.png",alt:""}})]),e._v(" "),t("p",[e._v("æ›´æ–°æ—¶ï¼š")]),e._v(" "),t("ol",[t("li",[e._v("æ¥ä¸‹æ¥æˆ‘ä»¬ç‚¹å‡»pèŠ‚ç‚¹è§¦å‘çŠ¶æ€æ”¹å˜ï¼Œè¿™ä¼šå¼€å¯ä¸€æ¬¡æ–°çš„renderé˜¶æ®µå¹¶æ„å»ºä¸€æ£µæ–°çš„workInProgress Fiber æ ‘")]),e._v(" "),t("li",[e._v("workInProgress Fiber æ ‘åœ¨renderé˜¶æ®µå®Œæˆæ„å»ºåè¿›å…¥commité˜¶æ®µæ¸²æŸ“åˆ°é¡µé¢ä¸Šã€‚æ¸²æŸ“å®Œæ¯•åï¼ŒworkInProgress Fiber æ ‘å˜ä¸ºcurrent Fiber æ ‘ã€‚\n"),t("img",{attrs:{src:"/images/react/%E6%9B%B4%E6%96%B0.png",alt:""}})])]),e._v(" "),t("h4",{attrs:{id:"jsx-ä¸fiber-å…³ç³»"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jsx-ä¸fiber-å…³ç³»"}},[e._v("#")]),e._v(" jsx ä¸fiber å…³ç³»")]),e._v(" "),t("p",[e._v("jsxæ˜¯ä¸€ç§æè¿°å½“å‰ç»„ä»¶å†…å®¹çš„æ•°æ®ç»“æ„ï¼Œä¸åŒ…å«scheduleï¼Œreconclieï¼Œrenderæ‰€éœ€çš„ç›¸å…³ä¿¡æ¯")]),e._v(" "),t("p",[e._v("åœ¨æ–°å»ºæ—¶ï¼ŒReconcileræ ¹æ®JSXæè¿°çš„ç»„ä»¶å†…å®¹ç”Ÿæˆç»„ä»¶å¯¹åº”çš„FiberèŠ‚ç‚¹ã€‚\nå†æ›´æ–°æ—¶ï¼ŒReconclier å°†jsx æ•°æ®ä¸Fibler èŠ‚ç‚¹ä¿å­˜çš„æ•°æ®å¯¹æ¯”ï¼Œç”Ÿæˆå¯¹åº”çš„workInProgress fiberã€‚")])])}),[],!1,null,null,null);r.default=s.exports}}]);