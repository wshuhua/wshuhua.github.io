(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{480:function(e,n,t){"use strict";t.r(n);var a=t(28),r=Object(a.a)({},(function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("p",[e._v("æœ‰å¼‚æ­¥I/Oï¼Œå¿…æœ‰å¼‚æ­¥ç¼–ç¨‹ã€‚")]),e._v(" "),t("h3",{attrs:{id:"å‡½æ•°å¼ç¼–ç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‡½æ•°å¼ç¼–ç¨‹"}},[e._v("#")]),e._v(" å‡½æ•°å¼ç¼–ç¨‹")]),e._v(" "),t("h4",{attrs:{id:"é«˜é˜¶å‡½æ•°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é«˜é˜¶å‡½æ•°"}},[e._v("#")]),e._v(" é«˜é˜¶å‡½æ•°")]),e._v(" "),t("p",[e._v("é«˜é˜¶å‡½æ•°å¯ä»¥å°†å‡½æ•°ä½œä¸ºå‚æ•°æˆ–è€…å°†å‡½æ•°ä½œä¸ºè¿”å›å€¼çš„å‡½æ•°ã€‚")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("function foo(x) {\n  return function () {\n    return x;\n  };\n} \n")])])]),t("p",[e._v("é€šè¿‡æ”¹åŠ¨sort()æ–¹æ³•çš„å‚æ•°ï¼Œå¯ä»¥å†³å®šä¸åŒçš„æ’åºæ–¹å¼ã€‚")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("var points = [40, 100, 1, 5, 25, 10];\npoints.sort(function(a, b) {\n return a - b;\n});\n// [ 1, 5, 10, 25, 40, 100 ] \n")])])]),t("p",[e._v("åœ¨Nodeä¸­ï¼Œäº‹ä»¶çš„å¤„ç†æ–¹å¼æ˜¯åŸºäºé«˜é˜¶å‡½æ•°çš„ç‰¹æ•ˆæ¥å®Œæˆçš„ã€‚åœ¨è‡ªå®šä¹‰äº‹ä»¶å®ä¾‹ä¸­ï¼Œé€šè¿‡ä¸ºç›¸åŒäº‹ä»¶æ³¨å†Œä¸åŒçš„å›è°ƒå‡½æ•°ï¼Œå¯ä»¥å¾ˆçµæ´»çš„å¤„ç†ä¸šåŠ¡é€»è¾‘ã€‚")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("var emitter = new events.EventEmitter();\nemitter.on('event_foo', function () {\n // TODO\n}); \n")])])]),t("h4",{attrs:{id:"åå‡½æ•°ç”¨æ³•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åå‡½æ•°ç”¨æ³•"}},[e._v("#")]),e._v(" åå‡½æ•°ç”¨æ³•")]),e._v(" "),t("p",[e._v("åå‡½æ•°ç”¨æ³•æ˜¯æŒ‡åˆ›å»ºä¸€ä¸ªè°ƒç”¨å¦å¤–ä¸€ä¸ªéƒ¨åˆ†-å‚æ•°æˆ–å˜é‡å·²ç»é¢„ç½®çš„å‡½æ•°ã€‚")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("var toString = Object.prototype.toString;\n\nvar isString = function (obj) {\n return toString.call(obj) == '[object String]';\n};\nvar isFunction = function (obj) {\n return toString.call(obj) == '[object Function]';\n};\n")])])]),t("p",[e._v("åœ¨JavaScriptä¸­è¿›è¡Œç±»å‹åˆ¤æ–­æ—¶ï¼Œé€šè¿‡ç±»ä¼¼ä¸ä¸Šè¿°ä»£ç çš„æ–¹æ³•å®šä¹‰ã€‚é‡Œé¢éœ€è¦æˆ‘ä»¬é‡å¤å»å®šä¹‰ä¸€äº›ç±»ä¼¼çš„å‡½æ•°ã€‚ä¸ºäº†è§£å†³é‡å¤å®šä¹‰çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªæ–°å‡½æ•°ï¼Œè¿™ä¸ªæ–°å‡½æ•°å¯ä»¥åƒå·¥å‚ä¸€æ ·æ‰¹é‡åˆ›å»ºä¸€äº›ç±»ä¼¼çš„å‡½æ•°ã€‚\nä¾‹å¦‚ï¼šé€šè¿‡isType()é¢„å…ˆæŒ‡å®štypeçš„å€¼ï¼Œç„¶åè¿”å›æ–°çš„å‡½æ•°ã€‚è¿™ç§é€šè¿‡æŒ‡å®šéƒ¨åˆ†å‚æ•°æ¥äº§ç”Ÿä¸€ä¸ªæ–°çš„å®šåˆ¶å‡½æ•°çš„å½¢å¼å°±æ˜¯ "),t("code",[e._v("åå‡½æ•°")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("var isType = function (type) {\n return function (obj) {\n return toString.call(obj) == '[object ' + type + ']';\n };\n};\nvar isString = isType('String');\nvar isFunction = isType('Function'); \n")])])]),t("h3",{attrs:{id:"å¼‚æ­¥ç¼–ç¨‹çš„ä¼˜åŠ¿ä¸éš¾ç‚¹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¼‚æ­¥ç¼–ç¨‹çš„ä¼˜åŠ¿ä¸éš¾ç‚¹"}},[e._v("#")]),e._v(" å¼‚æ­¥ç¼–ç¨‹çš„ä¼˜åŠ¿ä¸éš¾ç‚¹")]),e._v(" "),t("p",[e._v("Nodeåˆ©ç”¨JavaScriptä»¥åŠå†…éƒ¨å¼‚æ­¥åº“ï¼Œå°†å¼‚æ­¥ç›´æ¥æå‡åˆ°ä¸šåŠ¡å±‚é¢ã€‚")]),e._v(" "),t("h4",{attrs:{id:"ä¼˜åŠ¿"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¼˜åŠ¿"}},[e._v("#")]),e._v(" ä¼˜åŠ¿")]),e._v(" "),t("p",[e._v("Nodeå¸¦æ¥çš„æœ€å¤§ç‰¹æ€§ï¼šåŸºäºäº‹ä»¶é©±åŠ¨çš„éé˜»å¡I/Oæ¨¡å‹ã€‚éé˜»å¡I/Oä½¿CPUä¸I/Oäº’ä¸ä¾èµ–ç­‰å¾…ï¼Œè®©èµ„æºå¯ä»¥å¾—åˆ°æ›´å¥½çš„åˆ©ç”¨ã€‚")]),e._v(" "),t("p",[e._v("å¼‚æ­¥I/Oè°ƒç”¨ï¼š")]),e._v(" "),t("p",[t("img",{attrs:{src:"/images/node/%E5%BC%82%E6%AD%A5IO%E8%B0%83%E7%94%A8.png",alt:""}})]),e._v(" "),t("p",[e._v("ä¼ ç»ŸåŒæ­¥I/Oæ¨¡å‹ï¼š\n"),t("img",{attrs:{src:"/images/node/%E5%90%8C%E6%AD%A5IO%E7%A4%BA%E6%84%8F.png",alt:""}})]),e._v(" "),t("p",[e._v("Nodeå®ç°å¼‚æ­¥I/OåŸç†ï¼šåˆ©ç”¨äº‹ä»¶å¾ªç¯çš„æ–¹å¼ï¼ŒJavaScriptçº¿ç¨‹åƒä¸€ä¸ªåˆ†é…ä»»åŠ¡å’Œå¤„ç†ç»“æœçš„å¤§ç®¡å®¶ï¼ŒI/Oçº¿ç¨‹æ± é‡Œé¢çš„å„ä¸ªI/Oçº¿ç¨‹éƒ½æ˜¯å°äºŒã€‚è´Ÿè´£å®Œæˆåˆ†é…æ¥çš„ä»»åŠ¡ï¼Œå°äºŒä¸ç®¡ç†äº’ä¸å…³è”ï¼Œæ‰€ä»¥å¯ä»¥ä¿æŒæ•´ä½“çš„é«˜æ•ˆç‡ã€‚")]),e._v(" "),t("p",[e._v("ç”±äºäº‹ä»¶å¾ªç¯æ¨¡å‹éœ€è¦åº”å¯¹æµ·é‡è¯·æ±‚ï¼Œæµ·é‡è¯·æ±‚åŒæ—¶ä½œç”¨åœ¨å•çº¿ç¨‹ä¸Šï¼Œå°±éœ€è¦é˜²æ­¢ä»»ä½•ä¸€ä¸ªè®¡ç®—è€—è´¹è¿‡å¤šçš„CPUæ—¶é—´ç‰‡ã€‚è‡³äºæ˜¯è®¡ç®—å¯†é›†å‹è¿˜æ˜¯I/O\nå¯†é›†å‹ï¼Œåªè¦ä¸è®¡ç®—å¼‚æ­¥I/Oçš„è°ƒåº¦ï¼Œå°±æ„ä¸æˆé—®é¢˜ã€‚å»ºè®®å¯¹CPUå¾—è€—ç”¨ä¸è¦è¶…è¿‡10msï¼Œæˆ–è€…å°†å¤§é‡çš„è®¡ç®—åˆ†è§£æˆè¯¸å¤šçš„å°é‡è®¡ç®—ã€‚é€šè¿‡setImmediate()è¿›è¡Œè°ƒåº¦ã€‚")]),e._v(" "),t("h4",{attrs:{id:"éš¾ç‚¹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#éš¾ç‚¹"}},[e._v("#")]),e._v(" éš¾ç‚¹")]),e._v(" "),t("ul",[t("li",[e._v("éš¾ç‚¹1: å¼‚å¸¸å¤„ç†\nè¿‡å»ï¼Œæˆ‘ä»¬å¤„ç†å¼‚å¸¸ï¼Œé€šè¿‡ä½¿ç”¨ç±»javaçš„try/catch/finalè¯­å¥å—è¿›è¡Œä¸€åœºæ•è·ã€‚")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("try {\n JSON.parse(json);\n} catch (e) {\n // TODO\n} \n")])])]),t("p",[e._v("ä½†æ˜¯è¿™å¯¹äºå¼‚æ­¥ç¼–ç¨‹ä¸ä¸€å®šé€‚ç”¨ã€‚å¼‚æ­¥I/Oçš„å®ç°ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªé˜¶æ®µï¼š"),t("code",[e._v("æäº¤è¯·æ±‚å’Œå¤„ç†ç»“æœ")]),e._v("ã€‚è¿™ä¸¤ä¸ªé˜¶æ®µä¸­é—´æœ‰äº‹ä»¶å¾ªç¯çš„è°ƒåº¦ï¼Œä¸¤è€…å½¼æ­¤ä¸å…³è”ï¼Œå¼‚æ­¥æ–¹æ³•é€šå¸¸åœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µæäº¤è¯·æ±‚åç«‹å³è¿”å›ï¼Œå› ä¸ºå¼‚å¸¸ä¸ä¸€å®šå‘ç”Ÿåœ¨è¿™ä¸ªé˜¶æ®µã€‚try/catchçš„åŠŸæ•ˆåœ¨æ­¤å¤„ä¸ä¼šå‘ç”Ÿä»»ä½•ä½œç”¨")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("var async = function (callback) {\n process.nextTick(callback);\n}; \n")])])]),t("p",[e._v("è°ƒç”¨async()æ–¹æ³•åï¼Œcallbackè¢«å­˜å‚¨èµ·æ¥ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯Tickæ‰ä¼šå–å‡ºæ¥æ‰§è¡Œã€‚å¯¹å¼‚æ­¥æ–¹æ³•è¿›è¡Œtry/catchæ“ä½œåªèƒ½æ•è·å½“å‰äº‹ä»¶å¾ªç¯å†…çš„å¼‚å¸¸ï¼Œå¯¹callbackæ‰§è¡Œæ—¶æŠ›å‡ºæ¥çš„å¼‚å¸¸æ— èƒ½ä¸ºåŠ›ã€‚")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("try {\n async(callback);\n} catch (e) {\n // TODO\n} \n")])])]),t("p",[e._v("Nodeåœ¨å¤„ç†å¼‚å¸¸ä¸Šå½¢æˆäº†ä¸€ç§çº¦å®šï¼Œå°†å¼‚å¸¸ä½œä¸ºå›è°ƒå‡½æ•°çš„ç¬¬ä¸€ä¸ªå®å‚ä¼ å›ï¼Œå¦‚æœä¸ºç©ºå€¼ï¼Œè¡¨æ˜å¼‚å¸¸è°ƒç”¨æ²¡æœ‰å¼‚å¸¸æŠ›å‡ºã€‚")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("async(function (err, results) {\n // TODO\n});\n")])])]),t("p",[e._v("åœ¨æˆ‘ä»¬è‡ªè¡Œç¼–å†™çš„å¼‚æ­¥æ–¹æ³•ä¸Šï¼Œéœ€è¦éµå¾ªè¿™æ ·çš„åŸåˆ™ï¼š")]),e._v(" "),t("ol",[t("li",[e._v("å¿…é¡»æ‰§è¡Œè°ƒç”¨è€…ä¼ å…¥çš„å›è°ƒå‡½æ•°")]),e._v(" "),t("li",[e._v("æ­£ç¡®ä¼ é€’å¼‚å¸¸ä¾›è°ƒç”¨è€…åˆ¤æ–­")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("var async = function (callback) {\n process.nextTick(function() {\n var results = something;\n if (error) {\n return callback(error);\n }\n callback(null, results);\n });\n};\n")])])]),t("p",[e._v("åœ¨å¼‚æ­¥æ–¹æ³•çš„ç¼–å†™ä¸­ï¼Œå¦å¤–ä¸€ä¸ªå¸¸çŠ¯çš„é”™è¯¯æ˜¯å¯¹ç”¨æˆ·ä¼ é€’çš„å›è°ƒå‡½æ•°è¿›è¡Œå¼‚å¸¸æ•è·ã€‚")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("try {\n req.body = JSON.parse(buf, options.reviver);\n callback();\n} catch (err){\n err.body = buf;\n err.status = 400;\n callback(err);\n} \n")])])]),t("p",[e._v("ä¸Šè¿°ä»£ç çš„æ„å›¾æ˜¯æ•è·JSON.parse()ä¸­å¯èƒ½å‡ºç°çš„å¼‚å¸¸ï¼Œä½†æ˜¯å´ä¸å°å¿ƒåŒ…å«äº†ç”¨æˆ·ä¼ é€’çš„å›è°ƒå‡½æ•°ã€‚è¿™æ„å‘³ç€å¦‚æœå›è°ƒå‡½æ•°ä¸­æœ‰å¼‚å¸¸æŠ›å‡ºï¼Œå°†ä¼šè¿›å…¥catch()ä»£ç å—ä¸­æ‰§è¡Œï¼Œäºæ˜¯å›è°ƒå‡½æ•°ä¼šè¢«æ‰§è¡Œä¸¤æ¬¡ã€‚\næ­£ç¡®çš„æ•è·ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("try {\n  req.body = JSON.parse(buf, options.reviver);\n} catch (err){\n  err.body = buf; \n  err.status = 400;\n  return callback(err);\n}\ncallback(); \n")])])]),t("p",[e._v("åœ¨ç¼–å†™å¼‚æ­¥æ–¹æ³•æ—¶ï¼Œåªè¦å°†å¼‚å¸¸æ­£ç¡®çš„ä¼ é€’ç»™ç”¨æˆ·çš„å›è°ƒæ–¹æ³•å³å¯ã€‚æ— é¡»è¿‡å¤šå¤„ç†ã€‚")]),e._v(" "),t("ul",[t("li",[e._v("éš¾ç‚¹2: å‡½æ•°åµŒå¥—è¿‡æ·±\nåœ¨Nodeä¸­ï¼Œäº‹åŠ¡ä¸­å­˜åœ¨å¤šä¸ªå¼‚å¸¸è°ƒç”¨çš„åœºæ™¯ï¼šæ¯”å¦‚ä¸€ä¸ªéå†ç›®å½•çš„æ“ä½œï¼š")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("fs.readdir(path.join(__dirname, '..'), function (err, files) {\n  files.forEach(function (filename, index) {\n  fs.readFile(filename, 'utf8', function (err, file) {\n   // TODO\n  });\n });\n}); \n")])])]),t("p",[e._v("å¯¹äºä¸Šè¿°åœºæ™¯ï¼Œç”±äºä¸¤æ¬¡æ“ä½œå­˜åœ¨ä¾èµ–å…³ç³»ï¼Œå‡½æ•°åµŒå¥—çš„è¡Œä¸ºä¹Ÿè®¸æƒ…æœ‰å¯åŸã€‚åœ¨ç½‘é¡µæ¸²æŸ“è¿‡ç¨‹ä¸­ï¼Œé€šå¸¸éœ€è¦æ•°æ®ï¼Œæ¨¡ç‰ˆï¼Œèµ„æºæ–‡ä»¶ï¼Œè¿™ä¸‰è€…äº’ç›¸ä¸ä¾èµ–ï¼Œä½†æ˜¯åœ¨æœ€ç»ˆæ¸²æŸ“ç»“æœä¸­ï¼Œä¸‰è€…ç¼ºä¸€ä¸å¯ã€‚å¦‚æœé‡‡ç”¨é»˜è®¤çš„å¼‚æ­¥æ–¹æ³•è°ƒç”¨ï¼Œç¨‹åºå–ä¸‹ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("fs.readFile(template_path, 'utf8', function (err, template) {\n db.query(sql, function (err, data) {\n l10n.get(function (err, resources) {\n // TODO\n });\n });\n});\n")])])]),t("ul",[t("li",[e._v("éš¾ç‚¹3: é˜»å¡ä»£ç ")])]),e._v(" "),t("p",[e._v("ç–‘æƒ‘ğŸ¤”ä¸ºä»€ä¹ˆæ²¡æœ‰sleep()è¿™æ ·çš„çº¿ç¨‹æ²‰ç¡åŠŸèƒ½ï¼Œå”¯æœ‰ç”¨äºå»¶æ—¶çš„setIntervalå’ŒsetTimeout()è¿™ä¸¤ä¸ªå‡½æ•°ã€‚è¿™ä¸¤ä¸ªå‡½æ•°ä¸èƒ½é˜»å¡åç»­ä»£ç çš„æŒç»­æ‰§è¡Œã€‚å®ç°sleep(1000)çš„æ•ˆæœï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("// TODO\nvar start = new Date();\nwhile (new Date() - start < 1000) {\n // TODO\n}\n// éœ€è¦é˜»å¡çš„ä»£ç \n")])])]),t("p",[e._v("å®é™…æ˜¯è¿™æ®µä»£ç ä¼šæ”¯æŒå ç”¨CPUè¿›è¡Œåˆ¤æ–­ï¼Œä¸çœŸæ­£çš„çº¿ç¨‹æ²‰ç¡ç›¸å»ç”šè¿œï¼Œå®Œå…¨ç ´åäº†äº‹ä»¶å¾ªç¯çš„è°ƒåº¦ã€‚ç”±äºNodeå•çº¿ç¨‹çš„åŸå› ï¼ŒCPUèµ„æºå…¨éƒ½ä¼šç”¨äºè¿™æ®µä»£ç æœåŠ¡ï¼Œå¯¼è‡´å…¶ä½™ä»»ä½•è¯·æ±‚éƒ½ä¼šå¾—ä¸åˆ°å“åº”ã€‚\néœ€è¦è¿™æ ·çš„éœ€æ±‚æ—¶ï¼Œåœ¨ç»Ÿä¸€è§„åˆ’å¥½ä¸šåŠ¡é€»è¾‘åï¼Œè°ƒç”¨setTimeout()çš„æ•ˆæœä¼šæ›´å¥½ã€‚")]),e._v(" "),t("ul",[t("li",[e._v("éš¾ç‚¹4: å¤šçº¿ç¨‹ç¼–ç¨‹\næˆ‘ä»¬åœ¨è°ˆè®ºJavaScriptçš„æ—¶å€™ï¼Œé€šå¸¸è°ˆçš„æ˜¯å•ä¸€çº¿ç¨‹ä¸Šæ‰§è¡Œçš„ä»£ç ï¼Œè¿™åœ¨æµè§ˆå™¨ä¸­æŒ‡çš„æ˜¯JavaScriptæ‰§è¡Œçº¿ç¨‹ä¸UIæ¸²æŸ“å…±ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œåœ¨Nodeä¸­ï¼Œåªæ˜¯æ²¡æœ‰æ¸²æŸ“UIçš„éƒ¨åˆ†ï¼Œæ¨¡å‹åŸºæœ¬ç›¸åŒã€‚å¯¹äºæœåŠ¡ç«¯è€Œè¨€ï¼Œå¦‚æœæœåŠ¡å™¨æ˜¯å¤šæ ¸CPUï¼Œå•ä¸ªNodeè¿›ç¨‹å®è´¨ä¸Šæ²¡æœ‰å……åˆ†åˆ©ç”¨å¤šæ ¸CPU")])]),e._v(" "),t("p",[e._v("æµè§ˆå™¨æå‡ºWeb Workers,å®ƒé€šè¿‡å°†JavaScriptæ‰§è¡Œä¸UIæ¸²æŸ“åˆ†ç¦»ï¼Œå¯ä»¥å¾ˆå¥½åˆ©ç”¨å¤šæ ¸CPUä¸ºå¤§é‡è®¡ç®—æœåŠ¡ã€‚åŒæ—¶å‰ç«¯Web Workersä¹Ÿæ˜¯ä¸€ä¸ªåˆ©ç”¨æ¶ˆæ¯æœºåˆ¶åˆç†ä½¿ç”¨å¤šæ ¸CPUçš„ç†æƒ³æ¨¡å‹ã€‚")]),e._v(" "),t("p",[t("img",{attrs:{src:"/images/node/webWorkers%E5%B7%A5%E4%BD%9C%E7%A4%BA%E6%84%8F.png",alt:""}})]),e._v(" "),t("p",[e._v("é—æ†¾åœ¨äºå‰ç«¯æµè§ˆå™¨å­˜åœ¨å¯¹æ ‡å‡†çš„æ»åæ€§ï¼ŒWeb Workersæ²¡æœ‰å¹¿æ³›åº”ç”¨èµ·æ¥ã€‚Web Workersèƒ½è§£å†³åˆ©ç”¨CPUå’Œå‡å°‘é˜»å¡UIæ¸²æŸ“ï¼Œä½†æ˜¯ä¸èƒ½è§£å†³UIæ¸²æŸ“çš„æ•ˆç‡é—®é¢˜ã€‚Nodeå€Ÿé‰´è¿™ä¸ªæ¨¡å¼ï¼Œchild_processæ˜¯å…¶åŸºç¡€APIï¼Œclusteræ¨¡å—æ˜¯æ›´æ·±å±‚æ¬¡çš„åº”ç”¨ã€‚")]),e._v(" "),t("ul",[t("li",[e._v("éš¾ç‚¹5: å¼‚æ­¥è½¬åŒæ­¥\nNodeæä¾›äº†ç»å¤§éƒ¨åˆ†çš„å¼‚æ­¥APIå’Œå°‘é‡çš„åŒæ­¥APIï¼Œå¶å°”å‡ºç°çš„åŒæ­¥éœ€æ±‚ä¼šå› æ²¡æœ‰åŒæ­¥APIè®©å¼€å‘è€…æ— æ‰€é€‚ä»ã€‚")])]),e._v(" "),t("h3",{attrs:{id:"å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆ"}},[e._v("#")]),e._v(" å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆ")]),e._v(" "),t("p",[e._v("å‰é¢åˆ—ä¸¾äº†å› å¼‚æ­¥ç¼–ç¨‹å¸¦æ¥çš„ä¸€äº›é—®é¢˜ï¼Œä¸å¼‚æ­¥ç¼–ç¨‹æå‡çš„æ€§èƒ½æˆåŠŸç›¸æ¯”ï¼Œç¼–ç¨‹è¿‡ç¨‹çœ‹èµ·æ¥å’©æœ‰æƒ³è±¡ä¸­é‚£ä¹ˆç¾å¥½ã€‚\nç›®å‰å¼‚æ­¥ç¼–ç¨‹çš„ä¸»è¦è§£å†³æ–¹æ¡ˆæœ‰ä¸‰ç§ã€‚")]),e._v(" "),t("ol",[t("li",[e._v("äº‹ä»¶å‘å¸ƒ/è®¢é˜…æ¨¡å¼")]),e._v(" "),t("li",[e._v("Primise/Deferredæ¨¡å¼")]),e._v(" "),t("li",[e._v("æµç¨‹æ§åˆ¶åº“")])]),e._v(" "),t("h4",{attrs:{id:"äº‹ä»¶å‘å¸ƒ-è®¢é˜…æ¨¡å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#äº‹ä»¶å‘å¸ƒ-è®¢é˜…æ¨¡å¼"}},[e._v("#")]),e._v(" äº‹ä»¶å‘å¸ƒ/è®¢é˜…æ¨¡å¼")]),e._v(" "),t("p",[e._v("äº‹ä»¶ç›‘å¬å™¨æ¨¡å¼æ˜¯ä¸€ç§å¹¿æ³›ç”¨äºå¼‚æ­¥ç¼–ç¨‹çš„æ¨¡å¼ï¼Œæ˜¯å›è°ƒå‡½æ•°çš„äº‹ä»¶åŒ–ï¼Œåˆç§°"),t("code",[e._v("å‘å¸ƒ/è®¢é˜…æ¨¡å¼")]),e._v("ã€‚\nNodeè‡ªèº«æä¾›çš„"),t("a",{attrs:{href:"https://nodejs.org/docs/latest/api/events.html",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("events")]),e._v("æ¨¡å—"),t("OutboundLink")],1),e._v("æ˜¯å‘å¸ƒ/è®¢é˜…æ¨¡å¼çš„ä¸€ä¸ªç®€å•å®ç°ã€‚Nodeä¸­å¤§éƒ¨åˆ†æ¨¡å—éƒ½ç»§æ‰¿è‡ªå®ƒï¼Œè¿™ä¸ªæ¨¡å—æ¯”å‰ç«¯æµè§ˆå™¨ä¸­å¤§é‡DOMäº‹ä»¶ç®€å•ï¼Œä¸å­˜åœ¨äº‹ä»¶å†’æ³¡ï¼Œä¹Ÿä¸å­˜åœ¨preventDefault(),stopPropagation()å’ŒstopImmediatePropagation()\n()ç­‰æ§åˆ¶äº‹ä»¶ä¼ é€’çš„æ–¹æ³•ã€‚å®ƒå…·æœ‰addListener/on(), once(), removeListener(), removeAllListener()å’Œemit()ç­‰åŸºæœ¬çš„äº‹ä»¶ç›‘å¬æ¨¡å¼çš„æ–¹æ³•å®ç°ã€‚")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('// è®¢é˜…\nemitter.on("event1", function (message) {\n console.log(message);\n});\n// å‘å¸ƒ\nemitter.emit(\'event1\', "I am message!"); \n')])])]),t("p",[e._v("å¯ä»¥çœ‹åˆ°è®¢é˜…äº‹ä»¶æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°çš„åº”ç”¨ã€‚äº‹ä»¶å‘å¸ƒ/è®¢é˜…æ¨¡å¼å¯ä»¥å®ç°ä¸€ä¸ªäº‹ä»¶ä¸å¤šä¸ªå›è°ƒå‡½æ•°ï¼ˆäº‹ä»¶ä¾¦å¬å™¨ï¼‰çš„å…³è”ã€‚é€šè¿‡ "),t("code",[e._v("emit")]),e._v("å‘å¸ƒäº‹ä»¶åï¼Œæ¶ˆæ¯ä¼šç«‹å³ä¼ é€’ç»™å½“å‰èŠ‚ç‚¹äº‹ä»¶çš„æ‰€æœ‰ä¾¦å¬å™¨ã€‚ä¾¦å¬å™¨å¯ä»¥çµæ´»çš„æ·»åŠ å’Œåˆ é™¤ï¼Œä½¿å¾—äº‹ä»¶ä¸å…·ä½“å¤„ç†é€»è¾‘ä¹‹é—´å¯ä»¥å¾ˆè½»æ¾çš„å…³è”ä¸æ¥è€¦ã€‚")]),e._v(" "),t("p",[e._v("äº‹ä»¶å‘å¸ƒ/è®¢é˜…æ¨¡å¼è‡ªèº«å¹¶æ— åŒæ­¥ä¸å¼‚æ­¥è°ƒç”¨çš„é—®é¢˜ï¼Œä½†æ˜¯åœ¨Nodeä¸­ï¼Œemit()è°ƒç”¨å¤šåŠæ˜¯ä¼´éšäº‹ä»¶å¾ªç¯è€Œå¼‚æ­¥è§¦å‘çš„ã€‚æ‰€ä»¥æˆ‘ä»¬è¯´äº‹ä»¶å‘å¸ƒ/è®¢é˜…æ¨¡å¼å¹¿æ³›åº”ç”¨äºå¼‚æ­¥ç¼–ç¨‹ã€‚")]),e._v(" "),t("p",[e._v("äº‹ä»¶å‘å¸ƒ/è®¢é˜…æ¨¡å¼å¸¸å¸¸ç”¨æ¥æ¥è€¦ä¸šåŠ¡é€»è¾‘ï¼Œäº‹ä»¶å‘å¸ƒè€…æ— é¡»å…³æ³¨è®¢é˜…çš„ä¾¦å¬å™¨å¦‚ä½•å®ç°ä¸šåŠ¡é€»è¾‘ï¼Œæ•°æ®é€šè¿‡æ¶ˆæ¯çš„æ–¹å¼å¯ä»¥å¾ˆçµæ´»çš„ä¼ é€’ã€‚")]),e._v(" "),t("p",[e._v("å¯ä»¥é€šè¿‡äº‹ä»¶å‘å¸ƒ/è®¢é˜…æ¨¡å¼è¿›è¡Œç»„ä»¶åˆ†è£…ï¼Œå°†ä¸å˜çš„éƒ¨åˆ†åˆ†è£…åœ¨ç»„ä»¶å†…éƒ¨ï¼Œå°†å®¹æ˜“å˜åŒ–ï¼Œéœ€è‡ªå®šä¹‰çš„éƒ¨åˆ†é€šè¿‡äº‹ä»¶æš´éœ²ç»™å¤–éƒ¨å¤„ç†ã€‚è¿™æ˜¯ä¸€ç§å…¸å‹çš„é€»è¾‘åˆ†ç¦»æ–¹å¼ã€‚")]),e._v(" "),t("p",[e._v("ä»å¦ä¸€ä¸ªè§’åº¦æ¥çœ‹ï¼Œäº‹ä»¶ä¾¦å¬å™¨æ¨¡å¼ä¹Ÿæ˜¯ä¸€ç§é’©å­ï¼ˆhookï¼‰æœºåˆ¶ï¼Œåˆ©ç”¨é’©å­å¯¼å‡ºå†…éƒ¨æ•°æ®æˆ–çŠ¶æ€ç»™å¤–éƒ¨çš„è°ƒç”¨è€…ï¼ŒNodeä¸­å¾ˆå¤šå¯¹è±¡éƒ½å…·æœ‰é»‘ç›’å­çŠ¶æ€ï¼ŒåŠŸèƒ½ç‚¹è¾ƒå°‘ï¼Œå¦‚æœä¸é€šè¿‡äº‹ä»¶é’©å­çš„å½¢å¼ï¼Œå¾ˆéš¾è·å¾—å¯¹è±¡åœ¨è¿è¡ŒæœŸé—´çš„ä¸­é—´å€¼æˆ–å†…éƒ¨çŠ¶æ€ã€‚\nHttpè¯·æ±‚å°±æ˜¯å…¸å‹çš„åœºæ™¯ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("var options = {\n host: 'www.google.com',\n port: 80,\n path: '/upload',\n method: 'POST'\n};\nvar req = http.request(options, function (res) {\n console.log('STATUS: ' + res.statusCode);\n console.log('HEADERS: ' + JSON.stringify(res.headers));\n res.setEncoding('utf8');\n res.on('data', function (chunk) {\n console.log('BODY: ' + chunk);\n });\n res.on('end', function () {\n // TODO\n });\n});\nreq.on('error', function (e) {\n console.log('problem with request: ' + e.message);\n});\n// write data to request body\nreq.write('data\\n');\nreq.write('data\\n')\n")])])]),t("p",[e._v("åœ¨è¿™æ®µHttpè¯·æ±‚ä¸­ï¼Œç¨‹åºå‘˜åªéœ€è¦å°†è§†çº¿æ”¾åœ¨error,data,endè¿™äº›ä¸šåŠ¡äº‹ä»¶ç‚¹ä¸Šï¼Œè‡³äºå†…éƒ¨çš„æµç¨‹å¦‚ä½•ï¼Œæ— é¡»å…³æ³¨ã€‚")]),e._v(" "),t("p",[e._v("Nodeå¯¹äº‹ä»¶å‘å¸ƒ/è®¢é˜…åšäº†é¢å¤–å¤„ç†ï¼š")]),e._v(" "),t("ol",[t("li",[e._v("å¦‚æœå¯¹ä¸€ä¸ªäº‹ä»¶æ·»åŠ äº†è¶…è¿‡10ä¸ªä¾¦å¬å™¨ï¼Œå°†ä¼šå¾—åˆ°ä¸€ä¸ªè­¦å‘Šã€‚è¿™ä¸€å¤„è®¾è®¡ä¸Nodeè‡ªèº«å•çº¿ç¨‹è¿è¡Œæœ‰å…³ï¼Œè®¾è®¡è€…è®¤ä¸ºä¾¦å¬å™¨å¤ªå¤šå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„éœ²ã€‚æ‰€ä»¥å­˜åœ¨è¿™æ ·ä¸€ä¸ªè­¦å‘Šã€‚è°ƒç”¨"),t("code",[e._v("emitter.setMaxListeners(0)")]),e._v("å¯ä»¥å°†è¿™ä¸ªé™åˆ¶å»æ‰ã€‚å¦å¤–ï¼Œç”±äºäº‹ä»¶å‘å¸ƒä¼šå¼•èµ·ä¸€ç³»åˆ—ä¾¦å¬å™¨æ‰§è¡Œï¼Œå¦‚æœäº‹ä»¶ç›¸å…³çš„ä¾¦å¬å™¨è¿‡å¤šï¼Œå¯èƒ½ä¼šå­˜åœ¨è¿‡å¤šå ç”¨CPUçš„åœºæ™¯ã€‚")]),e._v(" "),t("li",[e._v("ä¸ºäº†å¤„ç†å¼‚å¸¸ï¼Œ"),t("code",[e._v("EventEmitter")]),e._v("å¯¹è±¡å¯¹erroräº‹ä»¶è¿›è¡Œäº†ç‰¹æ®Šå¯¹å¾…ï¼Œå¦‚æœè¿è¡ŒæœŸé—´çš„é”™è¯¯è§¦å‘äº†erroräº‹ä»¶ï¼Œ"),t("code",[e._v("EventEmitter")]),e._v("ä¼šæ£€æŸ¥æ˜¯å¦æœ‰å¤šerroräº‹ä»¶æ·»åŠ è¿‡ä¾¦å¬å™¨ã€‚å¦‚æœæ·»åŠ äº†ï¼Œè¿™ä¸ªé”™è¯¯å°†ä¼šäº¤ç»™ä¾¦å¬å™¨å¤„ç†ï¼Œå¦åˆ™è¿™ä¸ªé”™è¯¯å°†ä¼šä½œä¸ºå¼‚å¸¸æŠ›å‡ºã€‚å¦‚æœå¤–éƒ¨æ²¡æœ‰æ•è·è¿™ä¸ªå¼‚å¸¸ï¼Œå°†ä¼šå¼•èµ·çº¿ç¨‹é€€å‡ºã€‚")])]),e._v(" "),t("ul",[t("li",[e._v("ç»§æ‰¿eventsæ¨¡å—\nå®ç°ä¸€ä¸ªç»§æ‰¿EventEmitterçš„ç±»")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("var events = require('events');\nfunction Stream() {\n events.EventEmitter.call(this);\n}\nutil.inherits(Stream, events.EventEmitter); \n")])])]),t("p",[e._v("Nodeåœ¨utilæ¨¡å—ä¸­å°è£…äº†ç»§æ‰¿çš„æ–¹æ³•ï¼Œæ‰€ä»¥æ­¤å¤„å¯ä»¥å¾ˆéå†çš„è°ƒç”¨ã€‚å¼€å‘è€…å¯ä»¥é€šè¿‡è¿™æ ·çš„æ–¹å¼è½»æ¾çš„ç»§æ‰¿"),t("code",[e._v("EventEmitter")]),e._v(",åˆ©ç”¨äº‹ä»¶æœºåˆ¶è§£å†³ä¸šåŠ¡é—®é¢˜ã€‚åœ¨Nodeæä¾›çš„æ ¸å¿ƒæ¨¡å—ä¸­ï¼Œæœ‰è¿‘åŠæ•°éƒ½ç»§æ‰¿è‡ª"),t("code",[e._v("EventEmitter")])]),e._v(" "),t("ul",[t("li",[e._v("åˆ©ç”¨äº‹ä»¶é˜Ÿåˆ—è§£å†³é›ªå´©é—®é¢˜\nåœ¨äº‹ä»¶è®¢é˜…/å‘å¸ƒæ¨¡å¼ä¸­ï¼Œé€šå¸¸æœ‰ä¸€ä¸ªonce()æ–¹æ³•ï¼Œé€šè¿‡å®ƒæ·»åŠ çš„ä¾¦å¬å™¨åªæ‰§è¡Œä¸€æ¬¡ï¼Œåœ¨æ‰§è¡Œä¹‹åå°±ä¼šå°†å®ƒä¸äº‹ä»¶çš„å…³è”ç§»é™¤ã€‚\nå¦‚ä½•é‡‡ç”¨once()è§£å†³é›ªå´©é—®é¢˜\nåœ¨è®¡ç®—æœºä¸­ï¼Œç¼“å­˜ç”±äºå­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œè®¿é—®é€Ÿåº¦ååˆ†å¿«ï¼Œå¸¸å¸¸ç”¨äºåŠ é€Ÿæ•°æ®è®¿é—®ï¼Œè®©ç»å¤§å¤šæ•°çš„è¯·æ±‚ä¸å¿…é‡å¤å»åšä¸€äº›ä½æ•ˆç‡çš„æ•°æ®è¯»å–ã€‚")])]),e._v(" "),t("p",[e._v("é›ªå´©é—®é¢˜ï¼šå°±æ˜¯åœ¨é«˜è®¿é—®é‡ï¼Œå¤§å¹¶å‘é‡çš„æƒ…å†µä¸‹ç¼“å­˜å¤±æ•ˆçš„æƒ…æ™¯æ­¤æ—¶å¤§é‡çš„è¯·æ±‚åŒæ—¶æ¶Œå…¥æ•°æ®åº“ä¸­ï¼Œæ•°æ®åº“æ— æ³•åŒæ—¶æ‰¿å—å¦‚æ­¤å¤§çš„æŸ¥è¯¢è¯·æ±‚ï¼Œè¿›è€Œå½±å“åˆ°ç½‘ç«™æ•´ä½“çš„å“åº”é€Ÿåº¦ã€‚\næ•°æ®åº“æŸ¥è¯¢è¯­å¥ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('var select = function (callback) {\n db.select("SQL", function (results) {\n callback(results);\n });\n}; \n')])])]),t("p",[e._v("å¦‚æœç«™ç‚¹åˆšå¥½å¯åŠ¨ï¼Œè¿™æ—¶ç¼“å­˜æ±‡æ€»æ˜¯ä¸å­˜åœ¨æ•°æ®çš„ï¼Œå¦‚æœè®¿é—®é‡å¤§ï¼ŒåŒä¸€å¥sqlä¼šè¢«å‘é€åˆ°æ•°æ®åº“ä¸­åå¤æŸ¥è¯¢ï¼Œä¼šå½±å“æœåŠ¡çš„æ•´ä½“æ€§èƒ½ï¼Œä¸€ç§æ”¹è¿›æ–¹æ¡ˆæ˜¯æ·»åŠ ä¸€ä¸ªçŠ¶æ€é”ã€‚")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('var status = "ready";\nvar select = function (callback) {\n if (status === "ready") {\n status = "pending";\n db.select("SQL", function (results) {\n status = "ready";\n callback(results);\n });\n }\n}; \n')])])]),t("p",[e._v("åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œè¿ç»­å¤šæ¬¡çš„è°ƒç”¨select()æ—¶ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ç”Ÿæ•ˆçš„ï¼Œåç»­çš„select()æ˜¯æ²¡æœ‰æ•°æ®æœåŠ¡çš„ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥å¼•å…¥äº‹ä»¶é˜Ÿåˆ—")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('var proxy = new events.EventEmitter();\nvar status = "ready";\nvar select = function (callback) {\n proxy.once("selected", callback);\n if (status === "ready") {\n status = "pending";\n db.select("SQL", function (results) {\n proxy.emit("selected", results);\n status = "ready";\n });\n }\n};\n')])])]),t("p",[e._v("è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨once()æ–¹æ³•ï¼Œå°†æ‰€æœ‰çš„è¯·æ±‚å›è°ƒéƒ½å‹å…¥åˆ°äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼Œåˆ©ç”¨å…¶æ‰§è¡Œä¸€æ¬¡å°±ä¼šå°†ç›‘è§†å™¨ç§»é™¤çš„ç‰¹ç‚¹ï¼Œä¿è¯æ¯ä¸€ä¸ªå›è°ƒåªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ã€‚")]),e._v(" "),t("p",[e._v("æ­¤å¤„å¯èƒ½å› ä¸ºå­˜åœ¨ä¾¦å¬å™¨è¿‡å¤šå¼•å‘çš„è­¦å‘Šï¼Œéœ€è¦è°ƒç”¨setMaxListeners(0)ç§»é™¤æ‰è­¦å‘Šï¼Œæˆ–è€…è®¾æ›´å¤§çš„è­¦å‘Šé˜€å€¼ã€‚")]),e._v(" "),t("ol",{attrs:{start:"3"}},[t("li",[e._v("å¤šå¼‚æ­¥ä¹‹é—´çš„åä½œæ–¹æ¡ˆ\näº‹ä»¶å‘å¸ƒ/è®¢é˜…æœ‰ç€å®ƒçš„ä¼˜ç‚¹ï¼Œåˆ©ç”¨é«˜é˜¶å‡½æ•°çš„ä¼˜åŠ¿ï¼Œä¾¦å¬å™¨ä½œä¸ºå›è°ƒå‡½æ•°å¯ä»¥éšæ„æ·»åŠ å’Œåˆ é™¤ï¼Œå®ƒå¸®åŠ©å¼€å‘è€…è½»æ¾å¤„ç†éšæ—¶å¯èƒ½æ·»åŠ çš„ä¸šåŠ¡é€»è¾‘ï¼Œä¹Ÿå¯ä»¥éš”ç¦»ä¸šåŠ¡é€»è¾‘ï¼Œä¿æŒä¸šåŠ¡é€»è¾‘å•å…ƒçš„èŒä¸šå•ä¸€ã€‚\nä½¿ç”¨åŸç”Ÿä»£ç è§£å†³éš¾ç‚¹2ï¼ˆå‡½æ•°åµŒå¥—è¿‡æ·± åœ¨Nodeä¸­ï¼Œäº‹åŠ¡ä¸­å­˜åœ¨å¤šä¸ªå¼‚å¸¸è°ƒç”¨çš„åœºæ™¯ï¼‰")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('var count = 0;\nvar results = {};\nvar done = function (key, value) {\n results[key] = value;\n count++;\n if (count === 3) {\n // æ¸²æŸ“é¡µé¢\n render(results);\n } \n };\nfs.readFile(template_path, "utf8", function (err, template) {\n done("template", template);\n});\ndb.query(sql, function (err, data) {\n done("data", data);\n});\nl10n.get(function (err, resources) {\n done("resources", resources);\n}); \n')])])]),t("p",[e._v("ç”±äºå¤šä¸ªå¼‚æ­¥åœºæ™¯ä¸­å›è°ƒå‡½æ•°çš„æ‰§è¡Œå¹¶ä¸èƒ½ä¿è¯é¡ºåºï¼Œä¸”å›è°ƒå‡½æ•°ç›¸äº’ä¹‹é—´æ²¡æœ‰ä»»ä½•äº¤é›†ï¼Œæ‰€ä»¥éœ€è¦å€ŸåŠ©ä¸€ä¸ªç¬¬ä¸‰æ–¹å‡½æ•°å’Œç¬¬ä¸‰æ–¹å˜é‡æ¥å¤„ç†å¼‚æ­¥åä½œçš„ç»“æœã€‚\né€šå¸¸ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªç”¨äºæ£€æµ‹æ¬¡æ•°çš„å˜é‡å«åš"),t("code",[e._v("å“¨å…µå˜é‡")]),e._v("ã€‚\nå¯ä»¥åˆ©ç”¨åå‡½æ•°æ¥å¤„ç†å“¨å…µå˜é‡ä¸ç¬¬ä¸‰æ–¹å‡½æ•°çš„å…³ç³»")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("var after = function (times, callback) {\n var count = 0, results = {};\n return function (key, value) {\n results[key] = value;\n count++;\n if (count === times) {\n callback(results);\n }\n };\n};\nvar done = after(times, render); \n")])])]),t("p",[e._v("ä¸Šè¿°æ–¹æ¡ˆå®ç°äº†å¤šå¯¹ä¸€çš„ç›®çš„ã€‚å¦‚æœä¸šåŠ¡ç»§ç»­å¢é•¿ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥åˆ©ç”¨å‘å¸ƒ/è®¢é˜…çš„æ–¹å¼æ¥å®Œæˆå¤šå¯¹å¤šçš„æ–¹æ¡ˆ")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('var emitter = new events.Emitter();\nvar done = after(times, render);\nemitter.on("done", done);\nemitter.on("done", other);\nfs.readFile(template_path, "utf8", function (err, template) {\n emitter.emit("done", "template", template);\n});\ndb.query(sql, function (err, data) {\n emitter.emit("done", "data", data);\n});\nl10n.get(function (err, resources) {\n emitter.emit("done", "resources", resources);\n});\n\n')])])]),t("p",[e._v("è¿™ä¸ªæ–¹æ¡ˆç»“åˆäº†å‰è€…ç”¨ç®€å•çš„åå‡½æ•°å®Œæˆå¤šå¯¹ä¸€çš„æ”¶æ•›ä¸äº‹ä»¶è®¢é˜…/å‘å¸ƒæ¨¡å¼ä¸­ä¸€å¯¹å¤šçš„å‘æ•£ã€‚\nè¿™ä¸ªç¼ºç‚¹åœ¨äºï¼šè°ƒç”¨è€…è¦å»å‡†å¤‡ç€done()å‡½æ•°ï¼Œä»¥åŠåœ¨å›è°ƒå‡½æ•°ä¸­éœ€è¦ä»ç»“æœä¸­æŠŠæ•°æ®ä¸€ä¸ªä¸€ä¸ªæå–å‡ºæ¥ï¼Œå†è¿›è¡Œç»´æŠ¤ã€‚")]),e._v(" "),t("p",[e._v("å¦å¤–ä¸€ä¸ªæ–¹æ¡ˆï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('var proxy = new EventProxy();\nproxy.all("template", "data", "resources", function (template, data, resources) {\n // TODO\n});\nfs.readFile(template_path, "utf8", function (err, template) {\n proxy.emit("template", template);\n});\ndb.query(sql, function (err, data) {\n proxy.emit("data", data);\n});\nl10n.get(function (err, resources) {\n proxy.emit("resources", resources);\n});\n')])])]),t("p",[e._v("EventProxyæä¾›äº†ä¸€ä¸ªall()æ–¹æ³•æ¥è®¢é˜…å¤šä¸ªäº‹ä»¶ï¼Œå½“æ¯ä¸ªäº‹ä»¶éƒ½è¢«è§¦å‘ä»¥åï¼Œä¾¦å¬å™¨æ‰ä¼šæ‰§è¡Œã€‚\nå¦å¤–ä¸€ä¸ªå°±æ˜¯tail,ä»–ä¸all()æ–¹æ³•çš„åŒºåˆ«åœ¨äºall()æ–¹æ³•çš„ä¾¦å¬å™¨åœ¨æ»¡è¶³æ¡ä»¶ååªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œtail()æ–¹æ³•çš„ä¾¦å¬å™¨åœ¨æ»¡è¶³æ¡ä»¶æ—¶æ‰§è¡Œä¸€æ¬¡ä¹‹åï¼Œå¦‚æœç»„åˆäº‹ä»¶çš„æŸä¸ªäº‹ä»¶å†æ¬¡è¢«è§¦å‘ï¼Œä¾¦å¬å™¨ä¼šç”¨æœ€æ–°çš„æ•°æ®ç»§ç»­æ‰§è¡Œã€‚\nall(ï¼‰æ–¹æ³•çš„æ”¹è¿›ï¼šåœ¨ä¾¦å¬å™¨ä¸­è¿”å›æ•°æ®çš„å‚æ•°åˆ—è¡¨ä¸è®¢é˜…ç»„åˆäº‹ä»¶çš„äº‹ä»¶åˆ—è¡¨æ—¶ä¸€è‡´å¯¹åº”çš„ã€‚")]),e._v(" "),t("p",[e._v("åœ¨å¼‚æ­¥åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä»ä¸€ä¸ªæ¥å£å¤šæ¬¡è¯»å–æ•°æ®ï¼Œæ­¤æ—¶è§¦å‘çš„äº‹ä»¶åæˆ–è®¸æ˜¯ç›¸åŒçš„ï¼ŒEventProxyæä¾›äº†after()æ–¹æ³•æ¥å®ç°äº‹ä»¶åœ¨æ‰§è¡Œå¤šæ¬¡åæ‰§è¡Œä¾¦å¬å™¨çš„å•ä¸€äº‹ä»¶ç»„åˆè®¢é˜…æ–¹å¼ã€‚")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('var proxy = new EventProxy();\nproxy.after("data", 10, function (datas) {\n // TODO\n}); \n')])])]),t("p",[e._v("æ‰§è¡Œ0æ¬¡dataäº‹ä»¶åæ‰§è¡Œä¾¦å¬å™¨ã€‚è¿™ä¸ªä¾¦å¬å™¨çš„æ•°æ®ä¸º10æ¬¡æŒ‰äº‹ä»¶è§¦å‘æ¬¡åºæ’åºçš„æ•°ç»„ã€‚")]),e._v(" "),t("ol",{attrs:{start:"4"}},[t("li",[e._v("EventProxyåŸç†")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('  trigger: function (eventName) {\n    var list, calls, ev, callback, args;\n    var both = 2;\n    if (!(calls = this._callbacks)) return this;\n    while (both--) {\n      ev = both ? eventName : "all";\n      if ((list = calls[ev])) {\n        for (var i = 0, l = list.length; i < l; i++) {\n          if (!(callback = list[i])) {\n            list.splice(i, 1);\n            i--;\n            l--;\n          } else {\n            args = both ? Array.prototype.slice.call(arguments, 1) : arguments;\n            callback[0].apply(callback[1] || this, args);\n          }\n        }\n      }\n    }\n    return this;\n  },\n \n')])])]),t("p",[e._v("EventProxyæ˜¯å°†allä½œä¸ºä¸€ä¸ªäº‹ä»¶æµçš„æ‹¦æˆªå±‚ï¼Œåœ¨å…¶ä¸­æ³¨å…¥ä¸€äº›ä¸šåŠ¡æ¥å¤„ç†å•ä¸€äº‹ä»¶æ— æ³•è§£å†³çš„å¼‚æ­¥å¤„ç†é—®é¢˜ã€‚ç±»ä¼¼çš„æ‰©å±•è¿˜æœ‰all(), tail(), after(), not()å’Œany()ç­‰ã€‚")]),e._v(" "),t("ol",{attrs:{start:"5"}},[t("li",[e._v("EventProxyå¼‚å¸¸å¤„ç†")])]),e._v(" "),t("p",[e._v("é€šè¿‡é¢å¤–æ·»åŠ erroräº‹ä»¶æ¥è¿›è¡Œå¼‚å¸¸ç»Ÿä¸€å¤„ç†ã€‚")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("exports.getContent = function (callback) {\n    var ep = new EventProxy();\n    ep.all('tpl', 'data', function (tpl, data) {\n        // æˆåŠŸå›è°ƒ\n        callback(null, {\n            template: tpl,\n            data: data\n        });\n    });\n    // ä¾¦å¬erroräº‹ä»¶\n    ep.bind('error', function (err) {\n        // á‚‚è½½Û–à»¯æœ‰å¤„ç†å‡½æ•°\n        ep.unbind();\n        // å¼‚å¸¸å›è°ƒ\n        callback(err);\n    });\n    fs.readFile('template.tpl', 'utf-8', function (err, content) {\n        if (err) {\n            //ä¸€æ—¦å‘ç”Ÿå¼‚å¸¸ï¼Œä¸€å¾‹äº¤ç»™erroräº‹ä»¶çš„å¤„ç†å‡½æ•°å¤„ç†\n            return ep.emit('error', err);\n        }\n        ep.emit('tpl', content);\n    });\n    db.get('some sql', function (err, result) {\n        if (err) {\n            // ä¸€æ—¦å‘ç”Ÿå¼‚å¸¸ï¼Œä¸€å¾‹äº¤ç»™erroräº‹ä»¶çš„å¤„ç†å‡½æ•°å¤„ç†\n            return ep.emit('error', err);\n        }\n        ep.emit('data', result);\n    }); \n}\n")])])]),t("p",[e._v("æ”¹è¿›ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('exports.getContent = function (callback) {\n  var ep = new EventProxy();\n  ep.all("tpl", "data", function (tpl, data) {\n    // æˆåŠŸå›è°ƒ\n    callback(null, {\n      template: tpl,\n      data: data,\n    });\n  });\n  //ç»‘å®šé”™è¯¯å¤„ç†å‡½æ•°\n  ep.fail(callback);\n  fs.readFile("template.tpl", "utf-8", ep.done("tpl"));\n  db.get("some sql", ep.done("data"));\n};\n')])])]),t("p",[e._v("åœ¨ä¸Šè¿°ä»£ç ä¸­EventProxyæä¾›äº†failå’Œdoneä¸¤ä¸ªå®ä¾‹æ–¹æ³•æ¥ä¼˜åŒ–å¼‚å¸¸å¤„ç†ã€‚ä½¿å¾—å¼€å‘è€…å°†ç²¾åŠ›å…³æ³¨åœ¨ä¸šåŠ¡å¼€å‘ä¸Šï¼Œè€Œä¸æ˜¯å¼‚å¸¸æ•è·ä¸Šã€‚\nfail()çš„å®ç°ï¼Œå‚è§ä¸€ä¸‹å˜æ¢ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("ep.fail(callback); \n")])])]),t("p",[e._v("ç­‰ä»·äºï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("ep.fail(function (err) {\n callback(err);\n}); \n")])])]),t("p",[e._v("åˆç­‰ä»·äºï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("ep.bind('error', function (err) {\n // á‚‚å¸è½½æ‰æ‰€æœ‰æœ‰å¤„ç†å‡½æ•°\n ep.unbind();\n // å¼‚å¸¸å›è°ƒ\n callback(err);\n});\n")])])]),t("p",[e._v("done()çš„å®ç°ï¼Œå‚è§ä¸€ä¸‹å˜æ¢ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("ep.done('tpl');\n")])])]),t("p",[e._v("ç­‰ä»·äºï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("function (err, content) {\n if (err) {\n // ä¸€æ—¦å‘ç”Ÿå¼‚å¸¸ï¼Œä¸€å¾‹äº¤ç»™erroräº‹ä»¶å¤„ç†å‡½æ•°å¤„ç†\n return ep.emit('error', err);\n }\n ep.emit('tpl', content);\n} \n")])])]),t("p",[e._v("åŒæ—¶done()æ–¹æ³•æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("ep.done(function (content) {\n // TODO\n // æ— é¡»å…³æ³¨å¼‚å¸¸\n ep.emit('tpl', content);\n}); \n")])])]),t("p",[e._v("è¿™æ®µä»£ç ç­‰ä»·äºï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("function (err, content) {\n if (err) {\n // ä¸€æ—¦å‘ç”Ÿå¼‚å¸¸ï¼Œä¸€å¾‹äº¤ç»™erroräº‹ä»¶çš„å¤„ç†å‡½æ•°å¤„ç†\n return ep.emit('error', err);\n }\n (function (content) {\n // TODO\n // æ— é¡»å…³æ³¨å¼‚å¸¸\n ep.emit('tpl', content);\n }(content));\n} \n")])])]),t("h4",{attrs:{id:"promise-deferredæ¨¡å¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#promise-deferredæ¨¡å¼"}},[e._v("#")]),e._v(" Promise/Deferredæ¨¡å¼")]),e._v(" "),t("p",[e._v("å…ˆæ‰§è¡Œå¼‚æ­¥è°ƒç”¨ï¼Œå»¶è¿Ÿä¼ é€’å¤„ç†ã€‚")]),e._v(" "),t("h4",{attrs:{id:"promises-a"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#promises-a"}},[e._v("#")]),e._v(" Promises/A")]),e._v(" "),t("p",[e._v("Promise/Deferredæ¨¡å¼å…¶å®åªåŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå³Promiseå’ŒDeferredã€‚")]),e._v(" "),t("p",[e._v("Promiseçš„çŠ¶æ€è½¬åŒ–ç¤ºæ„å›¾ï¼š\n"),t("img",{attrs:{src:"/images/node/Promise%E7%9A%84%E7%8A%B6%E6%80%81%E8%BD%AC%E5%8C%96%E7%A4%BA%E6%84%8F%E5%9B%BE.png",alt:""}})]),e._v(" "),t("p",[e._v("ä¸€ä¸ªPromiseå¯¹è±¡åªè¦å…·å¤‡äº†then() æ–¹æ³•å³å¯ã€‚")]),e._v(" "),t("p",[e._v("then()æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("then(fulfilledHandler, errorHandler, progressHandler) \n")])])]),t("p",[e._v("é€šè¿‡Nodeçš„eventsæ¨¡å—æ¥å®Œæˆä¸€ä¸ªç®€å•å®ç°ã€‚")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("const events = require('events');\nvar EventEmitter = new events.EventEmitter();\nvar Promise = function () {\n    EventEmitter.call(this);\n};\nutil.inherits(Promise, EventEmitter);\nPromise.prototype.then = function (fulfilledHandler, errorHandler, progressHandler) {\n    if (typeof fulfilledHandler === 'function') {\n        // åˆ©ç”¨once()æ–¹æ³•ï¼Œä¿è¯æˆåŠŸå›è°ƒå‡½æ•°åªæ‰§è¡Œä¸€æ¬¡ã€‚\n        this.once('success', fulfilledHandler);\n    }\n    if (typeof errorHandler === 'function') {\n        // åˆ©ç”¨once()æ–¹æ³•ï¼Œä¿è¯å¼‚å¸¸å›è°ƒå‡½æ•°åªæ‰§è¡Œä¸€æ¬¡ã€‚\n        this.once('error', errorHandler);\n    }\n    if (typeof progressHandler === 'function') {\n        this.on('progress', progressHandler);\n    }\n    return this;\n};\n")])])]),t("p",[e._v("è§¦å‘æ‰§è¡Œè¿™äº›å›è°ƒå‡½æ•°çš„åœ°æ–¹ï¼Œå®ç°è¿™äº›åŠŸèƒ½çš„å¯¹è±¡é€šå¸¸è¢«ç§°ä¸º"),t("code",[e._v("Deferred")]),e._v(",å³å»¶è¿Ÿå¯¹è±¡ã€‚")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('var Deferred = function () {\n  this.state = "unfulfilled";\n  this.promise = new Promise();\n};\nDeferred.prototype.resolve = function (obj) {\n  this.state = "fulfilled";\n  this.promise.emit("success", obj);\n};\nDeferred.prototype.reject = function (err) {\n  this.state = "failed";\n  this.promise.emit("error", err);\n};\nDeferred.prototype.progress = function (data) {\n  this.promise.emit("progress", data);\n};\n')])])]),t("p",[t("img",{attrs:{src:"/images/node/promise%E7%8A%B6%E6%80%81%E4%B8%8E%E6%96%B9%E6%B3%95%E4%B9%8B%E9%97%B4%E7%9A%84%E5%9B%9E%E8%B0%83.png",alt:""}})]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("var promisify = function (res) { var deferred = new Deferred(); var result = '';\nres.on('data', function (chunk) {\n    result += chunk;\ndeferred.progress(chunk); });\nres.on('end', function () { deferred.resolve(result);\n});\nres.on('error', function (err) {\ndeferred.reject(err); });\nreturn deferred.promise; };\n")])])]),t("p",[e._v("å¦‚æ­¤å°±å¾—åˆ°ç®€å•çš„ç»“æœã€‚è¿™é‡Œè¿”å›"),t("code",[e._v("deferred.promise")]),e._v("çš„ç›®çš„æ˜¯ä¸ºäº†Â·ä¸è®©å¤–éƒ¨ç¨‹åºè°ƒç”¨resolveå’Œreject(),æ›´æ”¹å†…éƒ¨çŠ¶æ€çš„è¡Œä¸ºäº¤ç»™å®šä¹‰è€…å¤„ç†ã€‚")]),e._v(" "),t("p",[e._v("ç¤ºä¾‹ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('promisify(res).then(\n  function () {\n    // Done\n  },\n  function (err) {\n    // Error\n  },\n  function (chunk) {\n    // progress\n    console.log("BODY: " + chunk);\n  }\n);\n')])])]),t("p",[e._v("Promiseå’ŒDeferredæ•´ä½“å…³ç³»ç¤ºæ„å›¾:")]),e._v(" "),t("p",[t("img",{attrs:{src:"/images/node/Promise%E5%92%8CDeferred%E6%95%B4%E4%BD%93%E5%85%B3%E7%B3%BB%E7%A4%BA%E6%84%8F%E5%9B%BE.png",alt:""}}),e._v("\nä¸äº‹ä»¶å‘å¸ƒ/è®¢é˜…æ¨¡å¼ç›¸æ¯”ï¼ŒPromiseå’ŒDeferredæ¨¡å¼çš„APIæ¥å£å’ŒæŠ½è±¡æ¨¡å‹éƒ½ååˆ†ç®€æ´ã€‚ä»ä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå°†ä¸šåŠ¡ä¸­ä¸å¯å˜çš„éƒ¨åˆ†å°è£…åœ¨äº†Deferredä¸­ï¼Œå°†å¯å˜çš„éƒ¨åˆ†äº¤ç»™äº†Promiseã€‚\nQæ¨¡å—æ˜¯Promise/Aè§„èŒƒçš„ä¸€ä¸ªå®ç°ã€‚\nå®ƒå¯¹Nodeä¸­å¸¸è§å›è°ƒå‡½æ•°çš„Promiseå®ç°å¦‚ä¸‹ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("/**\n* Creates a Node-style callback that will resolve or reject the deferred\n* promise.\n* @returns a nodeback\n*/\ndefer.prototype.makeNodeResolver = function () {\n   var self = this;\n   return function (error, value) {\n       if (error) {\n           self.reject(error);\n       } else if (arguments.length > 2) {\n           self.resolve(array_slice(arguments, 1));\n       } else {\n           self.resolve(value);\n       }\n   };\n};\n")])])]),t("p",[t("code",[e._v("makeNodeResolver")]),e._v("è¿”å›ä¸€ä¸ªNodeé£æ ¼çš„å›è°ƒå‡½æ•°ã€‚\nå¯¹äºfs.readFile()çš„è°ƒç”¨ï¼Œæ¼”åŒ–ä¸ºå¦‚ä¸‹å½¢å¼ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('var readFile = function (file, encoding) {\n  var deferred = Q.defer();\n  fs.readFile(file, encoding, deferred.makeNodeResolver());\n  return deferred.promise;\n};\n// å®šä¹‰ä¹‹åçš„è°ƒç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š\nreadFile("foo.txt", "utf-8").then(\n  function (data) {\n    // Success case\n  },\n  function (err) {\n    // Failed case\n  }\n);\n\n')])])]),t("ol",{attrs:{start:"2"}},[t("li",[e._v("Promise ä¸­å¤šå¼‚æ­¥åä½œ\nPromiseä¸»è¦è§£å†³çš„æ˜¯å•ä¸ªå¼‚æ­¥æ“ä½œä¸­å­˜åœ¨çš„é—®é¢˜ã€‚å½“æˆ‘ä»¬éœ€è¦å¤„ç†å¤šä¸ªå¼‚æ­¥è°ƒç”¨ï¼Œè¯¥å¦‚ä½•ï¼Ÿ")])]),e._v(" "),t("p",[e._v("ç±»ä¼¼äºEventProxyï¼ŒåŸå‹å®ç°ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Deferred.prototype.all = function (promises) {\n  var count = promises.length;\n  var that = this;\n  var results = [];\n  promises.forEach(function (promise, i) {\n    promise.then(\n      function (data) {\n        count--;\n        results[i] = data;\n        if (count === 0) {\n          that.resolve(results);\n        }\n      },\n      function (err) {\n        that.reject(err);\n      }\n    );\n  });\n  return this.promise;\n};\n\n")])])]),t("p",[e._v("å¯¹äºå¤šæ¬¡æ–‡ä»¶çš„è¯»å–åœºæ™¯ï¼Œä»¥ä¸‹é¢çš„ä»£ç ä¸ºä¾‹ï¼Œall()æ–¹æ³•å°†ä¸¤ä¸ªå•ç‹¬çš„Promiseé‡æ–°æŠ½è±¡ç»„åˆæˆä¸€ä¸ªæ–°çš„Promiseï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('var promise1 = readFile("foo.txt", "utf-8");\nvar promise2 = readFile("bar.txt", "utf-8");\nvar deferred = new Deferred();\ndeferred.all([promise1, promise2]).then(function (results) {\n // TODO\n}, function (err) {\n // TODO\n}); \n')])])]),t("ol",{attrs:{start:"3"}},[t("li",[e._v("Promiseçš„è¿›é˜¶çŸ¥è¯†ã€‚")])]),e._v(" "),t("p",[e._v("æ¶é­”é‡‘å­—å¡”ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("obj.api1(function (value1) {\n  obj.api2(value1, function (value2) {\n    obj.api3(value2, function (value3) {\n      obj.api4(value3, function (value4) {\n        callback(value4);\n      });\n    });\n  });\n});\n")])])]),t("p",[e._v("æ‹†åˆ†ä¸Šè¿°ä»£ç ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("var handler1 = function (value1) {\n obj.api2(value1, handler2);\n};\nvar handler2 = function (value2) {\n obj.api3(value2, handler3);\n};\nvar handler3 = function (value3) {\n obj.api4(value3, hander4);\n};\nvar handler4 = function (value4) {\n callback(value4);\n});\nobj.api1(handler1); \n")])])]),t("p",[e._v("åˆ©ç”¨äº‹ä»¶çš„å¼€å‘è€…ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('var emitter = new event.Emitter();\nemitter.on("step1", function () {\n obj.api1(function (value1) {\n emitter.emit("step2", value1);\n });\n});\nemitter.on("step2", function (value1) {\n obj.api2(value1, function (value2) {\n emitter.emit("step3", value2);\n });\n});\nemitter.on("step3", function (value2) {\n obj.api3(value2, function (value3) {\n emitter.emit("step4", value3);\n });\n});\nemitter.on("step4", function (value3) {\n obj.api4(value3, function (value4) {\n callback(value4);\n });\n}); \nemitter.emit("step1"); \n')])])]),t("ul",[t("li",[e._v("æ”¯æŒåºåˆ—æ‰§è¡Œçš„Promise\né“¾å¼è°ƒç”¨ï¼š")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("promise()\n .then(obj.api1)\n .then(obj.api2)\n .then(obj.api3)\n .then(obj.api4)\n .then(function (value4) {\n // Do something with value4\n }, function (error) {\n // Handle any error from step1 through step4\n })\n .done(); \n")])])]),t("p",[e._v("ä¼˜åŒ–åï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('var Deferred = function () {\n  this.promise = new Promise();\n};\n// å®Œæˆæ€\nDeferred.prototype.resolve = function (obj) {\n  var promise = this.promise;\n  var handler;\n  while ((handler = promise.queue.shift())) {\n    if (handler && handler.fulfilled) {\n      var ret = handler.fulfilled(obj);\n      if (ret && ret.isPromise) {\n        ret.queue = promise.queue;\n        this.promise = ret;\n        return;\n      }\n    }\n  }\n};\n// å¤±è´¥æ€\nDeferred.prototype.reject = function (err) {\n  var promise = this.promise;\n  var handler;\n  while ((handler = promise.queue.shift())) {\n    if (handler && handler.error) {\n      var ret = handler.error(err);\n      if (ret && ret.isPromise) {\n        ret.queue = promise.queue;\n        this.promise = ret;\n        return;\n      }\n    }\n  }\n};\n// ç”Ÿæˆå›è°ƒå‡½æ•°\nDeferred.prototype.callback = function () {\n  var that = this;\n  return function (err, file) {\n    if (err) {\n      return that.reject(err);\n    }\n    that.resolve(file);\n  };\n};\nvar Promise = function () {\n  // é˜Ÿåˆ—ç”¨äºå­˜å‚¨æ‰§è¡Œçš„å›è°ƒå‡½æ•°\n  this.queue = [];\n  this.isPromise = true;\n};\nPromise.prototype.then = function (\n  fulfilledHandler,\n  errorHandler,\n  progressHandler\n) {\n  var handler = {};\n  if (typeof fulfilledHandler === "function") {\n    handler.fulfilled = fulfilledHandler;\n  }\n  if (typeof errorHandler === "function") {\n    handler.error = errorHandler;\n  }\n  this.queue.push(handler);\n  return this;\n};\n\n')])])]),t("p",[e._v("è¿™é‡Œæˆ‘ä»¬ä»¥ä¸¤æ¬¡æ–‡ä»¶è¯»å–ä½œä¸ºä¾‹å­ï¼Œä»¥éªŒè¯è¯¥è®¾è®¡çš„å¯è¡Œæ€§ã€‚è¿™é‡Œå‡è®¾è¯»å–ç¬¬äºŒä¸ªæ–‡ä»¶æ˜¯ä¾\nèµ–äºç¬¬ä¸€ä¸ªæ–‡ä»¶ä¸­çš„å†…å®¹çš„ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("var readFile1 = function (file, encoding) {\n var deferred = new Deferred();\n fs.readFile(file, encoding, deferred.callback());\n return deferred.promise;\n};\nvar readFile2 = function (file, encoding) {\n var deferred = new Deferred();\n fs.readFile(file, encoding, deferred.callback());\n return deferred.promise;\n};\nreadFile1('file1.txt', 'utf8').then(function (file1) {\n return readFile2(file1.trim(), 'utf8');\n}).then(function (file2) {\n console.log(file2);\n}); \n")])])]),t("h4",{attrs:{id:"æµç¨‹æ§åˆ¶åº“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æµç¨‹æ§åˆ¶åº“"}},[e._v("#")]),e._v(" æµç¨‹æ§åˆ¶åº“")]),e._v(" "),t("p",[e._v("æœ€ä¸ºä¸»æµçš„æ¨¡å¼â€”â€”äº‹ä»¶å‘å¸ƒ/è®¢é˜…æ¨¡å¼å’ŒPromise/Deferredæ¨¡å¼ï¼Œ")]),e._v(" "),t("ol",[t("li",[e._v("å°¾è§¦å‘ä¸Next")])]),e._v(" "),t("p",[e._v("é™¤äº†äº‹ä»¶å’ŒPromiseå¤–ï¼Œè¿˜æœ‰ä¸€ç±»æ–¹æ³•æ˜¯éœ€è¦æ‰‹å·¥è°ƒç”¨æ‰èƒ½æŒç»­æ‰§è¡Œåç»­è°ƒç”¨çš„ï¼Œæˆ‘ä»¬å°†æ­¤ç±»æ–¹æ³•å«åš"),t("code",[e._v("å°¾è§¦å‘")]),e._v("ï¼Œå¸¸è§çš„å…³é”®è¯æ˜¯"),t("code",[e._v("next")]),e._v("ã€‚äº‹å®ä¸Šï¼Œå°¾è§¦å‘ç›®å‰åº”ç”¨æœ€å¤šçš„åœ°æ–¹æ˜¯Connectçš„ä¸­é—´ä»¶ã€‚")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("var app = connect();\n// Middleware\napp.use(connect.staticCache());\napp.use(connect.static(__dirname + '/public'));\napp.use(connect.cookieParser());\napp.use(connect.session());\napp.use(connect.query());\napp.use(connect.bodyParser());\napp.use(connect.csrf());\napp.listen(3001); \n")])])]),t("p",[e._v("åœ¨é€šè¿‡use()æ–¹æ³•æ³¨å†Œå¥½ä¸€ç³»åˆ—ä¸­é—´ä»¶åï¼Œç›‘å¬ç«¯å£ä¸Šçš„è¯·æ±‚ã€‚ä¸­é—´ä»¶åˆ©ç”¨äº†å°¾è§¦å‘çš„æœºåˆ¶ï¼Œ\næœ€ç®€å•çš„ä¸­é—´ä»¶å¦‚ä¸‹ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("function (req, res, next) {\n // ä¸­é—´ä»¶\n} \n")])])]),t("p",[e._v("æ¯ä¸ªä¸­é—´ä»¶ä¼ é€’è¯·æ±‚å¯¹è±¡ã€å“åº”å¯¹è±¡å’Œå°¾è§¦å‘å‡½æ•°ï¼Œé€šè¿‡é˜Ÿåˆ—å½¢æˆä¸€ä¸ªå¤„ç†æµ\n"),t("img",{attrs:{src:"/images/node/%E4%B8%AD%E9%97%B4%E4%BB%B6%E9%80%9A%E8%BF%87%E9%98%9F%E5%88%97%E5%BD%A2%E6%88%90%E4%B8%80%E4%B8%AA%E5%A4%84%E7%90%86%E6%B5%81.png",alt:""}})]),e._v(" "),t("p",[e._v("ä¸­é—´ä»¶æœºåˆ¶ä½¿å¾—åœ¨å¤„ç†ç½‘ç»œè¯·æ±‚æ—¶ï¼Œå¯ä»¥åƒé¢å‘åˆ‡é¢ç¼–ç¨‹ä¸€æ ·è¿›è¡Œè¿‡æ»¤ã€éªŒè¯ã€æ—¥å¿—ç­‰åŠŸèƒ½ï¼Œè€Œä¸ä¸å…·ä½“ä¸šåŠ¡é€»è¾‘äº§ç”Ÿå…³è”ï¼Œä»¥è‡´äº§ç”Ÿè€¦åˆã€‚\nConnectçš„æ ¸å¿ƒå®ç°")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("function createServer() {\n  // åˆ›å»ºäº†HTTPæœåŠ¡å™¨çš„requestäº‹ä»¶å¤„ç†å‡½æ•°ï¼š\n function app(req, res){ app.handle(req, res); }\n utils.merge(app, proto);\n utils.merge(app, EventEmitter.prototype);\n app.route = '/';\n // stackå±æ€§æ˜¯è¿™ä¸ªæœåŠ¡å™¨å†…éƒ¨ç»´æŠ¤çš„ä¸­é—´ä»¶é˜Ÿåˆ—ã€‚é€šè¿‡è°ƒç”¨use()æ–¹æ³•æˆ‘ä»¬å¯ä»¥å°†ä¸­é—´ä»¶æ”¾è¿›é˜Ÿåˆ—ä¸­\n app.stack = [];\n for (var i = 0; i < arguments.length; ++i) {\n app.use(arguments[i]);\n }\n return app;\n};\n")])])]),t("p",[e._v("use()æ–¹æ³•çš„é‡è¦éƒ¨åˆ†")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("app.use = function(route, fn){\n // some code\n this.stack.push({ route: route, handle: fn });\n return this;\n")])])]),t("p",[e._v("ç›‘å¬å‡½æ•°çš„å®ç°å¦‚ä¸‹ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("app.listen = function(){\n var server = http.createServer(this);\n return server.listen.apply(server, arguments);\n};\n")])])]),t("p",[e._v("æœ€ç»ˆå›åˆ°app.handle()æ–¹æ³•ï¼Œæ¯ä¸€ä¸ªç›‘å¬åˆ°çš„ç½‘ç»œè¯·æ±‚éƒ½å°†ä»è¿™é‡Œå¼€å§‹å¤„ç†ã€‚è¯¥æ–¹æ³•çš„ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("app.handle = function(req, res, out) {\n // some code\n next();\n}; \n")])])]),t("p",[e._v("åŸå§‹çš„next()æ–¹æ³•è¾ƒä¸ºå¤æ‚ï¼Œä¸‹é¢æ˜¯ç®€åŒ–åçš„å†…å®¹ï¼Œå…¶åŸç†ååˆ†ç®€å•ï¼Œå–å‡ºé˜Ÿåˆ—ä¸­çš„ä¸­é—´ä»¶å¹¶æ‰§è¡Œï¼ŒåŒæ—¶ä¼ å…¥å½“å‰æ–¹æ³•ä»¥å®ç°é€’å½’è°ƒç”¨ï¼Œè¾¾åˆ°æŒç»­è§¦å‘çš„ç›®çš„ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("function next(err) {\n // some code\n // next callback\n layer = stack[index++];\n layer.handle(req, res, next);\n} \n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[e._v("æµç¨‹æ§åˆ¶æ¨¡å—async")])]),e._v(" "),t("ul",[t("li",[e._v("å¼‚æ­¥çš„ä¸²è¡Œæ‰§è¡Œ\nasyncæ˜¯å¦‚ä½•è§£å†³â€œæ¶é­”é‡‘å­—å¡”â€é—®é¢˜çš„ã€‚\nasyncæä¾›äº†series()æ–¹æ³•æ¥å®ç°ä¸€ç»„ä»»åŠ¡çš„ä¸²è¡Œæ‰§è¡Œï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("var fs = require('fs');\nvar async = require(\"async\");\nasync.series([\n function (callback) {\n fs.readFile('file1.txt', 'utf-8', callback);\n },\n function (callback) {\n fs.readFile('file2.txt', 'utf-8', callback);\n }\n], function (err, results) {\n // results => [file1.txt, file2.txt]\n}); \n")])])]),t("p",[e._v("è¿™æ®µä»£ç ç­‰ä»·äº:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("var fs = require('fs');\nvar async = require(\"async\");\nfs.readFile('file1.txt', 'utf-8', function (err, content) {\n if (err) {\n return callback(err);\n }\n fs.readFile('file2.txt ', 'utf-8', function (err, data) {\n if (err) {\n return callback(err);\n }\n callback(null, [content, data]);\n });\n}); \n")])])]),t("p",[e._v("series()æ–¹æ³•ä¸­ä¼ å…¥çš„å‡½æ•°callback()å¹¶éç”±ä½¿ç”¨è€…æŒ‡å®šã€‚äº‹å®ä¸Šï¼Œæ­¤å¤„çš„å›è°ƒå‡½æ•°ç”±asyncé€šè¿‡é«˜é˜¶å‡½æ•°çš„æ–¹å¼æ³¨å…¥ï¼Œè¿™é‡Œéšå«äº†ç‰¹æ®Šçš„é€»è¾‘ã€‚æ¯ä¸ªcallback()æ‰§è¡Œæ—¶ä¼šå°†ç»“æœä¿å­˜èµ·æ¥ï¼Œç„¶åæ‰§è¡Œä¸‹ä¸€ä¸ªè°ƒç”¨ï¼Œç›´åˆ°ç»“æŸæ‰€æœ‰è°ƒç”¨ã€‚æœ€ç»ˆ\nçš„å›è°ƒå‡½æ•°æ‰§è¡Œæ—¶ï¼Œé˜Ÿåˆ—é‡Œçš„å¼‚æ­¥è°ƒç”¨ä¿å­˜çš„ç»“æœä»¥æ•°ç»„çš„æ–¹å¼ä¼ å…¥ã€‚è¿™é‡Œçš„å¼‚å¸¸å¤„ç†è§„åˆ™æ˜¯ä¸€\næ—¦å‡ºç°å¼‚å¸¸ï¼Œå°±ç»“æŸæ‰€æœ‰è°ƒç”¨ï¼Œå¹¶å°†å¼‚å¸¸ä¼ é€’ç»™æœ€ç»ˆå›è°ƒå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚")]),e._v(" "),t("ul",[t("li",[e._v("å¼‚æ­¥çš„å¹¶è¡Œæ‰§è¡Œ\nå½“æˆ‘ä»¬éœ€è¦é€šè¿‡å¹¶è¡Œæ¥æå‡æ€§èƒ½æ—¶ï¼Œasyncæä¾›äº†parallel()æ–¹æ³•ï¼Œç”¨ä»¥å¹¶è¡Œæ‰§è¡Œä¸€äº›å¼‚æ­¥æ“ä½œã€‚ä»¥ä¸‹ä¸ºè¯»å–ä¸¤ä¸ªæ–‡ä»¶çš„å¹¶è¡Œç‰ˆæœ¬ï¼š")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("async.parallel([\n function (callback) {\n fs.readFile('file1.txt', 'utf-8', callback);\n },\n function (callback) {\n fs.readFile('file2.txt', 'utf-8', callback);\n }\n], function (err, results) {\n // results => [file1.txt, file2.txt]\n});\n")])])]),t("p",[e._v("ç­‰ä»·äº:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("var counter = 2;\nvar results = [];\nvar done = function (index, value) {\n results[index] = value;\n counter--;\n if (counter === 0) {\n callback(null, results);\n }\n};\n// åªä¼ é€’ç¬¬ä¸€ä¸ªå¼‚å¸¸\nvar hasErr = false;\nvar fail = function (err) {\n if (!hasErr) {\n hasErr = true;\n callback(err);\n }\n};\nfs.readFile('file1.txt', 'utf-8', function (err, content) {\n if (err) {\n return fail(err);\n }\n done(0, content);\n});\nfs.readFile('file2.txt', 'utf-8', function (err, data) {\n if (err) {\n return fail(err);\n }\n done(1, data);\n});\n")])])]),t("ul",[t("li",[e._v("å¼‚æ­¥è°ƒç”¨çš„ä¾èµ–å¤„ç†\nseries()é€‚åˆæ— ä¾èµ–çš„å¼‚æ­¥ä¸²è¡Œæ‰§è¡Œï¼Œä½†å½“å‰ä¸€ä¸ªçš„ç»“æœæ˜¯åä¸€ä¸ªè°ƒç”¨çš„è¾“å…¥æ—¶ï¼Œseries()æ–¹æ³•å°±æ— æ³•æ»¡è¶³éœ€æ±‚äº†ã€‚æ‰€å¹¸ï¼Œè¿™ç§å…¸å‹åœºæ™¯çš„éœ€æ±‚ï¼Œasyncæä¾›äº†"),t("code",[e._v("waterfall()")]),e._v("æ–¹æ³•æ¥æ»¡è¶³ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("async.waterfall([\n function (callback) {\n fs.readFile('file1.txt', 'utf-8', function (err, content) {\n callback(err, content);\n });\n },\n function (arg1, callback) {\n // arg1 => file2.txt\n fs.readFile(arg1, 'utf-8', function (err, content) {\n callback(err, content);\n });\n },\n function(arg1, callback){\n // arg1 => file3.txt\n fs.readFile(arg1, 'utf-8', function (err, content) {\n callback(err, content);\n });\n }\n], function (err, result) {\n // result => file4.txt\n});\n")])])]),t("p",[e._v("ç­‰ä»·äº:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("fs.readFile('file1.txt', 'utf-8', function (err, data1) {\n if (err) {\n return callback(err);\n }\n fs.readFile(data1, 'utf-8', function (err, data2) {\n if (err) {\n return callback(err);\n }\n fs.readFile(data2, 'utf-8', function (err, data3) {\n if (err) {\n return callback(err);\n }\n callback(null, data3);\n });\n });\n}); \n")])])]),t("ul",[t("li",[e._v("è‡ªåŠ¨ä¾èµ–å¤„ç†(auto)\nauto()æ–¹æ³•èƒ½æ ¹æ®ä¾èµ–å…³ç³»è‡ªåŠ¨åˆ†æï¼Œä»¥æœ€ä½³çš„é¡ºåºæ‰§è¡Œä»¥ä¸Šä¸šåŠ¡ï¼š\nasync.auto(deps);")])]),e._v(" "),t("ol",{attrs:{start:"3"}},[t("li",[e._v("Step\nStepä¸å‰é¢ä»‹ç»çš„äº‹ä»¶æ¨¡å¼ã€Promiseç”šè‡³asyncéƒ½ä¸åŒçš„ä¸€ç‚¹åœ¨äºStepç”¨åˆ°äº†thiså…³é”®å­—ã€‚äº‹å®ä¸Šï¼Œå®ƒæ˜¯Stepå†…éƒ¨çš„ä¸€ä¸ªnext()æ–¹æ³•ï¼Œå°†å¼‚æ­¥è°ƒç”¨çš„ç»“æœä¼ é€’ç»™ä¸‹ä¸€ä¸ªä»»åŠ¡ä½œä¸ºå‚æ•°ï¼Œå¹¶è°ƒç”¨æ‰§è¡Œã€‚\né€šè¿‡npm install stepå³å¯å®‰è£…ä½¿ç”¨ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Step(task1, task2, task3);\n")])])]),t("p",[e._v("Stepæ¥å—ä»»æ„æ•°é‡çš„ä»»åŠ¡ï¼Œæ‰€æœ‰çš„ä»»åŠ¡éƒ½å°†ä¼šä¸²è¡Œä¾æ¬¡æ‰§è¡Œã€‚ä¸‹é¢çš„ç¤ºä¾‹ä»£ç å°†ä¾æ¬¡è¯»å–æ–‡ä»¶ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Step(\n function readFile1() {\n fs.readFile('file1.txt', 'utf-8', this);\n },\n function readFile2(err, content) {\n fs.readFile('file2.txt', 'utf-8', this);\n },\n function done(err, content) {\n console.log(content);\n }\n);\n")])])]),t("ul",[t("li",[e._v("å¹¶è¡Œä»»åŠ¡æ‰§è¡Œ\nStepå¦‚ä½•å®ç°å¤šä¸ªå¼‚æ­¥ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œå‘¢ï¼Ÿthiså…·æœ‰ä¸€ä¸ªparallel()æ–¹æ³•ï¼Œå®ƒå‘Šè¯‰Stepï¼Œéœ€è¦ç­‰æ‰€æœ‰ä»»åŠ¡å®Œæˆæ—¶æ‰è¿›è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Step(\n function readFile1() {\n fs.readFile('file1.txt', 'utf-8', this.parallel());\n fs.readFile('file2.txt', 'utf-8', this.parallel());\n },\n function done(err, content1, content2) {\n // content1 => file1\n // content2 => file2\n console.log(arguments);\n }\n);\n")])])]),t("p",[e._v("ä½¿ç”¨parallel()çš„æ—¶å€™éœ€è¦å°å¿ƒçš„æ˜¯ï¼Œå¦‚æœå¼‚æ­¥æ–¹æ³•çš„ç»“æœä¼ å›çš„æ˜¯å¤šä¸ªå‚æ•°ï¼ŒStepå°†åªä¼šå–å‰ä¸¤ä¸ªå‚æ•°ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("var asyncCall = function (callback) {\n process.nextTick(function () {\n // åœ¨è°ƒç”¨parallel()æ—¶ï¼Œresult2å°†ä¼šè¢«ä¸¢å¼ƒã€‚\n callback(null, 'result1', 'result2');\n });\n};\n")])])]),t("p",[e._v("Stepæä¾›çš„å¦å¤–ä¸€ä¸ªæ–¹æ³•æ˜¯group()ï¼Œå®ƒç±»ä¼¼äºparallel()çš„æ•ˆæœï¼Œä½†æ˜¯åœ¨ç»“æœä¼ é€’ä¸Šç•¥æœ‰ä¸åŒã€‚ä¸‹é¢çš„ä»£ç ç”¨äºè¯»å–ä¸€ä¸ªç›®å½•ï¼Œç„¶åè¿­ä»£å…¶ä¸­æ–‡ä»¶çš„æ“ä½œï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Step(\n function readDir() {\n fs.readdir(__dirname, this);\n },\n function readFiles(err, results) {\n if (err) throw err;\n // Create a new group\n var group = this.group();\n results.forEach(function (filename) {\n if (/\\.js$/.test(filename)) {\n fs.readFile(__dirname + \"/\" + filename, 'utf8', group());\n }\n });\n },\n function showAll(err, files) {\n if (err) throw err;\n console.dir(files);\n }\n); \n")])])]),t("p",[e._v("æœ‰ä¸¤æ¬¡group()çš„è°ƒç”¨ã€‚ç¬¬ä¸€æ¬¡è°ƒç”¨æ˜¯å‘ŠçŸ¥Stepè¦å¹¶è¡Œæ‰§è¡Œï¼Œç¬¬äºŒæ¬¡è°ƒç”¨çš„ç»“æœå°†ä¼šç”Ÿæˆä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè€Œå›è°ƒå‡½æ•°æ¥å—çš„è¿”å›å€¼å°†ä¼šæŒ‰ç»„å­˜å‚¨ã€‚parallel()ä¼ é€’ç»™ä¸‹ä¸€ä¸ªä»»åŠ¡çš„ç»“æœæ˜¯å¦‚ä¸‹å½¢å¼ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("function (err, result1, result2, ...);\n")])])]),t("p",[e._v("group()ä¼ é€’çš„ç»“æœæ˜¯ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("function (err, results);\n")])])]),t("p",[e._v("è¿™ä¸ªå‡½æ•°è¿”å›çš„æ•°æ®ä¿å­˜åœ¨æ•°ç»„ä¸­ã€‚")]),e._v(" "),t("h3",{attrs:{id:"å¼‚æ­¥å¹¶å‘æ§åˆ¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¼‚æ­¥å¹¶å‘æ§åˆ¶"}},[e._v("#")]),e._v(" å¼‚æ­¥å¹¶å‘æ§åˆ¶")]),e._v(" "),t("p",[e._v("åœ¨Nodeä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ååˆ†æ–¹ä¾¿åœ°åˆ©ç”¨å¼‚æ­¥å‘èµ·å¹¶è¡Œè°ƒç”¨ã€‚ä½¿ç”¨ä¸‹é¢çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾å‘èµ·100æ¬¡å¼‚æ­¥è°ƒç”¨ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("for (var i = 0, i < 100; i++) {\n async();\n}\n")])])]),t("p",[e._v("ä½†æ˜¯å¦‚æœå¹¶å‘é‡è¿‡å¤§ï¼Œæˆ‘ä»¬çš„ä¸‹å±‚æœåŠ¡å™¨å°†ä¼šåƒä¸æ¶ˆã€‚å¦‚æœæ˜¯å¯¹æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå¤§é‡å¹¶å‘è°ƒç”¨ï¼Œæ“ä½œç³»ç»Ÿçš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡å°†ä¼šè¢«ç¬é—´ç”¨å…‰ï¼ŒæŠ›å‡ºå¦‚ä¸‹é”™è¯¯ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Error: EMFILE, too many open files\n")])])]),t("h4",{attrs:{id:"asyncçš„è§£å†³æ–¹æ¡ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#asyncçš„è§£å†³æ–¹æ¡ˆ"}},[e._v("#")]),e._v(" asyncçš„è§£å†³æ–¹æ¡ˆ")]),e._v(" "),t("p",[e._v("asyncä¹Ÿæä¾›äº†ä¸€ä¸ªæ–¹æ³•ç”¨äºå¤„ç†å¼‚æ­¥è°ƒç”¨çš„é™åˆ¶ï¼šparallelLimit()ã€‚å¦‚ä¸‹æ˜¯asyncçš„ç¤ºä¾‹ä»£ç ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("async.parallelLimit([\n function (callback) {\n fs.readFile('file1.txt', 'utf-8', callback);\n },\n function (callback) {\n fs.readFile('file2.txt', 'utf-8', callback);\n }\n], 1, function (err, results) {\n // TODO\n}); \n")])])]),t("p",[e._v("parallelLimit()ä¸parallel()ç±»ä¼¼ï¼Œä½†å¤šäº†ä¸€ä¸ªç”¨äºé™åˆ¶å¹¶å‘æ•°é‡çš„å‚æ•°ï¼Œä½¿å¾—ä»»åŠ¡åªèƒ½åŒæ—¶å¹¶å‘ä¸€å®šæ•°é‡ï¼Œè€Œä¸æ˜¯æ— é™åˆ¶å¹¶å‘ã€‚")])])}),[],!1,null,null,null);n.default=r.exports}}]);