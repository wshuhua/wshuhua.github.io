<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>å¼‚æ­¥ç¼–ç¨‹ | Wsh&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/images/logo.png">
    <meta name="description" content="webå‰ç«¯æŠ€æœ¯åšå®¢,ä¸“æ³¨webå‰ç«¯å­¦ä¹ ä¸æ€»ç»“ã€‚JavaScript,js,ES6,TypeScript,vue,React,python,css3,html5,Node,git,githubç­‰æŠ€æœ¯æ–‡ç« ã€‚">
    
    <link rel="preload" href="/assets/css/0.styles.bc63fb2f.css" as="style"><link rel="preload" href="/assets/js/app.2240256e.js" as="script"><link rel="preload" href="/assets/js/2.dc8a2400.js" as="script"><link rel="preload" href="/assets/js/36.810c79b4.js" as="script"><link rel="prefetch" href="/assets/js/10.0e927a4e.js"><link rel="prefetch" href="/assets/js/11.0c7b912c.js"><link rel="prefetch" href="/assets/js/12.f8872b43.js"><link rel="prefetch" href="/assets/js/13.2799a35f.js"><link rel="prefetch" href="/assets/js/14.792f8f9e.js"><link rel="prefetch" href="/assets/js/15.da56f803.js"><link rel="prefetch" href="/assets/js/16.7ac59715.js"><link rel="prefetch" href="/assets/js/17.b8b5ac23.js"><link rel="prefetch" href="/assets/js/18.3721b0a6.js"><link rel="prefetch" href="/assets/js/19.90242a39.js"><link rel="prefetch" href="/assets/js/20.33a6b051.js"><link rel="prefetch" href="/assets/js/21.bce2654d.js"><link rel="prefetch" href="/assets/js/22.a08c5355.js"><link rel="prefetch" href="/assets/js/23.a986cb8d.js"><link rel="prefetch" href="/assets/js/24.28d6d2c0.js"><link rel="prefetch" href="/assets/js/25.98196063.js"><link rel="prefetch" href="/assets/js/26.15954f42.js"><link rel="prefetch" href="/assets/js/27.355a2c34.js"><link rel="prefetch" href="/assets/js/28.213c5fc9.js"><link rel="prefetch" href="/assets/js/29.3cf944cc.js"><link rel="prefetch" href="/assets/js/3.d992d6bf.js"><link rel="prefetch" href="/assets/js/30.57b0197a.js"><link rel="prefetch" href="/assets/js/31.9b24408e.js"><link rel="prefetch" href="/assets/js/32.3bc1077f.js"><link rel="prefetch" href="/assets/js/33.74ecbdec.js"><link rel="prefetch" href="/assets/js/34.ec3bc0c5.js"><link rel="prefetch" href="/assets/js/35.c9e04cb2.js"><link rel="prefetch" href="/assets/js/37.2a3a16fb.js"><link rel="prefetch" href="/assets/js/38.9eb8aa72.js"><link rel="prefetch" href="/assets/js/39.f7abe3b6.js"><link rel="prefetch" href="/assets/js/4.c704e751.js"><link rel="prefetch" href="/assets/js/40.59ffaf24.js"><link rel="prefetch" href="/assets/js/41.e8969b60.js"><link rel="prefetch" href="/assets/js/42.48e99828.js"><link rel="prefetch" href="/assets/js/43.a8a6aa23.js"><link rel="prefetch" href="/assets/js/44.ee19f718.js"><link rel="prefetch" href="/assets/js/45.68820990.js"><link rel="prefetch" href="/assets/js/46.9d63c8e1.js"><link rel="prefetch" href="/assets/js/47.6b05e690.js"><link rel="prefetch" href="/assets/js/48.c464a1ff.js"><link rel="prefetch" href="/assets/js/49.8b3717e6.js"><link rel="prefetch" href="/assets/js/5.2db75e05.js"><link rel="prefetch" href="/assets/js/50.00d7a8a7.js"><link rel="prefetch" href="/assets/js/51.41159828.js"><link rel="prefetch" href="/assets/js/52.045090e7.js"><link rel="prefetch" href="/assets/js/53.83d35a40.js"><link rel="prefetch" href="/assets/js/54.f8efe4f4.js"><link rel="prefetch" href="/assets/js/55.753ec7ea.js"><link rel="prefetch" href="/assets/js/56.65b74be4.js"><link rel="prefetch" href="/assets/js/57.f7d5fa72.js"><link rel="prefetch" href="/assets/js/58.23d4d81f.js"><link rel="prefetch" href="/assets/js/59.3caa2c43.js"><link rel="prefetch" href="/assets/js/6.9073f8bb.js"><link rel="prefetch" href="/assets/js/60.38a02be9.js"><link rel="prefetch" href="/assets/js/61.62eb52a6.js"><link rel="prefetch" href="/assets/js/62.b93f4b0a.js"><link rel="prefetch" href="/assets/js/63.8523926d.js"><link rel="prefetch" href="/assets/js/64.cff11d18.js"><link rel="prefetch" href="/assets/js/65.2c794711.js"><link rel="prefetch" href="/assets/js/66.ff853efa.js"><link rel="prefetch" href="/assets/js/67.5642e2f9.js"><link rel="prefetch" href="/assets/js/68.0d3d7b4e.js"><link rel="prefetch" href="/assets/js/69.b7d2bc7d.js"><link rel="prefetch" href="/assets/js/7.733f78a6.js"><link rel="prefetch" href="/assets/js/70.69edd879.js"><link rel="prefetch" href="/assets/js/71.7afad00a.js"><link rel="prefetch" href="/assets/js/72.fdf258f8.js"><link rel="prefetch" href="/assets/js/73.50bc6e2b.js"><link rel="prefetch" href="/assets/js/74.06db5725.js"><link rel="prefetch" href="/assets/js/75.b9434d8d.js"><link rel="prefetch" href="/assets/js/76.d1a90878.js"><link rel="prefetch" href="/assets/js/77.a5b23bd2.js"><link rel="prefetch" href="/assets/js/78.5259ff6e.js"><link rel="prefetch" href="/assets/js/79.0a2e7b36.js"><link rel="prefetch" href="/assets/js/8.c53fd8de.js"><link rel="prefetch" href="/assets/js/80.467f3aed.js"><link rel="prefetch" href="/assets/js/81.6d667128.js"><link rel="prefetch" href="/assets/js/82.73d4436f.js"><link rel="prefetch" href="/assets/js/83.0603301b.js"><link rel="prefetch" href="/assets/js/9.d60910cc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.bc63fb2f.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/1.gif" alt="Wsh's blog" class="logo"> <span class="site-name can-hide">Wsh's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="çŸ¥è¯†ğŸ‘–" class="dropdown-title"><a href="/note/" class="link-title">çŸ¥è¯†ğŸ‘–</a> <span class="title" style="display:none;">çŸ¥è¯†ğŸ‘–</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/cache/" class="nav-link">å‰ç«¯ç¼“å­˜</a></li><li class="dropdown-item"><!----> <a href="/note/react/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/note/typescript/" class="nav-link">typescript</a></li><li class="dropdown-item"><!----> <a href="/note/javascript/" class="nav-link">javascript</a></li><li class="dropdown-item"><!----> <a href="/note/flutter/" class="nav-link">flutter</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å·¥ç¨‹ğŸŒ¹" class="dropdown-title"><a href="/tool/" class="link-title">å·¥ç¨‹ğŸŒ¹</a> <span class="title" style="display:none;">å·¥ç¨‹ğŸŒ¹</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool/node/" class="nav-link">node</a></li><li class="dropdown-item"><!----> <a href="/tool/webpack/" class="nav-link">webpack</a></li></ul></div></div><div class="nav-item"><a href="/note/algorithm/" class="nav-link">è½»æ¾ä¸€åˆ»ğŸ˜‰</a></div><div class="nav-item"><a href="/pages/ca0c25/" class="nav-link">å®åº“ğŸ“°</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•ğŸ”’" class="dropdown-title"><a href="/archives/" class="link-title">ç´¢å¼•ğŸ”’</a> <span class="title" style="display:none;">ç´¢å¼•ğŸ”’</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><a href="https://blog.fudenglong.site" target="_blank" rel="noopener noreferrer" class="nav-link external">
  é¾™å“¥çš„å¤§ğŸ‚ä¹‹è·¯
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/wshuhua" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/images/avatar.gif"> <div class="blogger-info"><h3>wsh</h3> <span>çƒ­çˆ±å‰ç«¯çš„ç¨‹åºåª›</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="çŸ¥è¯†ğŸ‘–" class="dropdown-title"><a href="/note/" class="link-title">çŸ¥è¯†ğŸ‘–</a> <span class="title" style="display:none;">çŸ¥è¯†ğŸ‘–</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/cache/" class="nav-link">å‰ç«¯ç¼“å­˜</a></li><li class="dropdown-item"><!----> <a href="/note/react/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/note/typescript/" class="nav-link">typescript</a></li><li class="dropdown-item"><!----> <a href="/note/javascript/" class="nav-link">javascript</a></li><li class="dropdown-item"><!----> <a href="/note/flutter/" class="nav-link">flutter</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å·¥ç¨‹ğŸŒ¹" class="dropdown-title"><a href="/tool/" class="link-title">å·¥ç¨‹ğŸŒ¹</a> <span class="title" style="display:none;">å·¥ç¨‹ğŸŒ¹</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool/node/" class="nav-link">node</a></li><li class="dropdown-item"><!----> <a href="/tool/webpack/" class="nav-link">webpack</a></li></ul></div></div><div class="nav-item"><a href="/note/algorithm/" class="nav-link">è½»æ¾ä¸€åˆ»ğŸ˜‰</a></div><div class="nav-item"><a href="/pages/ca0c25/" class="nav-link">å®åº“ğŸ“°</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•ğŸ”’" class="dropdown-title"><a href="/archives/" class="link-title">ç´¢å¼•ğŸ”’</a> <span class="title" style="display:none;">ç´¢å¼•ğŸ”’</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><a href="https://blog.fudenglong.site" target="_blank" rel="noopener noreferrer" class="nav-link external">
  é¾™å“¥çš„å¤§ğŸ‚ä¹‹è·¯
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/wshuhua" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span> æ·±å…¥æµ…å‡ºnode</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/2586cb/" class="sidebar-link">nodeä»‹ç»</a></li><li><a href="/pages/5d2c54/" class="sidebar-link">æ¨¡å—æœºåˆ¶</a></li><li><a href="/pages/1b14a3/" class="sidebar-link">å¼‚æ­¥I/Oæ“ä½œ</a></li><li><a href="/pages/ec8dfa/" aria-current="page" class="active sidebar-link">å¼‚æ­¥ç¼–ç¨‹</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/4fe0f1/" class="sidebar-link">å†…å­˜æ§åˆ¶</a></li><li><a href="/pages/84c133/" class="sidebar-link">ç†è§£Buffer</a></li><li><a href="/pages/5d721b/" class="sidebar-link">ç½‘ç»œç¼–ç¨‹</a></li><li><a href="/pages/a95428/" class="sidebar-link">è¿›ç¨‹</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> nestæ¡†æ¶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>koa</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-6"><div class="articleInfo-wrap" data-v-0c557b5e><div class="articleInfo" data-v-0c557b5e><ul class="breadcrumbs" data-v-0c557b5e><li data-v-0c557b5e><a href="/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-0c557b5e></a></li> <li data-v-0c557b5e><a href="/tool/node/#node" data-v-0c557b5e>node</a></li><li data-v-0c557b5e><a href="/tool/node/# æ·±å…¥æµ…å‡ºnode" data-v-0c557b5e> æ·±å…¥æµ…å‡ºnode</a></li></ul> <div class="info" data-v-0c557b5e><!----> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-0c557b5e><a href="javascript:;" data-v-0c557b5e>2022-05-03</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">ç›®å½•</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">å¼‚æ­¥ç¼–ç¨‹<!----></h1> <!----> <div class="theme-vdoing-content content__default"><p>æœ‰å¼‚æ­¥I/Oï¼Œå¿…æœ‰å¼‚æ­¥ç¼–ç¨‹ã€‚</p> <h3 id="_01-å‡½æ•°å¼ç¼–ç¨‹"><a href="#_01-å‡½æ•°å¼ç¼–ç¨‹" class="header-anchor">#</a> 01. å‡½æ•°å¼ç¼–ç¨‹</h3> <h4 id="é«˜é˜¶å‡½æ•°"><a href="#é«˜é˜¶å‡½æ•°" class="header-anchor">#</a> é«˜é˜¶å‡½æ•°</h4> <p>é«˜é˜¶å‡½æ•°å¯ä»¥å°†å‡½æ•°ä½œä¸ºå‚æ•°æˆ–è€…å°†å‡½æ•°ä½œä¸ºè¿”å›å€¼çš„å‡½æ•°ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>function foo(x) {
  return function () {
    return x;
  };
} 
</code></pre></div><p>é€šè¿‡æ”¹åŠ¨sort()æ–¹æ³•çš„å‚æ•°ï¼Œå¯ä»¥å†³å®šä¸åŒçš„æ’åºæ–¹å¼ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>var points = [40, 100, 1, 5, 25, 10];
points.sort(function(a, b) {
 return a - b;
});
// [ 1, 5, 10, 25, 40, 100 ] 
</code></pre></div><p>åœ¨Nodeä¸­ï¼Œäº‹ä»¶çš„å¤„ç†æ–¹å¼æ˜¯åŸºäºé«˜é˜¶å‡½æ•°çš„ç‰¹æ•ˆæ¥å®Œæˆçš„ã€‚åœ¨è‡ªå®šä¹‰äº‹ä»¶å®ä¾‹ä¸­ï¼Œé€šè¿‡ä¸ºç›¸åŒäº‹ä»¶æ³¨å†Œä¸åŒçš„å›è°ƒå‡½æ•°ï¼Œå¯ä»¥å¾ˆçµæ´»çš„å¤„ç†ä¸šåŠ¡é€»è¾‘ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>var emitter = new events.EventEmitter();
emitter.on('event_foo', function () {
 // TODO
}); 
</code></pre></div><h4 id="åå‡½æ•°ç”¨æ³•"><a href="#åå‡½æ•°ç”¨æ³•" class="header-anchor">#</a> åå‡½æ•°ç”¨æ³•</h4> <p>åå‡½æ•°ç”¨æ³•æ˜¯æŒ‡åˆ›å»ºä¸€ä¸ªè°ƒç”¨å¦å¤–ä¸€ä¸ªéƒ¨åˆ†-å‚æ•°æˆ–å˜é‡å·²ç»é¢„ç½®çš„å‡½æ•°ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>var toString = Object.prototype.toString;

var isString = function (obj) {
 return toString.call(obj) == '[object String]';
};
var isFunction = function (obj) {
 return toString.call(obj) == '[object Function]';
};
</code></pre></div><p>åœ¨JavaScriptä¸­è¿›è¡Œç±»å‹åˆ¤æ–­æ—¶ï¼Œé€šè¿‡ç±»ä¼¼ä¸ä¸Šè¿°ä»£ç çš„æ–¹æ³•å®šä¹‰ã€‚é‡Œé¢éœ€è¦æˆ‘ä»¬é‡å¤å»å®šä¹‰ä¸€äº›ç±»ä¼¼çš„å‡½æ•°ã€‚ä¸ºäº†è§£å†³é‡å¤å®šä¹‰çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªæ–°å‡½æ•°ï¼Œè¿™ä¸ªæ–°å‡½æ•°å¯ä»¥åƒå·¥å‚ä¸€æ ·æ‰¹é‡åˆ›å»ºä¸€äº›ç±»ä¼¼çš„å‡½æ•°ã€‚
ä¾‹å¦‚ï¼šé€šè¿‡isType()é¢„å…ˆæŒ‡å®štypeçš„å€¼ï¼Œç„¶åè¿”å›æ–°çš„å‡½æ•°ã€‚è¿™ç§é€šè¿‡æŒ‡å®šéƒ¨åˆ†å‚æ•°æ¥äº§ç”Ÿä¸€ä¸ªæ–°çš„å®šåˆ¶å‡½æ•°çš„å½¢å¼å°±æ˜¯ <code>åå‡½æ•°</code></p> <div class="language- extra-class"><pre class="language-text"><code>var isType = function (type) {
 return function (obj) {
 return toString.call(obj) == '[object ' + type + ']';
 };
};
var isString = isType('String');
var isFunction = isType('Function'); 
</code></pre></div><h3 id="_02-å¼‚æ­¥ç¼–ç¨‹çš„ä¼˜åŠ¿ä¸éš¾ç‚¹"><a href="#_02-å¼‚æ­¥ç¼–ç¨‹çš„ä¼˜åŠ¿ä¸éš¾ç‚¹" class="header-anchor">#</a> 02. å¼‚æ­¥ç¼–ç¨‹çš„ä¼˜åŠ¿ä¸éš¾ç‚¹</h3> <p>Nodeåˆ©ç”¨JavaScriptä»¥åŠå†…éƒ¨å¼‚æ­¥åº“ï¼Œå°†å¼‚æ­¥ç›´æ¥æå‡åˆ°ä¸šåŠ¡å±‚é¢ã€‚</p> <h4 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="header-anchor">#</a> ä¼˜åŠ¿</h4> <p>Nodeå¸¦æ¥çš„æœ€å¤§ç‰¹æ€§ï¼šåŸºäºäº‹ä»¶é©±åŠ¨çš„éé˜»å¡I/Oæ¨¡å‹ã€‚éé˜»å¡I/Oä½¿CPUä¸I/Oäº’ä¸ä¾èµ–ç­‰å¾…ï¼Œè®©èµ„æºå¯ä»¥å¾—åˆ°æ›´å¥½çš„åˆ©ç”¨ã€‚</p> <p>å¼‚æ­¥I/Oè°ƒç”¨ï¼š</p> <p><img src="/images/node/%E5%BC%82%E6%AD%A5IO%E8%B0%83%E7%94%A8.png" alt=""></p> <p>ä¼ ç»ŸåŒæ­¥I/Oæ¨¡å‹ï¼š
<img src="/images/node/%E5%90%8C%E6%AD%A5IO%E7%A4%BA%E6%84%8F.png" alt=""></p> <p>Nodeå®ç°å¼‚æ­¥I/OåŸç†ï¼šåˆ©ç”¨äº‹ä»¶å¾ªç¯çš„æ–¹å¼ï¼ŒJavaScriptçº¿ç¨‹åƒä¸€ä¸ªåˆ†é…ä»»åŠ¡å’Œå¤„ç†ç»“æœçš„å¤§ç®¡å®¶ï¼ŒI/Oçº¿ç¨‹æ± é‡Œé¢çš„å„ä¸ªI/Oçº¿ç¨‹éƒ½æ˜¯å°äºŒã€‚è´Ÿè´£å®Œæˆåˆ†é…æ¥çš„ä»»åŠ¡ï¼Œå°äºŒä¸ç®¡ç†äº’ä¸å…³è”ï¼Œæ‰€ä»¥å¯ä»¥ä¿æŒæ•´ä½“çš„é«˜æ•ˆç‡ã€‚</p> <p>ç”±äºäº‹ä»¶å¾ªç¯æ¨¡å‹éœ€è¦åº”å¯¹æµ·é‡è¯·æ±‚ï¼Œæµ·é‡è¯·æ±‚åŒæ—¶ä½œç”¨åœ¨å•çº¿ç¨‹ä¸Šï¼Œå°±éœ€è¦é˜²æ­¢ä»»ä½•ä¸€ä¸ªè®¡ç®—è€—è´¹è¿‡å¤šçš„CPUæ—¶é—´ç‰‡ã€‚è‡³äºæ˜¯è®¡ç®—å¯†é›†å‹è¿˜æ˜¯I/O
å¯†é›†å‹ï¼Œåªè¦ä¸è®¡ç®—å¼‚æ­¥I/Oçš„è°ƒåº¦ï¼Œå°±æ„ä¸æˆé—®é¢˜ã€‚å»ºè®®å¯¹CPUå¾—è€—ç”¨ä¸è¦è¶…è¿‡10msï¼Œæˆ–è€…å°†å¤§é‡çš„è®¡ç®—åˆ†è§£æˆè¯¸å¤šçš„å°é‡è®¡ç®—ã€‚é€šè¿‡setImmediate()è¿›è¡Œè°ƒåº¦ã€‚</p> <h4 id="éš¾ç‚¹"><a href="#éš¾ç‚¹" class="header-anchor">#</a> éš¾ç‚¹</h4> <ul><li>éš¾ç‚¹1: å¼‚å¸¸å¤„ç†
è¿‡å»ï¼Œæˆ‘ä»¬å¤„ç†å¼‚å¸¸ï¼Œé€šè¿‡ä½¿ç”¨ç±»javaçš„try/catch/finalè¯­å¥å—è¿›è¡Œä¸€åœºæ•è·ã€‚</li></ul> <div class="language- extra-class"><pre class="language-text"><code>try {
 JSON.parse(json);
} catch (e) {
 // TODO
} 
</code></pre></div><p>ä½†æ˜¯è¿™å¯¹äºå¼‚æ­¥ç¼–ç¨‹ä¸ä¸€å®šé€‚ç”¨ã€‚å¼‚æ­¥I/Oçš„å®ç°ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªé˜¶æ®µï¼š<code>æäº¤è¯·æ±‚å’Œå¤„ç†ç»“æœ</code>ã€‚è¿™ä¸¤ä¸ªé˜¶æ®µä¸­é—´æœ‰äº‹ä»¶å¾ªç¯çš„è°ƒåº¦ï¼Œä¸¤è€…å½¼æ­¤ä¸å…³è”ï¼Œå¼‚æ­¥æ–¹æ³•é€šå¸¸åœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µæäº¤è¯·æ±‚åç«‹å³è¿”å›ï¼Œå› ä¸ºå¼‚å¸¸ä¸ä¸€å®šå‘ç”Ÿåœ¨è¿™ä¸ªé˜¶æ®µã€‚try/catchçš„åŠŸæ•ˆåœ¨æ­¤å¤„ä¸ä¼šå‘ç”Ÿä»»ä½•ä½œç”¨</p> <div class="language- extra-class"><pre class="language-text"><code>var async = function (callback) {
 process.nextTick(callback);
}; 
</code></pre></div><p>è°ƒç”¨async()æ–¹æ³•åï¼Œcallbackè¢«å­˜å‚¨èµ·æ¥ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯Tickæ‰ä¼šå–å‡ºæ¥æ‰§è¡Œã€‚å¯¹å¼‚æ­¥æ–¹æ³•è¿›è¡Œtry/catchæ“ä½œåªèƒ½æ•è·å½“å‰äº‹ä»¶å¾ªç¯å†…çš„å¼‚å¸¸ï¼Œå¯¹callbackæ‰§è¡Œæ—¶æŠ›å‡ºæ¥çš„å¼‚å¸¸æ— èƒ½ä¸ºåŠ›ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>try {
 async(callback);
} catch (e) {
 // TODO
} 
</code></pre></div><p>Nodeåœ¨å¤„ç†å¼‚å¸¸ä¸Šå½¢æˆäº†ä¸€ç§çº¦å®šï¼Œå°†å¼‚å¸¸ä½œä¸ºå›è°ƒå‡½æ•°çš„ç¬¬ä¸€ä¸ªå®å‚ä¼ å›ï¼Œå¦‚æœä¸ºç©ºå€¼ï¼Œè¡¨æ˜å¼‚å¸¸è°ƒç”¨æ²¡æœ‰å¼‚å¸¸æŠ›å‡ºã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>async(function (err, results) {
 // TODO
});
</code></pre></div><p>åœ¨æˆ‘ä»¬è‡ªè¡Œç¼–å†™çš„å¼‚æ­¥æ–¹æ³•ä¸Šï¼Œéœ€è¦éµå¾ªè¿™æ ·çš„åŸåˆ™ï¼š</p> <ol><li>å¿…é¡»æ‰§è¡Œè°ƒç”¨è€…ä¼ å…¥çš„å›è°ƒå‡½æ•°</li> <li>æ­£ç¡®ä¼ é€’å¼‚å¸¸ä¾›è°ƒç”¨è€…åˆ¤æ–­</li></ol> <div class="language- extra-class"><pre class="language-text"><code>var async = function (callback) {
 process.nextTick(function() {
 var results = something;
 if (error) {
 return callback(error);
 }
 callback(null, results);
 });
};
</code></pre></div><p>åœ¨å¼‚æ­¥æ–¹æ³•çš„ç¼–å†™ä¸­ï¼Œå¦å¤–ä¸€ä¸ªå¸¸çŠ¯çš„é”™è¯¯æ˜¯å¯¹ç”¨æˆ·ä¼ é€’çš„å›è°ƒå‡½æ•°è¿›è¡Œå¼‚å¸¸æ•è·ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>try {
 req.body = JSON.parse(buf, options.reviver);
 callback();
} catch (err){
 err.body = buf;
 err.status = 400;
 callback(err);
} 
</code></pre></div><p>ä¸Šè¿°ä»£ç çš„æ„å›¾æ˜¯æ•è·JSON.parse()ä¸­å¯èƒ½å‡ºç°çš„å¼‚å¸¸ï¼Œä½†æ˜¯å´ä¸å°å¿ƒåŒ…å«äº†ç”¨æˆ·ä¼ é€’çš„å›è°ƒå‡½æ•°ã€‚è¿™æ„å‘³ç€å¦‚æœå›è°ƒå‡½æ•°ä¸­æœ‰å¼‚å¸¸æŠ›å‡ºï¼Œå°†ä¼šè¿›å…¥catch()ä»£ç å—ä¸­æ‰§è¡Œï¼Œäºæ˜¯å›è°ƒå‡½æ•°ä¼šè¢«æ‰§è¡Œä¸¤æ¬¡ã€‚
æ­£ç¡®çš„æ•è·ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>try {
  req.body = JSON.parse(buf, options.reviver);
} catch (err){
  err.body = buf; 
  err.status = 400;
  return callback(err);
}
callback(); 
</code></pre></div><p>åœ¨ç¼–å†™å¼‚æ­¥æ–¹æ³•æ—¶ï¼Œåªè¦å°†å¼‚å¸¸æ­£ç¡®çš„ä¼ é€’ç»™ç”¨æˆ·çš„å›è°ƒæ–¹æ³•å³å¯ã€‚æ— é¡»è¿‡å¤šå¤„ç†ã€‚</p> <ul><li>éš¾ç‚¹2: å‡½æ•°åµŒå¥—è¿‡æ·±
åœ¨Nodeä¸­ï¼Œäº‹åŠ¡ä¸­å­˜åœ¨å¤šä¸ªå¼‚å¸¸è°ƒç”¨çš„åœºæ™¯ï¼šæ¯”å¦‚ä¸€ä¸ªéå†ç›®å½•çš„æ“ä½œï¼š</li></ul> <div class="language- extra-class"><pre class="language-text"><code>fs.readdir(path.join(__dirname, '..'), function (err, files) {
  files.forEach(function (filename, index) {
  fs.readFile(filename, 'utf8', function (err, file) {
   // TODO
  });
 });
}); 
</code></pre></div><p>å¯¹äºä¸Šè¿°åœºæ™¯ï¼Œç”±äºä¸¤æ¬¡æ“ä½œå­˜åœ¨ä¾èµ–å…³ç³»ï¼Œå‡½æ•°åµŒå¥—çš„è¡Œä¸ºä¹Ÿè®¸æƒ…æœ‰å¯åŸã€‚åœ¨ç½‘é¡µæ¸²æŸ“è¿‡ç¨‹ä¸­ï¼Œé€šå¸¸éœ€è¦æ•°æ®ï¼Œæ¨¡ç‰ˆï¼Œèµ„æºæ–‡ä»¶ï¼Œè¿™ä¸‰è€…äº’ç›¸ä¸ä¾èµ–ï¼Œä½†æ˜¯åœ¨æœ€ç»ˆæ¸²æŸ“ç»“æœä¸­ï¼Œä¸‰è€…ç¼ºä¸€ä¸å¯ã€‚å¦‚æœé‡‡ç”¨é»˜è®¤çš„å¼‚æ­¥æ–¹æ³•è°ƒç”¨ï¼Œç¨‹åºå–ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>fs.readFile(template_path, 'utf8', function (err, template) {
 db.query(sql, function (err, data) {
 l10n.get(function (err, resources) {
 // TODO
 });
 });
});
</code></pre></div><ul><li>éš¾ç‚¹3: é˜»å¡ä»£ç </li></ul> <p>ç–‘æƒ‘ğŸ¤”ä¸ºä»€ä¹ˆæ²¡æœ‰sleep()è¿™æ ·çš„çº¿ç¨‹æ²‰ç¡åŠŸèƒ½ï¼Œå”¯æœ‰ç”¨äºå»¶æ—¶çš„setIntervalå’ŒsetTimeout()è¿™ä¸¤ä¸ªå‡½æ•°ã€‚è¿™ä¸¤ä¸ªå‡½æ•°ä¸èƒ½é˜»å¡åç»­ä»£ç çš„æŒç»­æ‰§è¡Œã€‚å®ç°sleep(1000)çš„æ•ˆæœï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>// TODO
var start = new Date();
while (new Date() - start &lt; 1000) {
 // TODO
}
// éœ€è¦é˜»å¡çš„ä»£ç 
</code></pre></div><p>å®é™…æ˜¯è¿™æ®µä»£ç ä¼šæ”¯æŒå ç”¨CPUè¿›è¡Œåˆ¤æ–­ï¼Œä¸çœŸæ­£çš„çº¿ç¨‹æ²‰ç¡ç›¸å»ç”šè¿œï¼Œå®Œå…¨ç ´åäº†äº‹ä»¶å¾ªç¯çš„è°ƒåº¦ã€‚ç”±äºNodeå•çº¿ç¨‹çš„åŸå› ï¼ŒCPUèµ„æºå…¨éƒ½ä¼šç”¨äºè¿™æ®µä»£ç æœåŠ¡ï¼Œå¯¼è‡´å…¶ä½™ä»»ä½•è¯·æ±‚éƒ½ä¼šå¾—ä¸åˆ°å“åº”ã€‚
éœ€è¦è¿™æ ·çš„éœ€æ±‚æ—¶ï¼Œåœ¨ç»Ÿä¸€è§„åˆ’å¥½ä¸šåŠ¡é€»è¾‘åï¼Œè°ƒç”¨setTimeout()çš„æ•ˆæœä¼šæ›´å¥½ã€‚</p> <ul><li>éš¾ç‚¹4: å¤šçº¿ç¨‹ç¼–ç¨‹
æˆ‘ä»¬åœ¨è°ˆè®ºJavaScriptçš„æ—¶å€™ï¼Œé€šå¸¸è°ˆçš„æ˜¯å•ä¸€çº¿ç¨‹ä¸Šæ‰§è¡Œçš„ä»£ç ï¼Œè¿™åœ¨æµè§ˆå™¨ä¸­æŒ‡çš„æ˜¯JavaScriptæ‰§è¡Œçº¿ç¨‹ä¸UIæ¸²æŸ“å…±ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œåœ¨Nodeä¸­ï¼Œåªæ˜¯æ²¡æœ‰æ¸²æŸ“UIçš„éƒ¨åˆ†ï¼Œæ¨¡å‹åŸºæœ¬ç›¸åŒã€‚å¯¹äºæœåŠ¡ç«¯è€Œè¨€ï¼Œå¦‚æœæœåŠ¡å™¨æ˜¯å¤šæ ¸CPUï¼Œå•ä¸ªNodeè¿›ç¨‹å®è´¨ä¸Šæ²¡æœ‰å……åˆ†åˆ©ç”¨å¤šæ ¸CPU</li></ul> <p>æµè§ˆå™¨æå‡ºWeb Workers,å®ƒé€šè¿‡å°†JavaScriptæ‰§è¡Œä¸UIæ¸²æŸ“åˆ†ç¦»ï¼Œå¯ä»¥å¾ˆå¥½åˆ©ç”¨å¤šæ ¸CPUä¸ºå¤§é‡è®¡ç®—æœåŠ¡ã€‚åŒæ—¶å‰ç«¯Web Workersä¹Ÿæ˜¯ä¸€ä¸ªåˆ©ç”¨æ¶ˆæ¯æœºåˆ¶åˆç†ä½¿ç”¨å¤šæ ¸CPUçš„ç†æƒ³æ¨¡å‹ã€‚</p> <p><img src="/images/node/webWorkers%E5%B7%A5%E4%BD%9C%E7%A4%BA%E6%84%8F.png" alt=""></p> <p>é—æ†¾åœ¨äºå‰ç«¯æµè§ˆå™¨å­˜åœ¨å¯¹æ ‡å‡†çš„æ»åæ€§ï¼ŒWeb Workersæ²¡æœ‰å¹¿æ³›åº”ç”¨èµ·æ¥ã€‚Web Workersèƒ½è§£å†³åˆ©ç”¨CPUå’Œå‡å°‘é˜»å¡UIæ¸²æŸ“ï¼Œä½†æ˜¯ä¸èƒ½è§£å†³UIæ¸²æŸ“çš„æ•ˆç‡é—®é¢˜ã€‚Nodeå€Ÿé‰´è¿™ä¸ªæ¨¡å¼ï¼Œchild_processæ˜¯å…¶åŸºç¡€APIï¼Œclusteræ¨¡å—æ˜¯æ›´æ·±å±‚æ¬¡çš„åº”ç”¨ã€‚</p> <ul><li>éš¾ç‚¹5: å¼‚æ­¥è½¬åŒæ­¥
Nodeæä¾›äº†ç»å¤§éƒ¨åˆ†çš„å¼‚æ­¥APIå’Œå°‘é‡çš„åŒæ­¥APIï¼Œå¶å°”å‡ºç°çš„åŒæ­¥éœ€æ±‚ä¼šå› æ²¡æœ‰åŒæ­¥APIè®©å¼€å‘è€…æ— æ‰€é€‚ä»ã€‚</li></ul> <h3 id="_03-å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆ"><a href="#_03-å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆ" class="header-anchor">#</a> 03. å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆ</h3> <p>å‰é¢åˆ—ä¸¾äº†å› å¼‚æ­¥ç¼–ç¨‹å¸¦æ¥çš„ä¸€äº›é—®é¢˜ï¼Œä¸å¼‚æ­¥ç¼–ç¨‹æå‡çš„æ€§èƒ½æˆåŠŸç›¸æ¯”ï¼Œç¼–ç¨‹è¿‡ç¨‹çœ‹èµ·æ¥å’©æœ‰æƒ³è±¡ä¸­é‚£ä¹ˆç¾å¥½ã€‚
ç›®å‰å¼‚æ­¥ç¼–ç¨‹çš„ä¸»è¦è§£å†³æ–¹æ¡ˆæœ‰ä¸‰ç§ã€‚</p> <ol><li>äº‹ä»¶å‘å¸ƒ/è®¢é˜…æ¨¡å¼</li> <li>Primise/Deferredæ¨¡å¼</li> <li>æµç¨‹æ§åˆ¶åº“</li></ol> <h4 id="äº‹ä»¶å‘å¸ƒ-è®¢é˜…æ¨¡å¼"><a href="#äº‹ä»¶å‘å¸ƒ-è®¢é˜…æ¨¡å¼" class="header-anchor">#</a> äº‹ä»¶å‘å¸ƒ/è®¢é˜…æ¨¡å¼</h4> <p>äº‹ä»¶ç›‘å¬å™¨æ¨¡å¼æ˜¯ä¸€ç§å¹¿æ³›ç”¨äºå¼‚æ­¥ç¼–ç¨‹çš„æ¨¡å¼ï¼Œæ˜¯å›è°ƒå‡½æ•°çš„äº‹ä»¶åŒ–ï¼Œåˆç§°<code>å‘å¸ƒ/è®¢é˜…æ¨¡å¼</code>ã€‚
Nodeè‡ªèº«æä¾›çš„<a href="https://nodejs.org/docs/latest/api/events.html" target="_blank" rel="noopener noreferrer"><code>events</code>æ¨¡å—<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>æ˜¯å‘å¸ƒ/è®¢é˜…æ¨¡å¼çš„ä¸€ä¸ªç®€å•å®ç°ã€‚Nodeä¸­å¤§éƒ¨åˆ†æ¨¡å—éƒ½ç»§æ‰¿è‡ªå®ƒï¼Œè¿™ä¸ªæ¨¡å—æ¯”å‰ç«¯æµè§ˆå™¨ä¸­å¤§é‡DOMäº‹ä»¶ç®€å•ï¼Œä¸å­˜åœ¨äº‹ä»¶å†’æ³¡ï¼Œä¹Ÿä¸å­˜åœ¨preventDefault(),stopPropagation()å’ŒstopImmediatePropagation()
()ç­‰æ§åˆ¶äº‹ä»¶ä¼ é€’çš„æ–¹æ³•ã€‚å®ƒå…·æœ‰addListener/on(), once(), removeListener(), removeAllListener()å’Œemit()ç­‰åŸºæœ¬çš„äº‹ä»¶ç›‘å¬æ¨¡å¼çš„æ–¹æ³•å®ç°ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>// è®¢é˜…
emitter.on(&quot;event1&quot;, function (message) {
 console.log(message);
});
// å‘å¸ƒ
emitter.emit('event1', &quot;I am message!&quot;); 
</code></pre></div><p>å¯ä»¥çœ‹åˆ°è®¢é˜…äº‹ä»¶æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°çš„åº”ç”¨ã€‚äº‹ä»¶å‘å¸ƒ/è®¢é˜…æ¨¡å¼å¯ä»¥å®ç°ä¸€ä¸ªäº‹ä»¶ä¸å¤šä¸ªå›è°ƒå‡½æ•°ï¼ˆäº‹ä»¶ä¾¦å¬å™¨ï¼‰çš„å…³è”ã€‚é€šè¿‡ <code>emit</code>å‘å¸ƒäº‹ä»¶åï¼Œæ¶ˆæ¯ä¼šç«‹å³ä¼ é€’ç»™å½“å‰èŠ‚ç‚¹äº‹ä»¶çš„æ‰€æœ‰ä¾¦å¬å™¨ã€‚ä¾¦å¬å™¨å¯ä»¥çµæ´»çš„æ·»åŠ å’Œåˆ é™¤ï¼Œä½¿å¾—äº‹ä»¶ä¸å…·ä½“å¤„ç†é€»è¾‘ä¹‹é—´å¯ä»¥å¾ˆè½»æ¾çš„å…³è”ä¸æ¥è€¦ã€‚</p> <p>äº‹ä»¶å‘å¸ƒ/è®¢é˜…æ¨¡å¼è‡ªèº«å¹¶æ— åŒæ­¥ä¸å¼‚æ­¥è°ƒç”¨çš„é—®é¢˜ï¼Œä½†æ˜¯åœ¨Nodeä¸­ï¼Œemit()è°ƒç”¨å¤šåŠæ˜¯ä¼´éšäº‹ä»¶å¾ªç¯è€Œå¼‚æ­¥è§¦å‘çš„ã€‚æ‰€ä»¥æˆ‘ä»¬è¯´äº‹ä»¶å‘å¸ƒ/è®¢é˜…æ¨¡å¼å¹¿æ³›åº”ç”¨äºå¼‚æ­¥ç¼–ç¨‹ã€‚</p> <p>äº‹ä»¶å‘å¸ƒ/è®¢é˜…æ¨¡å¼å¸¸å¸¸ç”¨æ¥æ¥è€¦ä¸šåŠ¡é€»è¾‘ï¼Œäº‹ä»¶å‘å¸ƒè€…æ— é¡»å…³æ³¨è®¢é˜…çš„ä¾¦å¬å™¨å¦‚ä½•å®ç°ä¸šåŠ¡é€»è¾‘ï¼Œæ•°æ®é€šè¿‡æ¶ˆæ¯çš„æ–¹å¼å¯ä»¥å¾ˆçµæ´»çš„ä¼ é€’ã€‚</p> <p>å¯ä»¥é€šè¿‡äº‹ä»¶å‘å¸ƒ/è®¢é˜…æ¨¡å¼è¿›è¡Œç»„ä»¶åˆ†è£…ï¼Œå°†ä¸å˜çš„éƒ¨åˆ†åˆ†è£…åœ¨ç»„ä»¶å†…éƒ¨ï¼Œå°†å®¹æ˜“å˜åŒ–ï¼Œéœ€è‡ªå®šä¹‰çš„éƒ¨åˆ†é€šè¿‡äº‹ä»¶æš´éœ²ç»™å¤–éƒ¨å¤„ç†ã€‚è¿™æ˜¯ä¸€ç§å…¸å‹çš„é€»è¾‘åˆ†ç¦»æ–¹å¼ã€‚</p> <p>ä»å¦ä¸€ä¸ªè§’åº¦æ¥çœ‹ï¼Œäº‹ä»¶ä¾¦å¬å™¨æ¨¡å¼ä¹Ÿæ˜¯ä¸€ç§é’©å­ï¼ˆhookï¼‰æœºåˆ¶ï¼Œåˆ©ç”¨é’©å­å¯¼å‡ºå†…éƒ¨æ•°æ®æˆ–çŠ¶æ€ç»™å¤–éƒ¨çš„è°ƒç”¨è€…ï¼ŒNodeä¸­å¾ˆå¤šå¯¹è±¡éƒ½å…·æœ‰é»‘ç›’å­çŠ¶æ€ï¼ŒåŠŸèƒ½ç‚¹è¾ƒå°‘ï¼Œå¦‚æœä¸é€šè¿‡äº‹ä»¶é’©å­çš„å½¢å¼ï¼Œå¾ˆéš¾è·å¾—å¯¹è±¡åœ¨è¿è¡ŒæœŸé—´çš„ä¸­é—´å€¼æˆ–å†…éƒ¨çŠ¶æ€ã€‚
Httpè¯·æ±‚å°±æ˜¯å…¸å‹çš„åœºæ™¯ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>var options = {
 host: 'www.google.com',
 port: 80,
 path: '/upload',
 method: 'POST'
};
var req = http.request(options, function (res) {
 console.log('STATUS: ' + res.statusCode);
 console.log('HEADERS: ' + JSON.stringify(res.headers));
 res.setEncoding('utf8');
 res.on('data', function (chunk) {
 console.log('BODY: ' + chunk);
 });
 res.on('end', function () {
 // TODO
 });
});
req.on('error', function (e) {
 console.log('problem with request: ' + e.message);
});
// write data to request body
req.write('data\n');
req.write('data\n')
</code></pre></div><p>åœ¨è¿™æ®µHttpè¯·æ±‚ä¸­ï¼Œç¨‹åºå‘˜åªéœ€è¦å°†è§†çº¿æ”¾åœ¨error,data,endè¿™äº›ä¸šåŠ¡äº‹ä»¶ç‚¹ä¸Šï¼Œè‡³äºå†…éƒ¨çš„æµç¨‹å¦‚ä½•ï¼Œæ— é¡»å…³æ³¨ã€‚</p> <p>Nodeå¯¹äº‹ä»¶å‘å¸ƒ/è®¢é˜…åšäº†é¢å¤–å¤„ç†ï¼š</p> <ol><li>å¦‚æœå¯¹ä¸€ä¸ªäº‹ä»¶æ·»åŠ äº†è¶…è¿‡10ä¸ªä¾¦å¬å™¨ï¼Œå°†ä¼šå¾—åˆ°ä¸€ä¸ªè­¦å‘Šã€‚è¿™ä¸€å¤„è®¾è®¡ä¸Nodeè‡ªèº«å•çº¿ç¨‹è¿è¡Œæœ‰å…³ï¼Œè®¾è®¡è€…è®¤ä¸ºä¾¦å¬å™¨å¤ªå¤šå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„éœ²ã€‚æ‰€ä»¥å­˜åœ¨è¿™æ ·ä¸€ä¸ªè­¦å‘Šã€‚è°ƒç”¨<code>emitter.setMaxListeners(0)</code>å¯ä»¥å°†è¿™ä¸ªé™åˆ¶å»æ‰ã€‚å¦å¤–ï¼Œç”±äºäº‹ä»¶å‘å¸ƒä¼šå¼•èµ·ä¸€ç³»åˆ—ä¾¦å¬å™¨æ‰§è¡Œï¼Œå¦‚æœäº‹ä»¶ç›¸å…³çš„ä¾¦å¬å™¨è¿‡å¤šï¼Œå¯èƒ½ä¼šå­˜åœ¨è¿‡å¤šå ç”¨CPUçš„åœºæ™¯ã€‚</li> <li>ä¸ºäº†å¤„ç†å¼‚å¸¸ï¼Œ<code>EventEmitter</code>å¯¹è±¡å¯¹erroräº‹ä»¶è¿›è¡Œäº†ç‰¹æ®Šå¯¹å¾…ï¼Œå¦‚æœè¿è¡ŒæœŸé—´çš„é”™è¯¯è§¦å‘äº†erroräº‹ä»¶ï¼Œ<code>EventEmitter</code>ä¼šæ£€æŸ¥æ˜¯å¦æœ‰å¤šerroräº‹ä»¶æ·»åŠ è¿‡ä¾¦å¬å™¨ã€‚å¦‚æœæ·»åŠ äº†ï¼Œè¿™ä¸ªé”™è¯¯å°†ä¼šäº¤ç»™ä¾¦å¬å™¨å¤„ç†ï¼Œå¦åˆ™è¿™ä¸ªé”™è¯¯å°†ä¼šä½œä¸ºå¼‚å¸¸æŠ›å‡ºã€‚å¦‚æœå¤–éƒ¨æ²¡æœ‰æ•è·è¿™ä¸ªå¼‚å¸¸ï¼Œå°†ä¼šå¼•èµ·çº¿ç¨‹é€€å‡ºã€‚</li></ol> <ul><li>ç»§æ‰¿eventsæ¨¡å—
å®ç°ä¸€ä¸ªç»§æ‰¿EventEmitterçš„ç±»</li></ul> <div class="language- extra-class"><pre class="language-text"><code>var events = require('events');
function Stream() {
 events.EventEmitter.call(this);
}
util.inherits(Stream, events.EventEmitter); 
</code></pre></div><p>Nodeåœ¨utilæ¨¡å—ä¸­å°è£…äº†ç»§æ‰¿çš„æ–¹æ³•ï¼Œæ‰€ä»¥æ­¤å¤„å¯ä»¥å¾ˆéå†çš„è°ƒç”¨ã€‚å¼€å‘è€…å¯ä»¥é€šè¿‡è¿™æ ·çš„æ–¹å¼è½»æ¾çš„ç»§æ‰¿<code>EventEmitter</code>,åˆ©ç”¨äº‹ä»¶æœºåˆ¶è§£å†³ä¸šåŠ¡é—®é¢˜ã€‚åœ¨Nodeæä¾›çš„æ ¸å¿ƒæ¨¡å—ä¸­ï¼Œæœ‰è¿‘åŠæ•°éƒ½ç»§æ‰¿è‡ª<code>EventEmitter</code></p> <ul><li>åˆ©ç”¨äº‹ä»¶é˜Ÿåˆ—è§£å†³é›ªå´©é—®é¢˜
åœ¨äº‹ä»¶è®¢é˜…/å‘å¸ƒæ¨¡å¼ä¸­ï¼Œé€šå¸¸æœ‰ä¸€ä¸ªonce()æ–¹æ³•ï¼Œé€šè¿‡å®ƒæ·»åŠ çš„ä¾¦å¬å™¨åªæ‰§è¡Œä¸€æ¬¡ï¼Œåœ¨æ‰§è¡Œä¹‹åå°±ä¼šå°†å®ƒä¸äº‹ä»¶çš„å…³è”ç§»é™¤ã€‚
å¦‚ä½•é‡‡ç”¨once()è§£å†³é›ªå´©é—®é¢˜
åœ¨è®¡ç®—æœºä¸­ï¼Œç¼“å­˜ç”±äºå­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œè®¿é—®é€Ÿåº¦ååˆ†å¿«ï¼Œå¸¸å¸¸ç”¨äºåŠ é€Ÿæ•°æ®è®¿é—®ï¼Œè®©ç»å¤§å¤šæ•°çš„è¯·æ±‚ä¸å¿…é‡å¤å»åšä¸€äº›ä½æ•ˆç‡çš„æ•°æ®è¯»å–ã€‚</li></ul> <p>é›ªå´©é—®é¢˜ï¼šå°±æ˜¯åœ¨é«˜è®¿é—®é‡ï¼Œå¤§å¹¶å‘é‡çš„æƒ…å†µä¸‹ç¼“å­˜å¤±æ•ˆçš„æƒ…æ™¯æ­¤æ—¶å¤§é‡çš„è¯·æ±‚åŒæ—¶æ¶Œå…¥æ•°æ®åº“ä¸­ï¼Œæ•°æ®åº“æ— æ³•åŒæ—¶æ‰¿å—å¦‚æ­¤å¤§çš„æŸ¥è¯¢è¯·æ±‚ï¼Œè¿›è€Œå½±å“åˆ°ç½‘ç«™æ•´ä½“çš„å“åº”é€Ÿåº¦ã€‚
æ•°æ®åº“æŸ¥è¯¢è¯­å¥ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>var select = function (callback) {
 db.select(&quot;SQL&quot;, function (results) {
 callback(results);
 });
}; 
</code></pre></div><p>å¦‚æœç«™ç‚¹åˆšå¥½å¯åŠ¨ï¼Œè¿™æ—¶ç¼“å­˜æ±‡æ€»æ˜¯ä¸å­˜åœ¨æ•°æ®çš„ï¼Œå¦‚æœè®¿é—®é‡å¤§ï¼ŒåŒä¸€å¥sqlä¼šè¢«å‘é€åˆ°æ•°æ®åº“ä¸­åå¤æŸ¥è¯¢ï¼Œä¼šå½±å“æœåŠ¡çš„æ•´ä½“æ€§èƒ½ï¼Œä¸€ç§æ”¹è¿›æ–¹æ¡ˆæ˜¯æ·»åŠ ä¸€ä¸ªçŠ¶æ€é”ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>var status = &quot;ready&quot;;
var select = function (callback) {
 if (status === &quot;ready&quot;) {
 status = &quot;pending&quot;;
 db.select(&quot;SQL&quot;, function (results) {
 status = &quot;ready&quot;;
 callback(results);
 });
 }
}; 
</code></pre></div><p>åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œè¿ç»­å¤šæ¬¡çš„è°ƒç”¨select()æ—¶ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ç”Ÿæ•ˆçš„ï¼Œåç»­çš„select()æ˜¯æ²¡æœ‰æ•°æ®æœåŠ¡çš„ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥å¼•å…¥äº‹ä»¶é˜Ÿåˆ—</p> <div class="language- extra-class"><pre class="language-text"><code>var proxy = new events.EventEmitter();
var status = &quot;ready&quot;;
var select = function (callback) {
 proxy.once(&quot;selected&quot;, callback);
 if (status === &quot;ready&quot;) {
 status = &quot;pending&quot;;
 db.select(&quot;SQL&quot;, function (results) {
 proxy.emit(&quot;selected&quot;, results);
 status = &quot;ready&quot;;
 });
 }
};
</code></pre></div><p>è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨once()æ–¹æ³•ï¼Œå°†æ‰€æœ‰çš„è¯·æ±‚å›è°ƒéƒ½å‹å…¥åˆ°äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼Œåˆ©ç”¨å…¶æ‰§è¡Œä¸€æ¬¡å°±ä¼šå°†ç›‘è§†å™¨ç§»é™¤çš„ç‰¹ç‚¹ï¼Œä¿è¯æ¯ä¸€ä¸ªå›è°ƒåªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ã€‚</p> <p>æ­¤å¤„å¯èƒ½å› ä¸ºå­˜åœ¨ä¾¦å¬å™¨è¿‡å¤šå¼•å‘çš„è­¦å‘Šï¼Œéœ€è¦è°ƒç”¨setMaxListeners(0)ç§»é™¤æ‰è­¦å‘Šï¼Œæˆ–è€…è®¾æ›´å¤§çš„è­¦å‘Šé˜€å€¼ã€‚</p> <ol start="3"><li>å¤šå¼‚æ­¥ä¹‹é—´çš„åä½œæ–¹æ¡ˆ
äº‹ä»¶å‘å¸ƒ/è®¢é˜…æœ‰ç€å®ƒçš„ä¼˜ç‚¹ï¼Œåˆ©ç”¨é«˜é˜¶å‡½æ•°çš„ä¼˜åŠ¿ï¼Œä¾¦å¬å™¨ä½œä¸ºå›è°ƒå‡½æ•°å¯ä»¥éšæ„æ·»åŠ å’Œåˆ é™¤ï¼Œå®ƒå¸®åŠ©å¼€å‘è€…è½»æ¾å¤„ç†éšæ—¶å¯èƒ½æ·»åŠ çš„ä¸šåŠ¡é€»è¾‘ï¼Œä¹Ÿå¯ä»¥éš”ç¦»ä¸šåŠ¡é€»è¾‘ï¼Œä¿æŒä¸šåŠ¡é€»è¾‘å•å…ƒçš„èŒä¸šå•ä¸€ã€‚
ä½¿ç”¨åŸç”Ÿä»£ç è§£å†³éš¾ç‚¹2ï¼ˆå‡½æ•°åµŒå¥—è¿‡æ·± åœ¨Nodeä¸­ï¼Œäº‹åŠ¡ä¸­å­˜åœ¨å¤šä¸ªå¼‚å¸¸è°ƒç”¨çš„åœºæ™¯ï¼‰</li></ol> <div class="language- extra-class"><pre class="language-text"><code>var count = 0;
var results = {};
var done = function (key, value) {
 results[key] = value;
 count++;
 if (count === 3) {
 // æ¸²æŸ“é¡µé¢
 render(results);
 } 
 };
fs.readFile(template_path, &quot;utf8&quot;, function (err, template) {
 done(&quot;template&quot;, template);
});
db.query(sql, function (err, data) {
 done(&quot;data&quot;, data);
});
l10n.get(function (err, resources) {
 done(&quot;resources&quot;, resources);
}); 
</code></pre></div><p>ç”±äºå¤šä¸ªå¼‚æ­¥åœºæ™¯ä¸­å›è°ƒå‡½æ•°çš„æ‰§è¡Œå¹¶ä¸èƒ½ä¿è¯é¡ºåºï¼Œä¸”å›è°ƒå‡½æ•°ç›¸äº’ä¹‹é—´æ²¡æœ‰ä»»ä½•äº¤é›†ï¼Œæ‰€ä»¥éœ€è¦å€ŸåŠ©ä¸€ä¸ªç¬¬ä¸‰æ–¹å‡½æ•°å’Œç¬¬ä¸‰æ–¹å˜é‡æ¥å¤„ç†å¼‚æ­¥åä½œçš„ç»“æœã€‚
é€šå¸¸ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªç”¨äºæ£€æµ‹æ¬¡æ•°çš„å˜é‡å«åš<code>å“¨å…µå˜é‡</code>ã€‚
å¯ä»¥åˆ©ç”¨åå‡½æ•°æ¥å¤„ç†å“¨å…µå˜é‡ä¸ç¬¬ä¸‰æ–¹å‡½æ•°çš„å…³ç³»</p> <div class="language- extra-class"><pre class="language-text"><code>var after = function (times, callback) {
 var count = 0, results = {};
 return function (key, value) {
 results[key] = value;
 count++;
 if (count === times) {
 callback(results);
 }
 };
};
var done = after(times, render); 
</code></pre></div><p>ä¸Šè¿°æ–¹æ¡ˆå®ç°äº†å¤šå¯¹ä¸€çš„ç›®çš„ã€‚å¦‚æœä¸šåŠ¡ç»§ç»­å¢é•¿ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥åˆ©ç”¨å‘å¸ƒ/è®¢é˜…çš„æ–¹å¼æ¥å®Œæˆå¤šå¯¹å¤šçš„æ–¹æ¡ˆ</p> <div class="language- extra-class"><pre class="language-text"><code>var emitter = new events.Emitter();
var done = after(times, render);
emitter.on(&quot;done&quot;, done);
emitter.on(&quot;done&quot;, other);
fs.readFile(template_path, &quot;utf8&quot;, function (err, template) {
 emitter.emit(&quot;done&quot;, &quot;template&quot;, template);
});
db.query(sql, function (err, data) {
 emitter.emit(&quot;done&quot;, &quot;data&quot;, data);
});
l10n.get(function (err, resources) {
 emitter.emit(&quot;done&quot;, &quot;resources&quot;, resources);
});

</code></pre></div><p>è¿™ä¸ªæ–¹æ¡ˆç»“åˆäº†å‰è€…ç”¨ç®€å•çš„åå‡½æ•°å®Œæˆå¤šå¯¹ä¸€çš„æ”¶æ•›ä¸äº‹ä»¶è®¢é˜…/å‘å¸ƒæ¨¡å¼ä¸­ä¸€å¯¹å¤šçš„å‘æ•£ã€‚
è¿™ä¸ªç¼ºç‚¹åœ¨äºï¼šè°ƒç”¨è€…è¦å»å‡†å¤‡ç€done()å‡½æ•°ï¼Œä»¥åŠåœ¨å›è°ƒå‡½æ•°ä¸­éœ€è¦ä»ç»“æœä¸­æŠŠæ•°æ®ä¸€ä¸ªä¸€ä¸ªæå–å‡ºæ¥ï¼Œå†è¿›è¡Œç»´æŠ¤ã€‚</p> <p>å¦å¤–ä¸€ä¸ªæ–¹æ¡ˆï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>var proxy = new EventProxy();
proxy.all(&quot;template&quot;, &quot;data&quot;, &quot;resources&quot;, function (template, data, resources) {
 // TODO
});
fs.readFile(template_path, &quot;utf8&quot;, function (err, template) {
 proxy.emit(&quot;template&quot;, template);
});
db.query(sql, function (err, data) {
 proxy.emit(&quot;data&quot;, data);
});
l10n.get(function (err, resources) {
 proxy.emit(&quot;resources&quot;, resources);
});
</code></pre></div><p>EventProxyæä¾›äº†ä¸€ä¸ªall()æ–¹æ³•æ¥è®¢é˜…å¤šä¸ªäº‹ä»¶ï¼Œå½“æ¯ä¸ªäº‹ä»¶éƒ½è¢«è§¦å‘ä»¥åï¼Œä¾¦å¬å™¨æ‰ä¼šæ‰§è¡Œã€‚
å¦å¤–ä¸€ä¸ªå°±æ˜¯tail,ä»–ä¸all()æ–¹æ³•çš„åŒºåˆ«åœ¨äºall()æ–¹æ³•çš„ä¾¦å¬å™¨åœ¨æ»¡è¶³æ¡ä»¶ååªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œtail()æ–¹æ³•çš„ä¾¦å¬å™¨åœ¨æ»¡è¶³æ¡ä»¶æ—¶æ‰§è¡Œä¸€æ¬¡ä¹‹åï¼Œå¦‚æœç»„åˆäº‹ä»¶çš„æŸä¸ªäº‹ä»¶å†æ¬¡è¢«è§¦å‘ï¼Œä¾¦å¬å™¨ä¼šç”¨æœ€æ–°çš„æ•°æ®ç»§ç»­æ‰§è¡Œã€‚
all(ï¼‰æ–¹æ³•çš„æ”¹è¿›ï¼šåœ¨ä¾¦å¬å™¨ä¸­è¿”å›æ•°æ®çš„å‚æ•°åˆ—è¡¨ä¸è®¢é˜…ç»„åˆäº‹ä»¶çš„äº‹ä»¶åˆ—è¡¨æ—¶ä¸€è‡´å¯¹åº”çš„ã€‚</p> <p>åœ¨å¼‚æ­¥åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä»ä¸€ä¸ªæ¥å£å¤šæ¬¡è¯»å–æ•°æ®ï¼Œæ­¤æ—¶è§¦å‘çš„äº‹ä»¶åæˆ–è®¸æ˜¯ç›¸åŒçš„ï¼ŒEventProxyæä¾›äº†after()æ–¹æ³•æ¥å®ç°äº‹ä»¶åœ¨æ‰§è¡Œå¤šæ¬¡åæ‰§è¡Œä¾¦å¬å™¨çš„å•ä¸€äº‹ä»¶ç»„åˆè®¢é˜…æ–¹å¼ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>var proxy = new EventProxy();
proxy.after(&quot;data&quot;, 10, function (datas) {
 // TODO
}); 
</code></pre></div><p>æ‰§è¡Œ0æ¬¡dataäº‹ä»¶åæ‰§è¡Œä¾¦å¬å™¨ã€‚è¿™ä¸ªä¾¦å¬å™¨çš„æ•°æ®ä¸º10æ¬¡æŒ‰äº‹ä»¶è§¦å‘æ¬¡åºæ’åºçš„æ•°ç»„ã€‚</p> <ol start="4"><li>EventProxyåŸç†</li></ol> <div class="language- extra-class"><pre class="language-text"><code>  trigger: function (eventName) {
    var list, calls, ev, callback, args;
    var both = 2;
    if (!(calls = this._callbacks)) return this;
    while (both--) {
      ev = both ? eventName : &quot;all&quot;;
      if ((list = calls[ev])) {
        for (var i = 0, l = list.length; i &lt; l; i++) {
          if (!(callback = list[i])) {
            list.splice(i, 1);
            i--;
            l--;
          } else {
            args = both ? Array.prototype.slice.call(arguments, 1) : arguments;
            callback[0].apply(callback[1] || this, args);
          }
        }
      }
    }
    return this;
  },
 
</code></pre></div><p>EventProxyæ˜¯å°†allä½œä¸ºä¸€ä¸ªäº‹ä»¶æµçš„æ‹¦æˆªå±‚ï¼Œåœ¨å…¶ä¸­æ³¨å…¥ä¸€äº›ä¸šåŠ¡æ¥å¤„ç†å•ä¸€äº‹ä»¶æ— æ³•è§£å†³çš„å¼‚æ­¥å¤„ç†é—®é¢˜ã€‚ç±»ä¼¼çš„æ‰©å±•è¿˜æœ‰all(), tail(), after(), not()å’Œany()ç­‰ã€‚</p> <ol start="5"><li>EventProxyå¼‚å¸¸å¤„ç†</li></ol> <p>é€šè¿‡é¢å¤–æ·»åŠ erroräº‹ä»¶æ¥è¿›è¡Œå¼‚å¸¸ç»Ÿä¸€å¤„ç†ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>exports.getContent = function (callback) {
    var ep = new EventProxy();
    ep.all('tpl', 'data', function (tpl, data) {
        // æˆåŠŸå›è°ƒ
        callback(null, {
            template: tpl,
            data: data
        });
    });
    // ä¾¦å¬erroräº‹ä»¶
    ep.bind('error', function (err) {
        // á‚‚è½½Û–à»¯æœ‰å¤„ç†å‡½æ•°
        ep.unbind();
        // å¼‚å¸¸å›è°ƒ
        callback(err);
    });
    fs.readFile('template.tpl', 'utf-8', function (err, content) {
        if (err) {
            //ä¸€æ—¦å‘ç”Ÿå¼‚å¸¸ï¼Œä¸€å¾‹äº¤ç»™erroräº‹ä»¶çš„å¤„ç†å‡½æ•°å¤„ç†
            return ep.emit('error', err);
        }
        ep.emit('tpl', content);
    });
    db.get('some sql', function (err, result) {
        if (err) {
            // ä¸€æ—¦å‘ç”Ÿå¼‚å¸¸ï¼Œä¸€å¾‹äº¤ç»™erroräº‹ä»¶çš„å¤„ç†å‡½æ•°å¤„ç†
            return ep.emit('error', err);
        }
        ep.emit('data', result);
    }); 
}
</code></pre></div><p>æ”¹è¿›ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>exports.getContent = function (callback) {
  var ep = new EventProxy();
  ep.all(&quot;tpl&quot;, &quot;data&quot;, function (tpl, data) {
    // æˆåŠŸå›è°ƒ
    callback(null, {
      template: tpl,
      data: data,
    });
  });
  //ç»‘å®šé”™è¯¯å¤„ç†å‡½æ•°
  ep.fail(callback);
  fs.readFile(&quot;template.tpl&quot;, &quot;utf-8&quot;, ep.done(&quot;tpl&quot;));
  db.get(&quot;some sql&quot;, ep.done(&quot;data&quot;));
};
</code></pre></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­EventProxyæä¾›äº†failå’Œdoneä¸¤ä¸ªå®ä¾‹æ–¹æ³•æ¥ä¼˜åŒ–å¼‚å¸¸å¤„ç†ã€‚ä½¿å¾—å¼€å‘è€…å°†ç²¾åŠ›å…³æ³¨åœ¨ä¸šåŠ¡å¼€å‘ä¸Šï¼Œè€Œä¸æ˜¯å¼‚å¸¸æ•è·ä¸Šã€‚
fail()çš„å®ç°ï¼Œå‚è§ä¸€ä¸‹å˜æ¢ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>ep.fail(callback); 
</code></pre></div><p>ç­‰ä»·äºï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>ep.fail(function (err) {
 callback(err);
}); 
</code></pre></div><p>åˆç­‰ä»·äºï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>ep.bind('error', function (err) {
 // á‚‚å¸è½½æ‰æ‰€æœ‰æœ‰å¤„ç†å‡½æ•°
 ep.unbind();
 // å¼‚å¸¸å›è°ƒ
 callback(err);
});
</code></pre></div><p>done()çš„å®ç°ï¼Œå‚è§ä¸€ä¸‹å˜æ¢ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>ep.done('tpl');
</code></pre></div><p>ç­‰ä»·äºï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>function (err, content) {
 if (err) {
 // ä¸€æ—¦å‘ç”Ÿå¼‚å¸¸ï¼Œä¸€å¾‹äº¤ç»™erroräº‹ä»¶å¤„ç†å‡½æ•°å¤„ç†
 return ep.emit('error', err);
 }
 ep.emit('tpl', content);
} 
</code></pre></div><p>åŒæ—¶done()æ–¹æ³•æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>ep.done(function (content) {
 // TODO
 // æ— é¡»å…³æ³¨å¼‚å¸¸
 ep.emit('tpl', content);
}); 
</code></pre></div><p>è¿™æ®µä»£ç ç­‰ä»·äºï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>function (err, content) {
 if (err) {
 // ä¸€æ—¦å‘ç”Ÿå¼‚å¸¸ï¼Œä¸€å¾‹äº¤ç»™erroräº‹ä»¶çš„å¤„ç†å‡½æ•°å¤„ç†
 return ep.emit('error', err);
 }
 (function (content) {
 // TODO
 // æ— é¡»å…³æ³¨å¼‚å¸¸
 ep.emit('tpl', content);
 }(content));
} 
</code></pre></div><h4 id="promise-deferredæ¨¡å¼"><a href="#promise-deferredæ¨¡å¼" class="header-anchor">#</a> Promise/Deferredæ¨¡å¼</h4> <p>å…ˆæ‰§è¡Œå¼‚æ­¥è°ƒç”¨ï¼Œå»¶è¿Ÿä¼ é€’å¤„ç†ã€‚</p> <h4 id="promises-a"><a href="#promises-a" class="header-anchor">#</a> Promises/A</h4> <p>Promise/Deferredæ¨¡å¼å…¶å®åªåŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå³Promiseå’ŒDeferredã€‚</p> <p>Promiseçš„çŠ¶æ€è½¬åŒ–ç¤ºæ„å›¾ï¼š
<img src="/images/node/Promise%E7%9A%84%E7%8A%B6%E6%80%81%E8%BD%AC%E5%8C%96%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt=""></p> <p>ä¸€ä¸ªPromiseå¯¹è±¡åªè¦å…·å¤‡äº†then() æ–¹æ³•å³å¯ã€‚</p> <p>then()æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>then(fulfilledHandler, errorHandler, progressHandler) 
</code></pre></div><p>é€šè¿‡Nodeçš„eventsæ¨¡å—æ¥å®Œæˆä¸€ä¸ªç®€å•å®ç°ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>const events = require('events');
var EventEmitter = new events.EventEmitter();
var Promise = function () {
    EventEmitter.call(this);
};
util.inherits(Promise, EventEmitter);
Promise.prototype.then = function (fulfilledHandler, errorHandler, progressHandler) {
    if (typeof fulfilledHandler === 'function') {
        // åˆ©ç”¨once()æ–¹æ³•ï¼Œä¿è¯æˆåŠŸå›è°ƒå‡½æ•°åªæ‰§è¡Œä¸€æ¬¡ã€‚
        this.once('success', fulfilledHandler);
    }
    if (typeof errorHandler === 'function') {
        // åˆ©ç”¨once()æ–¹æ³•ï¼Œä¿è¯å¼‚å¸¸å›è°ƒå‡½æ•°åªæ‰§è¡Œä¸€æ¬¡ã€‚
        this.once('error', errorHandler);
    }
    if (typeof progressHandler === 'function') {
        this.on('progress', progressHandler);
    }
    return this;
};
</code></pre></div><p>è§¦å‘æ‰§è¡Œè¿™äº›å›è°ƒå‡½æ•°çš„åœ°æ–¹ï¼Œå®ç°è¿™äº›åŠŸèƒ½çš„å¯¹è±¡é€šå¸¸è¢«ç§°ä¸º<code>Deferred</code>,å³å»¶è¿Ÿå¯¹è±¡ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>var Deferred = function () {
  this.state = &quot;unfulfilled&quot;;
  this.promise = new Promise();
};
Deferred.prototype.resolve = function (obj) {
  this.state = &quot;fulfilled&quot;;
  this.promise.emit(&quot;success&quot;, obj);
};
Deferred.prototype.reject = function (err) {
  this.state = &quot;failed&quot;;
  this.promise.emit(&quot;error&quot;, err);
};
Deferred.prototype.progress = function (data) {
  this.promise.emit(&quot;progress&quot;, data);
};
</code></pre></div><p><img src="/images/node/promise%E7%8A%B6%E6%80%81%E4%B8%8E%E6%96%B9%E6%B3%95%E4%B9%8B%E9%97%B4%E7%9A%84%E5%9B%9E%E8%B0%83.png" alt=""></p> <div class="language- extra-class"><pre class="language-text"><code>var promisify = function (res) { var deferred = new Deferred(); var result = '';
res.on('data', function (chunk) {
    result += chunk;
deferred.progress(chunk); });
res.on('end', function () { deferred.resolve(result);
});
res.on('error', function (err) {
deferred.reject(err); });
return deferred.promise; };
</code></pre></div><p>å¦‚æ­¤å°±å¾—åˆ°ç®€å•çš„ç»“æœã€‚è¿™é‡Œè¿”å›<code>deferred.promise</code>çš„ç›®çš„æ˜¯ä¸ºäº†Â·ä¸è®©å¤–éƒ¨ç¨‹åºè°ƒç”¨resolveå’Œreject(),æ›´æ”¹å†…éƒ¨çŠ¶æ€çš„è¡Œä¸ºäº¤ç»™å®šä¹‰è€…å¤„ç†ã€‚</p> <p>ç¤ºä¾‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>promisify(res).then(
  function () {
    // Done
  },
  function (err) {
    // Error
  },
  function (chunk) {
    // progress
    console.log(&quot;BODY: &quot; + chunk);
  }
);
</code></pre></div><p>Promiseå’ŒDeferredæ•´ä½“å…³ç³»ç¤ºæ„å›¾:</p> <p><img src="/images/node/Promise%E5%92%8CDeferred%E6%95%B4%E4%BD%93%E5%85%B3%E7%B3%BB%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="">
ä¸äº‹ä»¶å‘å¸ƒ/è®¢é˜…æ¨¡å¼ç›¸æ¯”ï¼ŒPromiseå’ŒDeferredæ¨¡å¼çš„APIæ¥å£å’ŒæŠ½è±¡æ¨¡å‹éƒ½ååˆ†ç®€æ´ã€‚ä»ä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå°†ä¸šåŠ¡ä¸­ä¸å¯å˜çš„éƒ¨åˆ†å°è£…åœ¨äº†Deferredä¸­ï¼Œå°†å¯å˜çš„éƒ¨åˆ†äº¤ç»™äº†Promiseã€‚
Qæ¨¡å—æ˜¯Promise/Aè§„èŒƒçš„ä¸€ä¸ªå®ç°ã€‚
å®ƒå¯¹Nodeä¸­å¸¸è§å›è°ƒå‡½æ•°çš„Promiseå®ç°å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>/**
* Creates a Node-style callback that will resolve or reject the deferred
* promise.
* @returns a nodeback
*/
defer.prototype.makeNodeResolver = function () {
   var self = this;
   return function (error, value) {
       if (error) {
           self.reject(error);
       } else if (arguments.length &gt; 2) {
           self.resolve(array_slice(arguments, 1));
       } else {
           self.resolve(value);
       }
   };
};
</code></pre></div><p><code>makeNodeResolver</code>è¿”å›ä¸€ä¸ªNodeé£æ ¼çš„å›è°ƒå‡½æ•°ã€‚
å¯¹äºfs.readFile()çš„è°ƒç”¨ï¼Œæ¼”åŒ–ä¸ºå¦‚ä¸‹å½¢å¼ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>var readFile = function (file, encoding) {
  var deferred = Q.defer();
  fs.readFile(file, encoding, deferred.makeNodeResolver());
  return deferred.promise;
};
// å®šä¹‰ä¹‹åçš„è°ƒç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š
readFile(&quot;foo.txt&quot;, &quot;utf-8&quot;).then(
  function (data) {
    // Success case
  },
  function (err) {
    // Failed case
  }
);

</code></pre></div><ol start="2"><li>Promise ä¸­å¤šå¼‚æ­¥åä½œ
Promiseä¸»è¦è§£å†³çš„æ˜¯å•ä¸ªå¼‚æ­¥æ“ä½œä¸­å­˜åœ¨çš„é—®é¢˜ã€‚å½“æˆ‘ä»¬éœ€è¦å¤„ç†å¤šä¸ªå¼‚æ­¥è°ƒç”¨ï¼Œè¯¥å¦‚ä½•ï¼Ÿ</li></ol> <p>ç±»ä¼¼äºEventProxyï¼ŒåŸå‹å®ç°ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>Deferred.prototype.all = function (promises) {
  var count = promises.length;
  var that = this;
  var results = [];
  promises.forEach(function (promise, i) {
    promise.then(
      function (data) {
        count--;
        results[i] = data;
        if (count === 0) {
          that.resolve(results);
        }
      },
      function (err) {
        that.reject(err);
      }
    );
  });
  return this.promise;
};

</code></pre></div><p>å¯¹äºå¤šæ¬¡æ–‡ä»¶çš„è¯»å–åœºæ™¯ï¼Œä»¥ä¸‹é¢çš„ä»£ç ä¸ºä¾‹ï¼Œall()æ–¹æ³•å°†ä¸¤ä¸ªå•ç‹¬çš„Promiseé‡æ–°æŠ½è±¡ç»„åˆæˆä¸€ä¸ªæ–°çš„Promiseï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>var promise1 = readFile(&quot;foo.txt&quot;, &quot;utf-8&quot;);
var promise2 = readFile(&quot;bar.txt&quot;, &quot;utf-8&quot;);
var deferred = new Deferred();
deferred.all([promise1, promise2]).then(function (results) {
 // TODO
}, function (err) {
 // TODO
}); 
</code></pre></div><ol start="3"><li>Promiseçš„è¿›é˜¶çŸ¥è¯†ã€‚</li></ol> <p>æ¶é­”é‡‘å­—å¡”ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>obj.api1(function (value1) {
  obj.api2(value1, function (value2) {
    obj.api3(value2, function (value3) {
      obj.api4(value3, function (value4) {
        callback(value4);
      });
    });
  });
});
</code></pre></div><p>æ‹†åˆ†ä¸Šè¿°ä»£ç ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>var handler1 = function (value1) {
 obj.api2(value1, handler2);
};
var handler2 = function (value2) {
 obj.api3(value2, handler3);
};
var handler3 = function (value3) {
 obj.api4(value3, hander4);
};
var handler4 = function (value4) {
 callback(value4);
});
obj.api1(handler1); 
</code></pre></div><p>åˆ©ç”¨äº‹ä»¶çš„å¼€å‘è€…ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>var emitter = new event.Emitter();
emitter.on(&quot;step1&quot;, function () {
 obj.api1(function (value1) {
 emitter.emit(&quot;step2&quot;, value1);
 });
});
emitter.on(&quot;step2&quot;, function (value1) {
 obj.api2(value1, function (value2) {
 emitter.emit(&quot;step3&quot;, value2);
 });
});
emitter.on(&quot;step3&quot;, function (value2) {
 obj.api3(value2, function (value3) {
 emitter.emit(&quot;step4&quot;, value3);
 });
});
emitter.on(&quot;step4&quot;, function (value3) {
 obj.api4(value3, function (value4) {
 callback(value4);
 });
}); 
emitter.emit(&quot;step1&quot;); 
</code></pre></div><ul><li>æ”¯æŒåºåˆ—æ‰§è¡Œçš„Promise
é“¾å¼è°ƒç”¨ï¼š</li></ul> <div class="language- extra-class"><pre class="language-text"><code>promise()
 .then(obj.api1)
 .then(obj.api2)
 .then(obj.api3)
 .then(obj.api4)
 .then(function (value4) {
 // Do something with value4
 }, function (error) {
 // Handle any error from step1 through step4
 })
 .done(); 
</code></pre></div><p>ä¼˜åŒ–åï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>var Deferred = function () {
  this.promise = new Promise();
};
// å®Œæˆæ€
Deferred.prototype.resolve = function (obj) {
  var promise = this.promise;
  var handler;
  while ((handler = promise.queue.shift())) {
    if (handler &amp;&amp; handler.fulfilled) {
      var ret = handler.fulfilled(obj);
      if (ret &amp;&amp; ret.isPromise) {
        ret.queue = promise.queue;
        this.promise = ret;
        return;
      }
    }
  }
};
// å¤±è´¥æ€
Deferred.prototype.reject = function (err) {
  var promise = this.promise;
  var handler;
  while ((handler = promise.queue.shift())) {
    if (handler &amp;&amp; handler.error) {
      var ret = handler.error(err);
      if (ret &amp;&amp; ret.isPromise) {
        ret.queue = promise.queue;
        this.promise = ret;
        return;
      }
    }
  }
};
// ç”Ÿæˆå›è°ƒå‡½æ•°
Deferred.prototype.callback = function () {
  var that = this;
  return function (err, file) {
    if (err) {
      return that.reject(err);
    }
    that.resolve(file);
  };
};
var Promise = function () {
  // é˜Ÿåˆ—ç”¨äºå­˜å‚¨æ‰§è¡Œçš„å›è°ƒå‡½æ•°
  this.queue = [];
  this.isPromise = true;
};
Promise.prototype.then = function (
  fulfilledHandler,
  errorHandler,
  progressHandler
) {
  var handler = {};
  if (typeof fulfilledHandler === &quot;function&quot;) {
    handler.fulfilled = fulfilledHandler;
  }
  if (typeof errorHandler === &quot;function&quot;) {
    handler.error = errorHandler;
  }
  this.queue.push(handler);
  return this;
};

</code></pre></div><p>è¿™é‡Œæˆ‘ä»¬ä»¥ä¸¤æ¬¡æ–‡ä»¶è¯»å–ä½œä¸ºä¾‹å­ï¼Œä»¥éªŒè¯è¯¥è®¾è®¡çš„å¯è¡Œæ€§ã€‚è¿™é‡Œå‡è®¾è¯»å–ç¬¬äºŒä¸ªæ–‡ä»¶æ˜¯ä¾
èµ–äºç¬¬ä¸€ä¸ªæ–‡ä»¶ä¸­çš„å†…å®¹çš„ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>var readFile1 = function (file, encoding) {
 var deferred = new Deferred();
 fs.readFile(file, encoding, deferred.callback());
 return deferred.promise;
};
var readFile2 = function (file, encoding) {
 var deferred = new Deferred();
 fs.readFile(file, encoding, deferred.callback());
 return deferred.promise;
};
readFile1('file1.txt', 'utf8').then(function (file1) {
 return readFile2(file1.trim(), 'utf8');
}).then(function (file2) {
 console.log(file2);
}); 
</code></pre></div><h4 id="æµç¨‹æ§åˆ¶åº“"><a href="#æµç¨‹æ§åˆ¶åº“" class="header-anchor">#</a> æµç¨‹æ§åˆ¶åº“</h4> <p>æœ€ä¸ºä¸»æµçš„æ¨¡å¼â€”â€”äº‹ä»¶å‘å¸ƒ/è®¢é˜…æ¨¡å¼å’ŒPromise/Deferredæ¨¡å¼ï¼Œ</p> <ol><li>å°¾è§¦å‘ä¸Next</li></ol> <p>é™¤äº†äº‹ä»¶å’ŒPromiseå¤–ï¼Œè¿˜æœ‰ä¸€ç±»æ–¹æ³•æ˜¯éœ€è¦æ‰‹å·¥è°ƒç”¨æ‰èƒ½æŒç»­æ‰§è¡Œåç»­è°ƒç”¨çš„ï¼Œæˆ‘ä»¬å°†æ­¤ç±»æ–¹æ³•å«åš<code>å°¾è§¦å‘</code>ï¼Œå¸¸è§çš„å…³é”®è¯æ˜¯<code>next</code>ã€‚äº‹å®ä¸Šï¼Œå°¾è§¦å‘ç›®å‰åº”ç”¨æœ€å¤šçš„åœ°æ–¹æ˜¯Connectçš„ä¸­é—´ä»¶ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>var app = connect();
// Middleware
app.use(connect.staticCache());
app.use(connect.static(__dirname + '/public'));
app.use(connect.cookieParser());
app.use(connect.session());
app.use(connect.query());
app.use(connect.bodyParser());
app.use(connect.csrf());
app.listen(3001); 
</code></pre></div><p>åœ¨é€šè¿‡use()æ–¹æ³•æ³¨å†Œå¥½ä¸€ç³»åˆ—ä¸­é—´ä»¶åï¼Œç›‘å¬ç«¯å£ä¸Šçš„è¯·æ±‚ã€‚ä¸­é—´ä»¶åˆ©ç”¨äº†å°¾è§¦å‘çš„æœºåˆ¶ï¼Œ
æœ€ç®€å•çš„ä¸­é—´ä»¶å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>function (req, res, next) {
 // ä¸­é—´ä»¶
} 
</code></pre></div><p>æ¯ä¸ªä¸­é—´ä»¶ä¼ é€’è¯·æ±‚å¯¹è±¡ã€å“åº”å¯¹è±¡å’Œå°¾è§¦å‘å‡½æ•°ï¼Œé€šè¿‡é˜Ÿåˆ—å½¢æˆä¸€ä¸ªå¤„ç†æµ
<img src="/images/node/%E4%B8%AD%E9%97%B4%E4%BB%B6%E9%80%9A%E8%BF%87%E9%98%9F%E5%88%97%E5%BD%A2%E6%88%90%E4%B8%80%E4%B8%AA%E5%A4%84%E7%90%86%E6%B5%81.png" alt=""></p> <p>ä¸­é—´ä»¶æœºåˆ¶ä½¿å¾—åœ¨å¤„ç†ç½‘ç»œè¯·æ±‚æ—¶ï¼Œå¯ä»¥åƒé¢å‘åˆ‡é¢ç¼–ç¨‹ä¸€æ ·è¿›è¡Œè¿‡æ»¤ã€éªŒè¯ã€æ—¥å¿—ç­‰åŠŸèƒ½ï¼Œè€Œä¸ä¸å…·ä½“ä¸šåŠ¡é€»è¾‘äº§ç”Ÿå…³è”ï¼Œä»¥è‡´äº§ç”Ÿè€¦åˆã€‚
Connectçš„æ ¸å¿ƒå®ç°</p> <div class="language- extra-class"><pre class="language-text"><code>function createServer() {
  // åˆ›å»ºäº†HTTPæœåŠ¡å™¨çš„requestäº‹ä»¶å¤„ç†å‡½æ•°ï¼š
 function app(req, res){ app.handle(req, res); }
 utils.merge(app, proto);
 utils.merge(app, EventEmitter.prototype);
 app.route = '/';
 // stackå±æ€§æ˜¯è¿™ä¸ªæœåŠ¡å™¨å†…éƒ¨ç»´æŠ¤çš„ä¸­é—´ä»¶é˜Ÿåˆ—ã€‚é€šè¿‡è°ƒç”¨use()æ–¹æ³•æˆ‘ä»¬å¯ä»¥å°†ä¸­é—´ä»¶æ”¾è¿›é˜Ÿåˆ—ä¸­
 app.stack = [];
 for (var i = 0; i &lt; arguments.length; ++i) {
 app.use(arguments[i]);
 }
 return app;
};
</code></pre></div><p>use()æ–¹æ³•çš„é‡è¦éƒ¨åˆ†</p> <div class="language- extra-class"><pre class="language-text"><code>app.use = function(route, fn){
 // some code
 this.stack.push({ route: route, handle: fn });
 return this;
</code></pre></div><p>ç›‘å¬å‡½æ•°çš„å®ç°å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>app.listen = function(){
 var server = http.createServer(this);
 return server.listen.apply(server, arguments);
};
</code></pre></div><p>æœ€ç»ˆå›åˆ°app.handle()æ–¹æ³•ï¼Œæ¯ä¸€ä¸ªç›‘å¬åˆ°çš„ç½‘ç»œè¯·æ±‚éƒ½å°†ä»è¿™é‡Œå¼€å§‹å¤„ç†ã€‚è¯¥æ–¹æ³•çš„ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>app.handle = function(req, res, out) {
 // some code
 next();
}; 
</code></pre></div><p>åŸå§‹çš„next()æ–¹æ³•è¾ƒä¸ºå¤æ‚ï¼Œä¸‹é¢æ˜¯ç®€åŒ–åçš„å†…å®¹ï¼Œå…¶åŸç†ååˆ†ç®€å•ï¼Œå–å‡ºé˜Ÿåˆ—ä¸­çš„ä¸­é—´ä»¶å¹¶æ‰§è¡Œï¼ŒåŒæ—¶ä¼ å…¥å½“å‰æ–¹æ³•ä»¥å®ç°é€’å½’è°ƒç”¨ï¼Œè¾¾åˆ°æŒç»­è§¦å‘çš„ç›®çš„ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>function next(err) {
 // some code
 // next callback
 layer = stack[index++];
 layer.handle(req, res, next);
} 
</code></pre></div><ol start="2"><li>æµç¨‹æ§åˆ¶æ¨¡å—async</li></ol> <ul><li>å¼‚æ­¥çš„ä¸²è¡Œæ‰§è¡Œ
asyncæ˜¯å¦‚ä½•è§£å†³â€œæ¶é­”é‡‘å­—å¡”â€é—®é¢˜çš„ã€‚
asyncæä¾›äº†series()æ–¹æ³•æ¥å®ç°ä¸€ç»„ä»»åŠ¡çš„ä¸²è¡Œæ‰§è¡Œï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</li></ul> <div class="language- extra-class"><pre class="language-text"><code>var fs = require('fs');
var async = require(&quot;async&quot;);
async.series([
 function (callback) {
 fs.readFile('file1.txt', 'utf-8', callback);
 },
 function (callback) {
 fs.readFile('file2.txt', 'utf-8', callback);
 }
], function (err, results) {
 // results =&gt; [file1.txt, file2.txt]
}); 
</code></pre></div><p>è¿™æ®µä»£ç ç­‰ä»·äº:</p> <div class="language- extra-class"><pre class="language-text"><code>var fs = require('fs');
var async = require(&quot;async&quot;);
fs.readFile('file1.txt', 'utf-8', function (err, content) {
 if (err) {
 return callback(err);
 }
 fs.readFile('file2.txt ', 'utf-8', function (err, data) {
 if (err) {
 return callback(err);
 }
 callback(null, [content, data]);
 });
}); 
</code></pre></div><p>series()æ–¹æ³•ä¸­ä¼ å…¥çš„å‡½æ•°callback()å¹¶éç”±ä½¿ç”¨è€…æŒ‡å®šã€‚äº‹å®ä¸Šï¼Œæ­¤å¤„çš„å›è°ƒå‡½æ•°ç”±asyncé€šè¿‡é«˜é˜¶å‡½æ•°çš„æ–¹å¼æ³¨å…¥ï¼Œè¿™é‡Œéšå«äº†ç‰¹æ®Šçš„é€»è¾‘ã€‚æ¯ä¸ªcallback()æ‰§è¡Œæ—¶ä¼šå°†ç»“æœä¿å­˜èµ·æ¥ï¼Œç„¶åæ‰§è¡Œä¸‹ä¸€ä¸ªè°ƒç”¨ï¼Œç›´åˆ°ç»“æŸæ‰€æœ‰è°ƒç”¨ã€‚æœ€ç»ˆ
çš„å›è°ƒå‡½æ•°æ‰§è¡Œæ—¶ï¼Œé˜Ÿåˆ—é‡Œçš„å¼‚æ­¥è°ƒç”¨ä¿å­˜çš„ç»“æœä»¥æ•°ç»„çš„æ–¹å¼ä¼ å…¥ã€‚è¿™é‡Œçš„å¼‚å¸¸å¤„ç†è§„åˆ™æ˜¯ä¸€
æ—¦å‡ºç°å¼‚å¸¸ï¼Œå°±ç»“æŸæ‰€æœ‰è°ƒç”¨ï¼Œå¹¶å°†å¼‚å¸¸ä¼ é€’ç»™æœ€ç»ˆå›è°ƒå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚</p> <ul><li>å¼‚æ­¥çš„å¹¶è¡Œæ‰§è¡Œ
å½“æˆ‘ä»¬éœ€è¦é€šè¿‡å¹¶è¡Œæ¥æå‡æ€§èƒ½æ—¶ï¼Œasyncæä¾›äº†parallel()æ–¹æ³•ï¼Œç”¨ä»¥å¹¶è¡Œæ‰§è¡Œä¸€äº›å¼‚æ­¥æ“ä½œã€‚ä»¥ä¸‹ä¸ºè¯»å–ä¸¤ä¸ªæ–‡ä»¶çš„å¹¶è¡Œç‰ˆæœ¬ï¼š</li></ul> <div class="language- extra-class"><pre class="language-text"><code>async.parallel([
 function (callback) {
 fs.readFile('file1.txt', 'utf-8', callback);
 },
 function (callback) {
 fs.readFile('file2.txt', 'utf-8', callback);
 }
], function (err, results) {
 // results =&gt; [file1.txt, file2.txt]
});
</code></pre></div><p>ç­‰ä»·äº:</p> <div class="language- extra-class"><pre class="language-text"><code>var counter = 2;
var results = [];
var done = function (index, value) {
 results[index] = value;
 counter--;
 if (counter === 0) {
 callback(null, results);
 }
};
// åªä¼ é€’ç¬¬ä¸€ä¸ªå¼‚å¸¸
var hasErr = false;
var fail = function (err) {
 if (!hasErr) {
 hasErr = true;
 callback(err);
 }
};
fs.readFile('file1.txt', 'utf-8', function (err, content) {
 if (err) {
 return fail(err);
 }
 done(0, content);
});
fs.readFile('file2.txt', 'utf-8', function (err, data) {
 if (err) {
 return fail(err);
 }
 done(1, data);
});
</code></pre></div><ul><li>å¼‚æ­¥è°ƒç”¨çš„ä¾èµ–å¤„ç†
series()é€‚åˆæ— ä¾èµ–çš„å¼‚æ­¥ä¸²è¡Œæ‰§è¡Œï¼Œä½†å½“å‰ä¸€ä¸ªçš„ç»“æœæ˜¯åä¸€ä¸ªè°ƒç”¨çš„è¾“å…¥æ—¶ï¼Œseries()æ–¹æ³•å°±æ— æ³•æ»¡è¶³éœ€æ±‚äº†ã€‚æ‰€å¹¸ï¼Œè¿™ç§å…¸å‹åœºæ™¯çš„éœ€æ±‚ï¼Œasyncæä¾›äº†<code>waterfall()</code>æ–¹æ³•æ¥æ»¡è¶³ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</li></ul> <div class="language- extra-class"><pre class="language-text"><code>async.waterfall([
 function (callback) {
 fs.readFile('file1.txt', 'utf-8', function (err, content) {
 callback(err, content);
 });
 },
 function (arg1, callback) {
 // arg1 =&gt; file2.txt
 fs.readFile(arg1, 'utf-8', function (err, content) {
 callback(err, content);
 });
 },
 function(arg1, callback){
 // arg1 =&gt; file3.txt
 fs.readFile(arg1, 'utf-8', function (err, content) {
 callback(err, content);
 });
 }
], function (err, result) {
 // result =&gt; file4.txt
});
</code></pre></div><p>ç­‰ä»·äº:</p> <div class="language- extra-class"><pre class="language-text"><code>fs.readFile('file1.txt', 'utf-8', function (err, data1) {
 if (err) {
 return callback(err);
 }
 fs.readFile(data1, 'utf-8', function (err, data2) {
 if (err) {
 return callback(err);
 }
 fs.readFile(data2, 'utf-8', function (err, data3) {
 if (err) {
 return callback(err);
 }
 callback(null, data3);
 });
 });
}); 
</code></pre></div><ul><li>è‡ªåŠ¨ä¾èµ–å¤„ç†(auto)
auto()æ–¹æ³•èƒ½æ ¹æ®ä¾èµ–å…³ç³»è‡ªåŠ¨åˆ†æï¼Œä»¥æœ€ä½³çš„é¡ºåºæ‰§è¡Œä»¥ä¸Šä¸šåŠ¡ï¼š
async.auto(deps);</li></ul> <ol start="3"><li>Step
Stepä¸å‰é¢ä»‹ç»çš„äº‹ä»¶æ¨¡å¼ã€Promiseç”šè‡³asyncéƒ½ä¸åŒçš„ä¸€ç‚¹åœ¨äºStepç”¨åˆ°äº†thiså…³é”®å­—ã€‚äº‹å®ä¸Šï¼Œå®ƒæ˜¯Stepå†…éƒ¨çš„ä¸€ä¸ªnext()æ–¹æ³•ï¼Œå°†å¼‚æ­¥è°ƒç”¨çš„ç»“æœä¼ é€’ç»™ä¸‹ä¸€ä¸ªä»»åŠ¡ä½œä¸ºå‚æ•°ï¼Œå¹¶è°ƒç”¨æ‰§è¡Œã€‚
é€šè¿‡npm install stepå³å¯å®‰è£…ä½¿ç”¨ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹</li></ol> <div class="language- extra-class"><pre class="language-text"><code>Step(task1, task2, task3);
</code></pre></div><p>Stepæ¥å—ä»»æ„æ•°é‡çš„ä»»åŠ¡ï¼Œæ‰€æœ‰çš„ä»»åŠ¡éƒ½å°†ä¼šä¸²è¡Œä¾æ¬¡æ‰§è¡Œã€‚ä¸‹é¢çš„ç¤ºä¾‹ä»£ç å°†ä¾æ¬¡è¯»å–æ–‡ä»¶ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>Step(
 function readFile1() {
 fs.readFile('file1.txt', 'utf-8', this);
 },
 function readFile2(err, content) {
 fs.readFile('file2.txt', 'utf-8', this);
 },
 function done(err, content) {
 console.log(content);
 }
);
</code></pre></div><ul><li>å¹¶è¡Œä»»åŠ¡æ‰§è¡Œ
Stepå¦‚ä½•å®ç°å¤šä¸ªå¼‚æ­¥ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œå‘¢ï¼Ÿthiså…·æœ‰ä¸€ä¸ªparallel()æ–¹æ³•ï¼Œå®ƒå‘Šè¯‰Stepï¼Œéœ€è¦ç­‰æ‰€æœ‰ä»»åŠ¡å®Œæˆæ—¶æ‰è¿›è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</li></ul> <div class="language- extra-class"><pre class="language-text"><code>Step(
 function readFile1() {
 fs.readFile('file1.txt', 'utf-8', this.parallel());
 fs.readFile('file2.txt', 'utf-8', this.parallel());
 },
 function done(err, content1, content2) {
 // content1 =&gt; file1
 // content2 =&gt; file2
 console.log(arguments);
 }
);
</code></pre></div><p>ä½¿ç”¨parallel()çš„æ—¶å€™éœ€è¦å°å¿ƒçš„æ˜¯ï¼Œå¦‚æœå¼‚æ­¥æ–¹æ³•çš„ç»“æœä¼ å›çš„æ˜¯å¤šä¸ªå‚æ•°ï¼ŒStepå°†åªä¼šå–å‰ä¸¤ä¸ªå‚æ•°ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>var asyncCall = function (callback) {
 process.nextTick(function () {
 // åœ¨è°ƒç”¨parallel()æ—¶ï¼Œresult2å°†ä¼šè¢«ä¸¢å¼ƒã€‚
 callback(null, 'result1', 'result2');
 });
};
</code></pre></div><p>Stepæä¾›çš„å¦å¤–ä¸€ä¸ªæ–¹æ³•æ˜¯group()ï¼Œå®ƒç±»ä¼¼äºparallel()çš„æ•ˆæœï¼Œä½†æ˜¯åœ¨ç»“æœä¼ é€’ä¸Šç•¥æœ‰ä¸åŒã€‚ä¸‹é¢çš„ä»£ç ç”¨äºè¯»å–ä¸€ä¸ªç›®å½•ï¼Œç„¶åè¿­ä»£å…¶ä¸­æ–‡ä»¶çš„æ“ä½œï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>Step(
 function readDir() {
 fs.readdir(__dirname, this);
 },
 function readFiles(err, results) {
 if (err) throw err;
 // Create a new group
 var group = this.group();
 results.forEach(function (filename) {
 if (/\.js$/.test(filename)) {
 fs.readFile(__dirname + &quot;/&quot; + filename, 'utf8', group());
 }
 });
 },
 function showAll(err, files) {
 if (err) throw err;
 console.dir(files);
 }
); 
</code></pre></div><p>æœ‰ä¸¤æ¬¡group()çš„è°ƒç”¨ã€‚ç¬¬ä¸€æ¬¡è°ƒç”¨æ˜¯å‘ŠçŸ¥Stepè¦å¹¶è¡Œæ‰§è¡Œï¼Œç¬¬äºŒæ¬¡è°ƒç”¨çš„ç»“æœå°†ä¼šç”Ÿæˆä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè€Œå›è°ƒå‡½æ•°æ¥å—çš„è¿”å›å€¼å°†ä¼šæŒ‰ç»„å­˜å‚¨ã€‚parallel()ä¼ é€’ç»™ä¸‹ä¸€ä¸ªä»»åŠ¡çš„ç»“æœæ˜¯å¦‚ä¸‹å½¢å¼ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>function (err, result1, result2, ...);
</code></pre></div><p>group()ä¼ é€’çš„ç»“æœæ˜¯ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>function (err, results);
</code></pre></div><p>è¿™ä¸ªå‡½æ•°è¿”å›çš„æ•°æ®ä¿å­˜åœ¨æ•°ç»„ä¸­ã€‚</p> <h3 id="_04-å¼‚æ­¥å¹¶å‘æ§åˆ¶"><a href="#_04-å¼‚æ­¥å¹¶å‘æ§åˆ¶" class="header-anchor">#</a> 04. å¼‚æ­¥å¹¶å‘æ§åˆ¶</h3> <p>åœ¨Nodeä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ååˆ†æ–¹ä¾¿åœ°åˆ©ç”¨å¼‚æ­¥å‘èµ·å¹¶è¡Œè°ƒç”¨ã€‚ä½¿ç”¨ä¸‹é¢çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾å‘èµ·100æ¬¡å¼‚æ­¥è°ƒç”¨ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>for (var i = 0, i &lt; 100; i++) {
 async();
}
</code></pre></div><p>ä½†æ˜¯å¦‚æœå¹¶å‘é‡è¿‡å¤§ï¼Œæˆ‘ä»¬çš„ä¸‹å±‚æœåŠ¡å™¨å°†ä¼šåƒä¸æ¶ˆã€‚å¦‚æœæ˜¯å¯¹æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå¤§é‡å¹¶å‘è°ƒç”¨ï¼Œæ“ä½œç³»ç»Ÿçš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡å°†ä¼šè¢«ç¬é—´ç”¨å…‰ï¼ŒæŠ›å‡ºå¦‚ä¸‹é”™è¯¯ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>Error: EMFILE, too many open files
</code></pre></div><h4 id="asyncçš„è§£å†³æ–¹æ¡ˆ"><a href="#asyncçš„è§£å†³æ–¹æ¡ˆ" class="header-anchor">#</a> asyncçš„è§£å†³æ–¹æ¡ˆ</h4> <p>asyncä¹Ÿæä¾›äº†ä¸€ä¸ªæ–¹æ³•ç”¨äºå¤„ç†å¼‚æ­¥è°ƒç”¨çš„é™åˆ¶ï¼šparallelLimit()ã€‚å¦‚ä¸‹æ˜¯asyncçš„ç¤ºä¾‹ä»£ç ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>async.parallelLimit([
 function (callback) {
 fs.readFile('file1.txt', 'utf-8', callback);
 },
 function (callback) {
 fs.readFile('file2.txt', 'utf-8', callback);
 }
], 1, function (err, results) {
 // TODO
}); 
</code></pre></div><p>parallelLimit()ä¸parallel()ç±»ä¼¼ï¼Œä½†å¤šäº†ä¸€ä¸ªç”¨äºé™åˆ¶å¹¶å‘æ•°é‡çš„å‚æ•°ï¼Œä½¿å¾—ä»»åŠ¡åªèƒ½åŒæ—¶å¹¶å‘ä¸€å®šæ•°é‡ï¼Œè€Œä¸æ˜¯æ— é™åˆ¶å¹¶å‘ã€‚</p></div></div> <!----> <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=node" title="æ ‡ç­¾">#node</a></div> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/1b14a3/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">å¼‚æ­¥I/Oæ“ä½œ</div></a> <a href="/pages/4fe0f1/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">å†…å­˜æ§åˆ¶</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/pages/1b14a3/" class="prev">å¼‚æ­¥I/Oæ“ä½œ</a></span> <span class="next"><a href="/pages/4fe0f1/">å†…å­˜æ§åˆ¶</a>â†’
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">æœ€è¿‘æ›´æ–°</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/30a399/"><div>
            flutteråŸºæœ¬è¯­æ³•
            <!----></div></a> <span class="date">06-19</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/ad8265/"><div>
            Dart
            <!----></div></a> <span class="date">06-12</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/a158f0/"><div>
            å®‰è£…
            <!----></div></a> <span class="date">06-12</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">æ›´å¤šæ–‡ç« &gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1730129114@qq.com" title="å‘é‚®ä»¶" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/wshuhua" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/my/m/music/playlist?id=7141103351" title="å¬éŸ³ä¹" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜">Vdoing</a> 
    | Copyright Â© 2022-2022
    <span>Wsh  | <a href="https://github.com/wshuhua" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2240256e.js" defer></script><script src="/assets/js/2.dc8a2400.js" defer></script><script src="/assets/js/36.810c79b4.js" defer></script>
  </body>
</html>
