<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>react hook | Wsh&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/images/logo.png">
    <meta name="description" content="ç»å¸¸å·æ‡’ï¼Œå¶å°”æ›´æ–°çš„">
    
    <link rel="preload" href="/assets/css/0.styles.bc63fb2f.css" as="style"><link rel="preload" href="/assets/js/app.7428c7eb.js" as="script"><link rel="preload" href="/assets/js/2.dc8a2400.js" as="script"><link rel="preload" href="/assets/js/61.9dbd8f8f.js" as="script"><link rel="prefetch" href="/assets/js/10.0b1da748.js"><link rel="prefetch" href="/assets/js/11.8e999e9c.js"><link rel="prefetch" href="/assets/js/12.d98e8047.js"><link rel="prefetch" href="/assets/js/13.a19f7b3e.js"><link rel="prefetch" href="/assets/js/14.bc46e720.js"><link rel="prefetch" href="/assets/js/15.77a7cb2e.js"><link rel="prefetch" href="/assets/js/16.45f3798f.js"><link rel="prefetch" href="/assets/js/17.65043558.js"><link rel="prefetch" href="/assets/js/18.7e1c162b.js"><link rel="prefetch" href="/assets/js/19.f5e9d214.js"><link rel="prefetch" href="/assets/js/20.bf9ff7ad.js"><link rel="prefetch" href="/assets/js/21.1d1c8e0a.js"><link rel="prefetch" href="/assets/js/22.2bbf7c75.js"><link rel="prefetch" href="/assets/js/23.ff522e28.js"><link rel="prefetch" href="/assets/js/24.80281415.js"><link rel="prefetch" href="/assets/js/25.fee129c3.js"><link rel="prefetch" href="/assets/js/26.05814d9e.js"><link rel="prefetch" href="/assets/js/27.f1483324.js"><link rel="prefetch" href="/assets/js/28.341c486b.js"><link rel="prefetch" href="/assets/js/29.36280864.js"><link rel="prefetch" href="/assets/js/3.c6e3a68f.js"><link rel="prefetch" href="/assets/js/30.63efe985.js"><link rel="prefetch" href="/assets/js/31.a05773a6.js"><link rel="prefetch" href="/assets/js/32.d4b8380a.js"><link rel="prefetch" href="/assets/js/33.2733e58c.js"><link rel="prefetch" href="/assets/js/34.b787cd05.js"><link rel="prefetch" href="/assets/js/35.8ddd3aad.js"><link rel="prefetch" href="/assets/js/36.fd66b7be.js"><link rel="prefetch" href="/assets/js/37.1f273693.js"><link rel="prefetch" href="/assets/js/38.9b6a85e2.js"><link rel="prefetch" href="/assets/js/39.b10c605d.js"><link rel="prefetch" href="/assets/js/4.c704e751.js"><link rel="prefetch" href="/assets/js/40.42ea8f1b.js"><link rel="prefetch" href="/assets/js/41.de286cfc.js"><link rel="prefetch" href="/assets/js/42.b7a14242.js"><link rel="prefetch" href="/assets/js/43.c7ee3fd1.js"><link rel="prefetch" href="/assets/js/44.be5fb2d8.js"><link rel="prefetch" href="/assets/js/45.a31195a1.js"><link rel="prefetch" href="/assets/js/46.24443612.js"><link rel="prefetch" href="/assets/js/47.c20f554a.js"><link rel="prefetch" href="/assets/js/48.3fe4b661.js"><link rel="prefetch" href="/assets/js/49.dc4ed448.js"><link rel="prefetch" href="/assets/js/5.2db75e05.js"><link rel="prefetch" href="/assets/js/50.52a8634c.js"><link rel="prefetch" href="/assets/js/51.c5090238.js"><link rel="prefetch" href="/assets/js/52.fee5c082.js"><link rel="prefetch" href="/assets/js/53.6d66e2e2.js"><link rel="prefetch" href="/assets/js/54.1ea8847a.js"><link rel="prefetch" href="/assets/js/55.a4506f0b.js"><link rel="prefetch" href="/assets/js/56.026c144a.js"><link rel="prefetch" href="/assets/js/57.6950168a.js"><link rel="prefetch" href="/assets/js/58.3b5bee4a.js"><link rel="prefetch" href="/assets/js/59.14d40836.js"><link rel="prefetch" href="/assets/js/6.9073f8bb.js"><link rel="prefetch" href="/assets/js/60.f33286ea.js"><link rel="prefetch" href="/assets/js/62.28ca62b2.js"><link rel="prefetch" href="/assets/js/63.b1da1041.js"><link rel="prefetch" href="/assets/js/64.f8a078ac.js"><link rel="prefetch" href="/assets/js/65.ead30d81.js"><link rel="prefetch" href="/assets/js/66.ba5e43dd.js"><link rel="prefetch" href="/assets/js/67.8f8e8e0e.js"><link rel="prefetch" href="/assets/js/68.0a9fe8d6.js"><link rel="prefetch" href="/assets/js/69.de09750c.js"><link rel="prefetch" href="/assets/js/7.da5a6bb4.js"><link rel="prefetch" href="/assets/js/70.09ac1f03.js"><link rel="prefetch" href="/assets/js/71.4d1a5bf1.js"><link rel="prefetch" href="/assets/js/72.dd24a597.js"><link rel="prefetch" href="/assets/js/73.38d3dc21.js"><link rel="prefetch" href="/assets/js/74.a741da58.js"><link rel="prefetch" href="/assets/js/75.f82d1bfe.js"><link rel="prefetch" href="/assets/js/76.ef8febd4.js"><link rel="prefetch" href="/assets/js/77.9faf37c0.js"><link rel="prefetch" href="/assets/js/78.f1bf4247.js"><link rel="prefetch" href="/assets/js/79.711c48b7.js"><link rel="prefetch" href="/assets/js/8.b3362f93.js"><link rel="prefetch" href="/assets/js/80.350a08ce.js"><link rel="prefetch" href="/assets/js/81.4d0bec9c.js"><link rel="prefetch" href="/assets/js/82.26c7a4d7.js"><link rel="prefetch" href="/assets/js/83.658b1054.js"><link rel="prefetch" href="/assets/js/84.25610346.js"><link rel="prefetch" href="/assets/js/85.6b4dccbc.js"><link rel="prefetch" href="/assets/js/86.d681571d.js"><link rel="prefetch" href="/assets/js/87.69c93363.js"><link rel="prefetch" href="/assets/js/88.a625084a.js"><link rel="prefetch" href="/assets/js/89.5571c74e.js"><link rel="prefetch" href="/assets/js/9.286a6060.js"><link rel="prefetch" href="/assets/js/90.b443e4b5.js"><link rel="prefetch" href="/assets/js/91.aad43151.js">
    <link rel="stylesheet" href="/assets/css/0.styles.bc63fb2f.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/1.gif" alt="Wsh's blog" class="logo"> <span class="site-name can-hide">Wsh's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="AIGC" class="dropdown-title"><a href="/aiAgent/" class="link-title">AIGC</a> <span class="title" style="display:none;">AIGC</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/aiAgent/bacis/" class="nav-link">AgentåŸºç¡€</a></li><li class="dropdown-item"><!----> <a href="/aiAgent/design/" class="nav-link">Agentè®¾è®¡æ¨¡å¼</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="harmonyOS" class="dropdown-title"><a href="/harmonyOS/" class="link-title">harmonyOS</a> <span class="title" style="display:none;">harmonyOS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/harmonyOS/base/" class="nav-link">åŸºç¡€çŸ¥è¯†</a></li><li class="dropdown-item"><!----> <a href="/harmonyOS/ArkUI/" class="nav-link">ArkUI</a></li><li class="dropdown-item"><!----> <a href="/harmonyOS/UIAbility/" class="nav-link">UIAbility</a></li><li class="dropdown-item"><!----> <a href="/harmonyOS/state/" class="nav-link">ç»„ä»¶é€šä¿¡æ–¹å¼</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="çŸ¥è¯†ğŸ‘–" class="dropdown-title"><a href="/note/" class="link-title">çŸ¥è¯†ğŸ‘–</a> <span class="title" style="display:none;">çŸ¥è¯†ğŸ‘–</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/cache/" class="nav-link">å‰ç«¯ç¼“å­˜</a></li><li class="dropdown-item"><!----> <a href="/note/react/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/note/typescript/" class="nav-link">typescript</a></li><li class="dropdown-item"><!----> <a href="/note/javascript/" class="nav-link">javascript</a></li><li class="dropdown-item"><!----> <a href="/note/flutter/" class="nav-link">flutter</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å·¥ç¨‹ğŸŒ¹" class="dropdown-title"><a href="/tool/" class="link-title">å·¥ç¨‹ğŸŒ¹</a> <span class="title" style="display:none;">å·¥ç¨‹ğŸŒ¹</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool/node/" class="nav-link">node</a></li><li class="dropdown-item"><!----> <a href="/tool/webpack/" class="nav-link">webpack</a></li></ul></div></div><div class="nav-item"><a href="/web3D/" class="nav-link">web3DğŸ˜‰</a></div><div class="nav-item"><a href="/pages/ca0c25/" class="nav-link">å®åº“ğŸ“°</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•ğŸ”’" class="dropdown-title"><a href="/archives/" class="link-title">ç´¢å¼•ğŸ”’</a> <span class="title" style="display:none;">ç´¢å¼•ğŸ”’</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><a href="https://blog.fudenglong.site" target="_blank" rel="noopener noreferrer" class="nav-link external">
  é¾™å“¥çš„å¤§ğŸ‚ä¹‹è·¯
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/wshuhua" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/images/avatar.gif"> <div class="blogger-info"><h3>wsh</h3> <span>çƒ­çˆ±å‰ç«¯çš„ç¨‹åºåª›</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="AIGC" class="dropdown-title"><a href="/aiAgent/" class="link-title">AIGC</a> <span class="title" style="display:none;">AIGC</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/aiAgent/bacis/" class="nav-link">AgentåŸºç¡€</a></li><li class="dropdown-item"><!----> <a href="/aiAgent/design/" class="nav-link">Agentè®¾è®¡æ¨¡å¼</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="harmonyOS" class="dropdown-title"><a href="/harmonyOS/" class="link-title">harmonyOS</a> <span class="title" style="display:none;">harmonyOS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/harmonyOS/base/" class="nav-link">åŸºç¡€çŸ¥è¯†</a></li><li class="dropdown-item"><!----> <a href="/harmonyOS/ArkUI/" class="nav-link">ArkUI</a></li><li class="dropdown-item"><!----> <a href="/harmonyOS/UIAbility/" class="nav-link">UIAbility</a></li><li class="dropdown-item"><!----> <a href="/harmonyOS/state/" class="nav-link">ç»„ä»¶é€šä¿¡æ–¹å¼</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="çŸ¥è¯†ğŸ‘–" class="dropdown-title"><a href="/note/" class="link-title">çŸ¥è¯†ğŸ‘–</a> <span class="title" style="display:none;">çŸ¥è¯†ğŸ‘–</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/cache/" class="nav-link">å‰ç«¯ç¼“å­˜</a></li><li class="dropdown-item"><!----> <a href="/note/react/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/note/typescript/" class="nav-link">typescript</a></li><li class="dropdown-item"><!----> <a href="/note/javascript/" class="nav-link">javascript</a></li><li class="dropdown-item"><!----> <a href="/note/flutter/" class="nav-link">flutter</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å·¥ç¨‹ğŸŒ¹" class="dropdown-title"><a href="/tool/" class="link-title">å·¥ç¨‹ğŸŒ¹</a> <span class="title" style="display:none;">å·¥ç¨‹ğŸŒ¹</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool/node/" class="nav-link">node</a></li><li class="dropdown-item"><!----> <a href="/tool/webpack/" class="nav-link">webpack</a></li></ul></div></div><div class="nav-item"><a href="/web3D/" class="nav-link">web3DğŸ˜‰</a></div><div class="nav-item"><a href="/pages/ca0c25/" class="nav-link">å®åº“ğŸ“°</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•ğŸ”’" class="dropdown-title"><a href="/archives/" class="link-title">ç´¢å¼•ğŸ”’</a> <span class="title" style="display:none;">ç´¢å¼•ğŸ”’</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><a href="https://blog.fudenglong.site" target="_blank" rel="noopener noreferrer" class="nav-link external">
  é¾™å“¥çš„å¤§ğŸ‚ä¹‹è·¯
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/wshuhua" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> reactåŸºç¡€</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> reactæ›´æ–°ç‰¹æ€§</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span> reactè¿›é˜¶</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/c34d3a/" class="sidebar-link">react æ¶æ„æ¼”å˜</a></li><li><a href="/pages/b5b966/" class="sidebar-link">react renderé˜¶æ®µ</a></li><li><a href="/pages/f04e17/" class="sidebar-link">react commité˜¶æ®µ</a></li><li><a href="/pages/fb794b/" class="sidebar-link">react diff</a></li><li><a href="/pages/1ac33a/" class="sidebar-link">react çŠ¶æ€æ›´æ–°</a></li><li><a href="/pages/f09444/" aria-current="page" class="active sidebar-link">react hook</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/f67937/" class="sidebar-link">Concurrent Mode</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-6"><div class="articleInfo-wrap" data-v-0c557b5e><div class="articleInfo" data-v-0c557b5e><ul class="breadcrumbs" data-v-0c557b5e><li data-v-0c557b5e><a href="/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-0c557b5e></a></li> <li data-v-0c557b5e><a href="/note/react/#react" data-v-0c557b5e>react</a></li><li data-v-0c557b5e><a href="/note/react/# reactè¿›é˜¶" data-v-0c557b5e> reactè¿›é˜¶</a></li></ul> <div class="info" data-v-0c557b5e><!----> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-0c557b5e><a href="javascript:;" data-v-0c557b5e>2022-04-22</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">ç›®å½•</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">react hook<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h3 id="_01-hooks-demo"><a href="#_01-hooks-demo" class="header-anchor">#</a> 01. hooks demo</h3> <div class="language- extra-class"><pre class="language-text"><code>      let workInProgressHook;
      let isMount = true;

      const fiber = {
        memoizedState: null,
        stateNode: App,
      };
      function run() {
        workInProgressHook = fiber.memoizedState;
        const app = fiber.stateNode();
        isMount = false;
        return app;
      }
      function dispatchAction(queue, action) {
        const update = {
          action,
          next: null,
        };
        console.log(queue, &quot;update1&quot;);
        if (queue.pending === null) {
          update.next = update;
          console.log(update, &quot;update2&quot;);
        } else {
          // 3 -&gt; 0 -&gt; 1 -&gt; 2 -&gt; 3
          // 4 -&gt; 0 -&gt; 1 -&gt; 2 -&gt; 3 -&gt; 4
          // queue.pending æŒ‡å‘æœ€åä¸€ä¸ªupdateï¼Œqueue.pending.next æŒ‡å‘ç¬¬ä¸€ä¸ªupdate
          update.next = queue.pending.next; // 4 -&gt; 0
          queue.pending.next = update; // 3 -&gt; 4
        }
        queue.pending = update; // å½“å‰æœ€åä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘update

        run();
      }
      function useState(initialState) {
        let hook;
        if (isMount) {
          hook = {
            queue: {
              pending: null,
            },
            memoizedState: initialState,
            next: null,
          };
          if (!fiber.memoizedState) {
            fiber.memoizedState = hook;
          } else {
            workInProgressHook.next = hook;
          }
          workInProgressHook = hook;
        } else {
          hook = workInProgressHook;
          workInProgressHook = workInProgressHook.next;
        }

        let baseState = hook.memoizedState;

        if (hook.queue.pending) {
          let firstUpdate = hook.queue.pending.next;

          do {
            const action = firstUpdate.action;
            baseState = action(baseState);
            firstUpdate = firstUpdate.next;
          } while (firstUpdate !== hook.queue.pending);

          hook.queue.pending = null;
        }
        hook.memoizedState = baseState;
        return [baseState, dispatchAction.bind(null, hook.queue)];
      }
      function App() {
        const [num, updateNum] = useState(0);
        console.log(`${isMount ? &quot;mount&quot; : &quot;update&quot;} num: `, num);
        return {
          click() {
            updateNum((num) =&gt; num + 1);
          },
        };
      }
      window.app = run();

</code></pre></div><h3 id="_02-hooksåŒºåˆ†"><a href="#_02-hooksåŒºåˆ†" class="header-anchor">#</a> 02. hooksåŒºåˆ†</h3> <p>mount/updateä¸‹çš„hooksæ¥æºäºä¸åŒçš„å¯¹è±¡ï¼Œè¿™ç±»å¯¹è±¡ç§°ä¹‹ä¸ºï¼š dispatcher</p> <p>mountæ—¶ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>const HooksDispatcherOnMount: Dispatcher = {
  readContext,

  useCallback: mountCallback,
  useContext: readContext,
  useEffect: mountEffect,
  useImperativeHandle: mountImperativeHandle,
  useLayoutEffect: mountLayoutEffect,
  useInsertionEffect: mountInsertionEffect,
  useMemo: mountMemo,
  useReducer: mountReducer,
  useRef: mountRef,
  useState: mountState,
  useDebugValue: mountDebugValue,
  useDeferredValue: mountDeferredValue,
  useTransition: mountTransition,
  useMutableSource: mountMutableSource,
  useSyncExternalStore: mountSyncExternalStore,
  useId: mountId,

  unstable_isNewReconciler: enableNewReconciler,
};
</code></pre></div><p>updateæ—¶ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>const HooksDispatcherOnUpdate: Dispatcher = {
  readContext,

  useCallback: updateCallback,
  useContext: readContext,
  useEffect: updateEffect,
  useImperativeHandle: updateImperativeHandle,
  useInsertionEffect: updateInsertionEffect,
  useLayoutEffect: updateLayoutEffect,
  useMemo: updateMemo,
  useReducer: updateReducer,
  useRef: updateRef,
  useState: updateState,
  useDebugValue: updateDebugValue,
  useDeferredValue: updateDeferredValue,
  useTransition: updateTransition,
  useMutableSource: updateMutableSource,
  useSyncExternalStore: updateSyncExternalStore,
  useId: updateId,

  unstable_isNewReconciler: enableNewReconciler,
};
</code></pre></div><p>åœ¨mount/updateè°ƒç”¨çš„hookæ˜¯ä¸åŒçš„å‡½æ•°ã€‚
å°†ä¸åŒæƒ…å†µå¯¹åº”çš„dispatcherèµ‹å€¼ç»™å…¨å±€å˜é‡ReactCurrentDispatcherçš„currentå±æ€§ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>    ReactCurrentDispatcher.current =
      current === null || current.memoizedState === null
        ? HooksDispatcherOnMount
        : HooksDispatcherOnUpdate;
</code></pre></div><h3 id="_03-hookçš„æ•°æ®ç»“æ„"><a href="#_03-hookçš„æ•°æ®ç»“æ„" class="header-anchor">#</a> 03. hookçš„æ•°æ®ç»“æ„</h3> <div class="language- extra-class"><pre class="language-text"><code>const hook: Hook = {
  memoizedState: null,

  baseState: null,
  baseQueue: null,
  queue: null,

  next: null
}
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">æ³¨æ„</p> <p>hook.memoizedState: Hooksé“¾è¡¨ä¸­ä¿å­˜çš„å•ä¸€hookå¯¹åº”çš„æ•°æ®</p> <p>fiber.memoizedState:  FunctionComponent å¯¹åº”fiberä¿å­˜çš„Hooksé“¾è¡¨</p></div> <h3 id="_04-hooksçš„è°ƒç”¨é¡ºåº"><a href="#_04-hooksçš„è°ƒç”¨é¡ºåº" class="header-anchor">#</a> 04. hooksçš„è°ƒç”¨é¡ºåº</h3> <p>å½“åˆå§‹åŒ–useStateçš„æ—¶å€™ï¼Œhooksæ˜¯é€šè¿‡nextæ¥ç»‘å®šstateçš„é¡ºåºçš„ï¼Œå¦‚æœåœ¨å¤šæ¬¡è°ƒç”¨hooksæ—¶ï¼Œå°†å…¶ä¸­ä¸€ä¸ªuseStateæœ‰æ¡ä»¶çš„çœç•¥ï¼Œä¸æ‰§è¡Œï¼Œé‚£ä¹ˆ.nextçš„æ—¶å€™ï¼Œè·å¾—çš„stateå°±ä¸æ˜¯å¯¹åº”çš„stateï¼Œä¼šé€ æˆstateé”™ä½ã€‚</p> <h3 id="_05-memoizedstate"><a href="#_05-memoizedstate" class="header-anchor">#</a> 05. memoizedState</h3> <p>ä¸åŒç±»å‹ä¿å­˜çš„memoizedStateæ•°æ®æ ¼å¼ä¸ä¸€è‡´</p> <ul><li>useState: å¯¹äºconst [value, setValue] = useState(initialState)ï¼ŒmemoizedStateä¿å­˜valueçš„å€¼</li> <li>useReducer: å¯¹äºconst [state, dispatch]= useReducer(reducer, {}),memoized ä¿å­˜stateçš„å€¼ã€‚</li> <li>useEffectï¼šmemoizedStateä¿å­˜useEffect å›è°ƒå‡½æ•°ï¼Œä¾èµ–é¡¹ç­‰çš„é“¾è¡¨ç»“æ„effectï¼Œeffecté“¾è¡¨åŒæ—¶ä¼šä¿å­˜åœ¨fiber.updateQueueä¸­ã€‚</li> <li>useMemo: å¯¹äºuseMemo(callback, [depA]), memoizedStateä¿å­˜(callback, [depA])</li> <li>useCallback: å¯¹äºuseCallback(callback, [depA])ï¼ŒmemoizedStateä¿å­˜(callback, [depA]),ä¸useMemoä¸åŒçš„æ˜¯ï¼ŒuseCallbackä¿å­˜çš„æ˜¯callbackå‡½æ•°æœ¬èº«ï¼ŒuseMemoä¿å­˜çš„æ˜¯callbackè¿”å›çš„ç»“æœ</li> <li>useRef: useRef(1), memoizedStateä¿å­˜{current: 1}</li></ul> <p>æ²¡æœ‰memoizedState:</p> <ul><li>useContext</li></ul> <h3 id="_06-usestate-usereducer"><a href="#_06-usestate-usereducer" class="header-anchor">#</a> 06. useState/useReducer</h3> <p>useReduceræ˜¯useStateçš„æ›¿ä»£æ–¹æ¡ˆï¼Œä¼šæ¥æ”¶ä¸€ä¸ª (state, action) =&gt; newStateçš„reducerï¼Œå¹¶è¿”å›å½“å‰çš„stateä»¥åŠé…å¥—çš„dispatch
hookçš„å·¥ä½œæµç¨‹ä¸»è¦åˆ†ä¸ºï¼šå£°æ˜é˜¶æ®µå’Œè°ƒç”¨é˜¶æ®µã€‚</p> <ul><li>å£°æ˜é˜¶æ®µå°±æ˜¯åœ¨æ‰€åœ¨å‡½æ•°è°ƒç”¨æ—¶ï¼Œä¾æ¬¡æ‰§è¡ŒuseReducer å’ŒuseStateæ–¹æ³•</li> <li>è°ƒç”¨é˜¶æ®µå³ç‚¹å³æŒ‰é’®åï¼Œdispatchæˆ–setValueè¢«è°ƒç”¨æ—¶ã€‚</li></ul> <h4 id="_07-å£°æ˜é˜¶æ®µ"><a href="#_07-å£°æ˜é˜¶æ®µ" class="header-anchor">#</a> 07. å£°æ˜é˜¶æ®µ</h4> <p>renderé˜¶æ®µbeginwork -&gt; renderWithHooks æ–¹æ³•</p> <div class="language- extra-class"><pre class="language-text"><code>function useState(initialState) {
  var dispatcher = resolveDispatcher();
  return dispatch.useState(initialState);
}

function useReducer(reducer, initialArg, init) {
  var dispater = resolveDispatcher();
  var dispatcher.useReducer(reducer, initialArg, init);
}
</code></pre></div><p>dispater åœ¨Â·ä¸åŒåœºæ™¯ä¸‹åŒä¸€ä¸ªhookä¼šè°ƒç”¨ä¸åŒçš„å‡½æ•°</p> <h4 id="_08-mountstate-mountreducer"><a href="#_08-mountstate-mountreducer" class="header-anchor">#</a> 08. mountState/mountReducer</h4> <div class="language- extra-class"><pre class="language-text"><code>function mountState&lt;S&gt;(
  initialState:(()=&gt;S) | S,
):[S, Dispatch&lt;BasicStateAction&lt;S&gt;&gt;] {
  // åˆ›å»ºå¹¶è¿”å›å½“å‰hook
  const hook = mountWorkInProgress();

  // èµ‹å€¼åˆå§‹state
  if (typeof initialState === 'function') {
    initialState = initialState();
  }
  hook.memoizedState = hook.baseState = initialState;
  const queue: UpdateQueue&lt;S, BasicStateAction&lt;S&gt;&gt; = {
    pending: null,
    interleaved: null,
    lanes: NoLanes,
    dispatch: null,
    lastRenderedReducer: basicStateReducer,
    lastRenderedState: (initialState: any),
  };

  // åˆ›å»ºqueue
  const queue = (hook.queue = {
    pending: null,
    dispatch: null,
    lastRenderedReducer: basicStateReducer,
    lastRenderedState: (initialState: any)
  })

  // åˆ›å»ºdispatch

  const dispatch: Dispatch&lt;
    BasicStateAction&lt;S&gt;,
  &gt; = (queue.dispatch = (dispatchSetState.bind(
    null,
    currentlyRenderingFiber,
    queue,
  ): any));

  return [hook.memoizedState, dispatch];
}
</code></pre></div><p>queueçš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>const queue = (hook.queue = {
  pending: null, // ä¿å­˜update å¯¹è±¡
  dispatch: null, // ä¿å­˜dispatchAction.bind()çš„å€¼
  lastRenderedReducer: reducer, // ä¸Šä¸€æ¬¡renderæ—¶ä½¿ç”¨çš„ruducer
  lastRenderedState: (initialState: any)
})
</code></pre></div><p>useReducerçš„lastRenderedReducerä¸ºä¼ å…¥çš„reducerå‚æ•°ã€‚
useStateçš„lastRenderedReducerä¸ºbasicStateReducer</p> <div class="language- extra-class"><pre class="language-text"><code>function basicStateReducer&lt;S&gt;(state: S, action: BasicStateAction&lt;S&gt;): S
  return typeof action === 'function' ? action(state) : action;
</code></pre></div><p>useStateçš„reducerå‚æ•°ä¸ºbasicStateReducerçš„useReducer</p> <h4 id="ä¸¤ç§æ›´æ–°æ–¹å¼"><a href="#ä¸¤ç§æ›´æ–°æ–¹å¼" class="header-anchor">#</a> ä¸¤ç§æ›´æ–°æ–¹å¼</h4> <p>æ ¹æ®action ç±»å‹æ¥åŒºåˆ†æ˜¯ç›´æ¥æ›´æ–°è¿˜æ˜¯å‡½æ•°å¼æ›´æ–°ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>// ç›´æ¥æ›´æ–°
// é€‚ç”¨äºä¸è¿”å›çš„æ–°å€¼ä¸æ—§å€¼ä¸å­˜åœ¨ä¾èµ–å…³ç³»
useCount(newState)

//å‡½æ•°å¼æ›´æ–°ã€‚
// preStateæ€»èƒ½æ‹¿åˆ°ä¸Šä¸€æ¬¡æ›´æ–°æˆåŠŸä¹‹åçš„æœ€æ–°çŠ¶æ€
// å¦‚æœæ­£å¸¸ä½¿ç”¨ï¼Œè¿™ä¸¤ç§æ–¹å¼æ²¡å•¥åŒºåˆ«ï¼Œä½†æ˜¯å¦‚æœæ˜¯å¼‚æ­¥æ›´æ–°çš„è¯ï¼Œä»–ä»¬ä¹‹é—´çš„å·®åˆ«å°±ä¼šä½“ç°å‡ºæ¥äº†.
// è¿™æ˜¯å› ä¸ºä½¿ç”¨å‡½æ•°æ›´æ–°çš„æ—¶å€™ï¼ŒuseCountå‡½æ•°å°†ä¼šè¢«æ”¾åœ¨ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œæ¯ä¸€ä¸ªuseCountå‡½æ•°éƒ½å¯ä»¥æ‹¿åˆ°ä¸Šä¸€æ¬¡æ›´æ–°æˆåŠŸåçŠ¶æ€å€¼ã€‚
useCount((preState)=&gt;{return nextState})

</code></pre></div><h4 id="usestate-ä¸-setstate-åŒºåˆ«"><a href="#usestate-ä¸-setstate-åŒºåˆ«" class="header-anchor">#</a> useState ä¸ setState åŒºåˆ«</h4> <ul><li>å‚æ•°ä¸åŒ</li></ul> <div class="language- extra-class"><pre class="language-text"><code>setState(updater,[,callback])
updater:(object/function) -ç”¨äºæ›´æ–°æ•°æ®ã€‚
callbackï¼šfunction-ç”¨äºè·å–æ›´æ–°åçš„stateçš„å€¼ã€‚

useState(initState)
const [state,setState] =useState(initState)
state ä»£è¡¨çŠ¶æ€ï¼Œ
setState()
initStateæ˜¯åˆå§‹çŠ¶æ€å€¼ã€‚
</code></pre></div><ul><li>setStateä¼šè‡ªåŠ¨æµ…åˆå¹¶ï¼Œè€ŒuseStateä¸ä¼šã€‚</li></ul> <div class="language- extra-class"><pre class="language-text"><code>this.setState({  age:10; }) =&gt; this.setState({  ...this.state })
</code></pre></div><h4 id="updatereducer"><a href="#updatereducer" class="header-anchor">#</a> updateReducer</h4> <p>åœ¨updateæ—¶ï¼ŒuseStateä¸useReducerè°ƒç”¨çš„æ˜¯åŒä¸€ä¸ªå‡½æ•°updateReducer</p> <div class="language- extra-class"><pre class="language-text"><code>function updateReducer&lt;S, I, A&gt; (
  reducer: (S, A) =&gt; S,
  initialArg: I,
  init?: I =&gt; S
): [S, Dispatch&lt;A&gt;]{
  // è·å–å½“å‰hook
  const hook = updateWorkInProgressHook();

  const queue = hook.queue;

  queue.lastRenderedReducer = reducer;

  const current: Hook = (currentHook: any);
  let baseQueue = current.baseQueue;
  const pendingQueue = queue.pending;

  // åŒupdateä¸updateQueue ç±»ä¼¼çš„æ›´æ–°é€»è¾‘
  if (pendingQueue !== null) {
    if (baseQueue !== null) {
      // åˆå¹¶å¾…å¤„ç†é˜Ÿåˆ—å’ŒåŸºæœ¬é˜Ÿåˆ—ã€‚
      const baseFirst = baseQueue.next;
      const pendingFirst = pendingQueue.next;
      baseQueue.next = pendingFirst;
      pendingQueue.next = baseFirst;
    }
    current.baseQueue = baseQueue = pendingQueue;
    queue.pending = null;
  }
  // ...


  const dispatch: Dispatch&lt;A&gt; = (queue.dispatch: any);
  return [hook.memoizedState, dispatch];
}
</code></pre></div><p>æµç¨‹æ¦‚æ‹¬ä¸ºï¼š
æ‰¾åˆ°å¯¹åº”çš„hook,æ ¹æ®updateè®¡ç®—è¯¥hookçš„state å¹¶è¿”å›</p> <p>mountä¸update è·å–å½“å‰hookæ–¹å¼ä¸ä¸€æ ·ï¼ŒmountWorkInProgressHook/updateWorkInProgressHook</p> <ol><li>mountæ˜¯è°ƒç”¨ReactDOm.renderæˆ–åˆå§‹åŒ–APIäº§ç”Ÿçš„æ›´æ–°ï¼Œåªä¼šæ‰§è¡Œä¸€æ¬¡</li> <li>updateè§¦å‘æ›´æ–°è¡Œä¸ºæœ‰å¤šç§ï¼Œå¯èƒ½æ˜¯åœ¨äº‹ä»¶å›è°ƒæˆ–è€…å‰¯ä½œç”¨è§¦å‘ï¼Œåˆæˆ–è€…æ˜¯renderé˜¶æ®µè§¦å‘çš„æ›´æ–°ï¼Œä¸ºäº†é¿å…ç»„ä»¶æ— é™å¾ªç¯æ›´æ–°ï¼Œéœ€è¦åŒºåˆ«å¯¹å¾…</li></ol> <p>render
å‡è®¾è°ƒç”¨setValueè§¦å‘æ›´æ–°ï¼Œä¸åšé™åˆ¶ï¼Œè¿™æ¬¡æ›´è¡Œä¼šå¼€å¯ä¸€æ¬¡æ–°çš„renderé˜¶æ®µï¼Œå¯¼è‡´æ— é™å¾ªç¯ã€‚
æ‰€ä»¥react ç”¨æ ‡è®°å˜é‡ didScheduleRenderPhaseUpdate åˆ¤æ–­æ˜¯å¦æ˜¯renderé˜¶æ®µè§¦å‘çš„æ›´æ–°ã€‚</p> <h4 id="è°ƒç”¨é˜¶æ®µ"><a href="#è°ƒç”¨é˜¶æ®µ" class="header-anchor">#</a> è°ƒç”¨é˜¶æ®µ</h4> <p>è°ƒç”¨é˜¶æ®µä¼šæ‰§è¡ŒdispatchActionï¼Œ
æ•´ä¸ªè¿‡ç¨‹ï¼šåˆ›å»ºupdateï¼Œå°†updateåŠ å…¥queue.pendingä¸­å›½ï¼Œå¹¶å¼€å¯è°ƒåº¦</p> <div class="language- extra-class"><pre class="language-text"><code>function dispatchAction(fiber, queue, action) {
  
  // ... åˆ›å»ºupdate
  var update = {
    eventTime: eventTime,
    lane: lane,
    suspenseConfig: suspenseConfig,
    action: action,
    eagerReducer: null,
    eagerState: null,
    next: null
  }

  // ... å°†updateåŠ å…¥queue.pending

  var alternate = fiber.alternate;

  if(fiber === currentlyRenderingFiber$1 || alternate !== null &amp;&amp; alternate === currentlyRenderingFiber$1) {
    // renderé˜¶æ®µè§¦å‘çš„æ›´æ–°
    didScheduleRenderPhaseUpdateDuringThisPass = didScheduleRenderPhaseUpdate = true;
  } else {
    if (fiber.lanes === NOLanes &amp;&amp; (alternate === null || alternate.lanes === NoLanes)) {
      // ...fiberçš„updateQueueä¸ºç©ºï¼Œ ä¼˜åŒ–è·¯å¾„
    }
    sscheduleUpdateOnFiber(fiber, lane, eventTime);
  }
}
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>if(fiber === currentlyRenderingFiber$1 || alternate !== null &amp;&amp; alternate === currentlyRenderingFiber$1) {
</code></pre></div><p>currentlyRenderingFiber å³ workInProgressï¼Œ workInProgress ä»£è¡¨å½“å‰å¤„äºrenderé˜¶æ®µ
è§¦å‘æ›´æ–°æ—¶é€šè¿‡bindé¢„å…ˆä¿å­˜çš„fiberä¸workInProgresså…¨ç­‰ï¼Œä»£è¡¨æœ¬æ¬¡æ›´æ–°å‘ç”ŸäºFunctionComponent å¯¹åº”fiber çš„renderé˜¶æ®µã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>if (fiber.lanes === NOLanes &amp;&amp; (alternate === null || alternate.lanes === NoLanes)) {
</code></pre></div><p>fiber.lanes ä¿å­˜fiberä¸Šå­˜åœ¨çš„updateä¼˜å…ˆçº§
fiber.lanes === NOLanes ä»£è¡¨ä¸å­˜åœ¨update</p> <p>useStateæ•´ä½“æµç¨‹ï¼š</p> <p><img src="/images/react/useState%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B.png" alt=""></p> <h3 id="_09-useeffect"><a href="#_09-useeffect" class="header-anchor">#</a> 09. useEffect</h3> <p>åœ¨Reactä¸­ç±»ä¼¼åƒcomponentDidMountè¿™æ ·çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­ï¼Œå› ä¸ºå¯èƒ½ä¼šæ‰§è¡ŒsetStateè¿™æ ·çš„æ–¹æ³•è€Œäº§ç”Ÿæ–°çš„æ›´æ–°ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºside effectå³å‰¯ä½œç”¨ã€‚</p> <p>æœ¬èº«FunctionComponentå› ä¸ºæ˜¯pure functionï¼Œæ‰€ä»¥ä¸ä¼šäº§ç”Ÿä»»ä½•çš„å‰¯ä½œç”¨ï¼Œè€ŒuseEffectå’ŒuseLayoutEffectæ˜¯å¸¦ç»™FunctionComponentäº§ç”Ÿå‰¯ä½œç”¨èƒ½åŠ›çš„Hooksï¼Œä»–ä»¬çš„è¡Œä¸ºéå¸¸ç±»ä¼¼componentDidMountå’ŒcomponentDidUpdate</p> <p>ä»–ä»¬æ¥å—ä¸€ä¸ªæ–¹æ³•ä½œä¸ºå‚æ•°ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“å®Œæˆä¹‹åè¢«è°ƒç”¨ï¼›å…¶æ¬¡è¿˜æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„é‡Œçš„æ¯ä¸€ä¸ªå†…å®¹éƒ½ä¼šè¢«ç”¨æ¥è¿›è¡Œæ¸²æŸ“å‰åçš„å¯¹æ¯”ï¼Œå¦‚æœæ²¡æœ‰å˜åŒ–ï¼Œåˆ™ä¸ä¼šè°ƒç”¨è¯¥å‰¯ä½œç”¨ã€‚</p> <h4 id="useeffect-æ‰§è¡Œé¡ºåº"><a href="#useeffect-æ‰§è¡Œé¡ºåº" class="header-anchor">#</a> useEffect æ‰§è¡Œé¡ºåº</h4> <p>React ä¸­ effect hook çš„å®šä¹‰</p> <div class="language- extra-class"><pre class="language-text"><code>useEffect(didUpdate);
useEffect(didUpdate, dependencies);
</code></pre></div><ul><li><p>ç”¨é€”ï¼šeffect hook ç”¨äºå®Œæˆå‰¯ä½œç”¨æ“ä½œ</p></li> <li><p>å‚æ•°ï¼š</p> <ul><li>didUpdate å‚æ•°æ¥æ”¶ä¸€ä¸ªåŒ…å«å‘½ä»¤å¼ã€ä¸”å¯èƒ½æœ‰å‰¯ä½œç”¨ä»£ç çš„å‡½æ•°ã€‚</li> <li>dependencies å‚æ•°æ¥æ”¶ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ è¡¨ç¤º effect æ‰€ä¾èµ–çš„å€¼ã€‚</li></ul></li> <li><p>æ‰§è¡Œæ—¶æœºï¼š</p> <ul><li>é»˜è®¤æƒ…å†µï¼šdidUpdate ä¼šåœ¨æ¯è½®ç»„ä»¶æ¸²æŸ“å®Œæˆåæ‰§è¡Œã€‚</li> <li>æ¡ä»¶æ‰§è¡Œï¼šå½“ä¼ å…¥ dependencies å‚æ•°æ—¶ï¼ŒdidUpdate ä»…åœ¨ä¾èµ–å€¼å‘ç”Ÿå˜åŒ–æ—¶æ‰§è¡Œ</li></ul></li> <li><p>æ¸…é™¤ï¼š</p> <ul><li>didUpdate å‡½æ•°å¯ä»¥è¿”å›ä¸€ä¸ªæ¸…é™¤å‡½æ•°ä»¥æ¸…é™¤å‰¯ä½œç”¨æ“ä½œï¼ˆå¦‚å–æ¶ˆè®¢é˜…ã€æ¸…é™¤å®šæ—¶å™¨ç­‰ï¼‰ã€‚å¦‚æœç»„ä»¶å¤šæ¬¡æ¸²æŸ“ï¼Œåˆ™ä¸Šä¸€ä¸ª effect ä¼šåœ¨ä¸‹ä¸€ä¸ª effect æ‰§è¡Œä¹‹å‰è¢«æ¸…é™¤ã€‚</li></ul></li></ul> <p>ä¸åŒç»„ä»¶ä¹‹é—´æ‰§è¡Œé¡ºè®¯å¦‚ä¸‹ï¼š</p> <ul><li>ç»„ä»¶æ¸²æŸ“åï¼Œæ‰§è¡Œeffectçš„é¡ºåºï¼Œç»„ä»¶æ ‘çš„<code>ååº</code>æ·±åº¦ä¼˜å…ˆéå†ã€‚</li> <li>ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œæ¸…é™¤ effect çš„é¡ºåºï¼šç»„ä»¶æ ‘çš„<code>ååº</code>æ·±åº¦ä¼˜å…ˆéå†ã€‚</li> <li>ç»„ä»¶unmountæ—¶ï¼Œæ¸…é™¤effectçš„é¡ºåºï¼Œç»„ä»¶æ ‘çš„<code>å‰åº</code>æ·±åº¦ä¼˜é€‰éå†ã€‚</li></ul> <h4 id="flushpassiveeffectsimpl"><a href="#flushpassiveeffectsimpl" class="header-anchor">#</a> flushPassiveEffectsImpl</h4> <p>flushPassiveEffects: è§¦å‘useEffectå›è°ƒä¸å…¶ä»–åŒæ­¥ä»»åŠ¡ã€‚å†…éƒ¨ä¼šè®¾ç½®ä¼˜å…ˆçº§ï¼Œå¹¶æ‰§è¡ŒflushPassiveEffectsImpl</p> <p>flushPassiveEffectImplä¸»è¦åšä¸‰ä»¶äº‹</p> <ul><li>è°ƒç”¨è¯¥useEffectåœ¨ä¸Šä¸€æ¬¡renderæ—¶çš„é”€æ¯å‡½æ•°</li> <li>è°ƒç”¨è¯¥useEffectåœ¨æœ¬æ¬¡renderæ—¶çš„å›è°ƒå‡½æ•°</li> <li>å¦‚æœå­˜åœ¨åŒæ­¥ä»»åŠ¡ï¼Œä¸éœ€è¦ç­‰å¾…ä¸‹æ¬¡äº‹ä»¶å¾ªç¯çš„å®ä»»åŠ¡ï¼Œæå‰æ‰§è¡Œ</li></ul> <h4 id="é˜¶æ®µä¸€"><a href="#é˜¶æ®µä¸€" class="header-anchor">#</a> é˜¶æ®µä¸€</h4> <p>useEffectçš„æ‰§è¡Œéœ€è¦ä¿è¯æ‰€æœ‰ç»„ä»¶useEffectçš„é”€æ¯å‡½æ•°å¿…é¡»éƒ½æ‰§è¡Œå®Œç§°æ‰èƒ½æ‰§è¡Œä»»æ„ä¸€ä¸ªç»„ä»¶çš„useEffectçš„å›è°ƒå‡½æ•°ã€‚ï¼ˆå› ä¸ºå¤šä¸ªç»„ä»¶å¯èƒ½å…±ç”¨ä¸€ä¸ªrefï¼‰</p> <p>å¦‚æœä¸æ˜¯æŒ‰ç…§ å…¨éƒ¨é”€æ¯ å† å…¨éƒ¨æ‰§è¡Œ çš„é¡ºåºï¼Œé‚£ä¹ˆåœ¨æŸä¸ªç»„ä»¶useEffectçš„é”€æ¯å‡½æ•°ä¸­ä¿®æ”¹çš„ref.currentå¯èƒ½å½±å“å¦å¤–ä¸€ä¸ªç»„ä»¶useEffectçš„å›è°ƒå‡½æ•°ä¸­çš„åŒä¸€ä¸ªrefçš„currentå±æ€§ã€‚</p> <p>åœ¨é˜¶æ®µä¸€ä¼šéå†å¹¶æ‰§è¡Œæ‰€æœ‰useEffectçš„é”€æ¯å‡½æ•°,pendingPassiveHookEffectsUnmountä¸­ä¿å­˜äº†æ‰€æœ‰éœ€è¦æ‰§è¡Œé”€æ¯çš„useEffect</p> <div class="language- extra-class"><pre class="language-text"><code>const unmountEffects = pendingPassiveHookEffectsUnmount;
pendingPassiveHookEffectsUnmount = [];

// pendingPassiveHookEffectsUnmountæ•°ç»„ç´¢å¼•ã€iã€‘ä¿å­˜éœ€è¦é”€æ¯çš„effectï¼Œi+1ä¿å­˜è¯¥effectå¯¹åº”çš„fiber
for (let i = 0; i &lt; unmountEffects; i +=2) {
  const effect = ((unmountEffects[i]: any) : HookEffect);
  const fiber = ((unmountEffects[i+1]: any): Fiber);

  const destory = effect.destory;
  effect.destory = undefined;
  
  if (typeof destory === 'function') {
     // é”€æ¯å‡½æ•°å­˜åœ¨åˆ™æ‰§è¡Œ
    try {
     destory();
    } catch {
      captureCommitPhaseError(fiber, error);
    }
  }
}

</code></pre></div><p>pendingPassiveHookEffectsUnmount push effectåœ¨layouté˜¶æ®µcommitLayoutEffectOnFiberå†…çš„ schedulePassiveEffectsæ–¹æ³•</p> <div class="language- extra-class"><pre class="language-text"><code>function schedulePassiveEffects(finishedWork: Fiber) {
  const updateQueue: FunctionComponentUpdateQueue | null = (finishedWork.updateQueue: any);
  const lastEffect = updateQueue !== null ? updateQueue.lastEffect : null;
  if (lastEffect !== null) {
    const firstEffect = lastEffect.next;
    let effect = firstEffect;
    do {
      const {next, tag} = effect;
      if (
        (tag &amp; HookPassive) !== NoHookEffect &amp;&amp;
        (tag &amp; HookHasEffect) !== NoHookEffect
      ) {
        // å‘`pendingPassiveHookEffectsUnmount`æ•°ç»„å†…`push`è¦é”€æ¯çš„effect
        enqueuePendingPassiveHookEffectUnmount(finishedWork, effect);
        // å‘`pendingPassiveHookEffectsMount`æ•°ç»„å†…`push`è¦æ‰§è¡Œå›è°ƒçš„effect
        enqueuePendingPassiveHookEffectMount(finishedWork, effect);
      }
      effect = next;
    } while (effect !== firstEffect);
  }
}
</code></pre></div><h4 id="é˜¶æ®µäºŒ"><a href="#é˜¶æ®µäºŒ" class="header-anchor">#</a> é˜¶æ®µäºŒ</h4> <p>ä¸é˜¶æ®µä¸€ç±»ä¼¼ï¼ŒåŒæ ·æ—¶éå†æ•°ç»„ï¼Œæ‰§è¡Œå¯¹åº”effectçš„å›è°ƒå‡½æ•°ï¼ŒenqueuePendingPassiveHookEffectMount åŒæ ·ä¹Ÿåœ¨scheduPassiveEffectsä¸­ï¼Œ
enqueuePassiveHookEffectsMount ä¿å­˜äº†æ‰€æœ‰éœ€è¦æ‰§è¡Œå›è°ƒçš„useEffect</p> <div class="language- extra-class"><pre class="language-text"><code>const mountEffects = pendingPassiveHookEffectsMount;
pendingPassiveHookEffectsMount = [];
for (let i = 0; i &lt; mountEffects.length; i += 2) {
  const effect = ((mountEffects[i]: any): HookEffect);
  const fiber = ((mountEffects[i + 1]: any): Fiber);
  
  try {
    const create = effect.create;
    effect.destroy = create();
  } catch (error) {
    captureCommitPhaseError(fiber, error);
  }
}
</code></pre></div><h3 id="_10-useref"><a href="#_10-useref" class="header-anchor">#</a> 10. useRef</h3> <p>ä½œç”¨ï¼š</p> <ul><li>ä½œç”¨äºDomå…ƒç´ </li> <li>è·å–å­ç»„ä»¶çš„å®ä¾‹(åªæœ‰ç±»ç»„ä»¶å¯ç”¨)</li> <li>åœ¨å‡½æ•°ç»„ä»¶ä¸­çš„ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œä¸ä¼šå› ä¸ºé‡å¤ render é‡å¤ç”³æ˜ï¼Œ ç±»ä¼¼äºç±»ç»„ä»¶çš„ this.xxx</li></ul> <p>åœ¨mount/ update å¯¹åº”ä¸¤ä¸ªä¸åŒçš„dispatcher</p> <div class="language- extra-class"><pre class="language-text"><code>function mountRef&lt;T&gt;(initialValue: T): {| current: T|}{
  // è·å–å½“å‰useRef hook
  cosnt hook = mountWorkInProgress();
  // åˆ›å»ºref
  const ref = { current: initialValue};
  hook.memoizedState = ref;

  return ref;
}

function updateRef&lt;T&gt;(initialValue: T): {|current: T|} {
  // è·å–å½“å‰useRef hook
  const hook = updateWorkInProgress();
  // è¿”å›ä¿å­˜çš„æ•°æ®
  return hook.memoizedState;
}
</code></pre></div><p>createRefå®ç°ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>function createRef(): RefObject {
  const refObject = {
    current: null
  };
  return refObject;
}
</code></pre></div><p>functionComponent hooks ç”Ÿå‘½å‘¨æœŸï¼š</p> <p><img src="/images/react/functionComponent%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.png" alt=""></p> <h4 id="useref-ä¸createref-åŒºåˆ«"><a href="#useref-ä¸createref-åŒºåˆ«" class="header-anchor">#</a> useRef ä¸createRef åŒºåˆ«</h4> <ul><li>createRef ä»…èƒ½ç”¨åœ¨classComponentï¼ŒuseRefä»…èƒ½ç”¨åœ¨FunctionComponent</li> <li>createRef æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å¼•ç”¨ï¼Œè€Œ useRef æ¯æ¬¡éƒ½ä¼šè¿”å›ç›¸åŒçš„å¼•ç”¨ã€‚
createRefçš„å€¼ä¼šéšç€ <code>FunctionComponent</code> é‡å¤æ‰§è¡Œè€Œä¸æ–­è¢«åˆå§‹åŒ–
é”™è¯¯ç¤ºä¾‹ï¼šæ°¸è¿œä¹Ÿæ‹¿ä¸åˆ° ref</li></ul> <div class="language- extra-class"><pre class="language-text"><code>function App() {
  const valueRef = React.createRef(); //éšç€App render é‡å¤åˆå§‹åŒ–
  return &lt;div ref={valueRef} /&gt;;
}
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>const Text = () =&gt; {
    const [renderIndex, setRenderIndex] = useState(0);
    const refFromUseRef = useRef();
    const refFromCreateRef = createRef();
    if (!refFromUseRef.current) {
        refFromUseRef.current = renderIndex;
    }
    if (!refFromCreateRef.current) {
        refFromCreateRef.current = renderIndex;
    }
    return &lt;div&gt;
        &lt;p&gt;renderIndex: {renderIndex}&lt;/p&gt;
        &lt;p&gt;
            &lt;b&gt;
                refFromUseRef: {refFromUseRef.current}
            &lt;/b&gt;
            &lt;b&gt;
                refFromCreateRef: {refFromCreateRef.current}
            &lt;/b&gt;
        &lt;/p&gt;
        &lt;p&gt;
            &lt;button onClick={() =&gt; setRenderIndex(prevIndex =&gt; prevIndex+1)}&gt;ç‚¹å‡»&lt;/button&gt;
        &lt;/p&gt;
    &lt;/div&gt;;
};
</code></pre></div><h4 id="userefä¸å…¨å±€å˜é‡çš„åŒºåˆ«"><a href="#userefä¸å…¨å±€å˜é‡çš„åŒºåˆ«" class="header-anchor">#</a> useRefä¸å…¨å±€å˜é‡çš„åŒºåˆ«</h4> <p>åœ¨ç»„ä»¶å¤–éƒ¨å£°æ˜å’Œä½¿ç”¨'let'å˜é‡ä¸ä¼šè§¦å‘re-renderingç»„ä»¶ï¼Œä¸ä½¿ç”¨useRefç›¸åŒï¼Œåè€…ä¹Ÿä¸ä¼šè§¦å‘re-renderingï¼Œé‚£äºŒè€…æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</p> <ul><li>useRef æ˜¯å®šä¹‰åœ¨å®ä¾‹åŸºç¡€ä¸Šçš„ï¼Œå¦‚æœä»£ç ä¸­æœ‰å¤šä¸ªç›¸åŒçš„ç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶çš„ ref åªè·Ÿç»„ä»¶æœ¬èº«æœ‰å…³ï¼Œè·Ÿå…¶ä»–ç»„ä»¶çš„ ref æ²¡æœ‰å…³ç³»ã€‚</li> <li>ç»„ä»¶å‰å®šä¹‰çš„ global å˜é‡ï¼Œæ˜¯å±äºå…¨å±€çš„ã€‚å¦‚æœä»£ç ä¸­æœ‰å¤šä¸ªç›¸åŒçš„ç»„ä»¶ï¼Œé‚£è¿™ä¸ª global å˜é‡åœ¨å…¨å±€æ˜¯åŒä¸€ä¸ªï¼Œä»–ä»¬ä¼šäº’ç›¸å½±å“ã€‚</li></ul> <h4 id="refçš„å·¥ä½œæµç¨‹"><a href="#refçš„å·¥ä½œæµç¨‹" class="header-anchor">#</a> refçš„å·¥ä½œæµç¨‹</h4> <p>HostComponentï¼ŒclassComponentï¼ŒforwardRef èµ‹å€¼refå±æ€§</p> <ul><li>HostComponent</li></ul> <div class="language- extra-class"><pre class="language-text"><code>&lt;div ref={domRef}&gt;&lt;/div&gt;
</code></pre></div><ul><li>classComponent/forwardRef</li></ul> <div class="language- extra-class"><pre class="language-text"><code>&lt;App ref={cnRef}/&gt;
</code></pre></div><p>å…¶ä¸­forwardRef å°†refä½œä¸ºç¬¬äºŒå‚æ•°è¿›è¡Œä¼ é€’ï¼Œä¸ä¼šè¿›å…¥refçš„å·¥ä½œæµç¨‹ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>// secondArg ä¸ºä¼ é€’ä¸‹å»çš„ref
let children = Component(props, secondArg)
</code></pre></div><p>refçš„æ›´æ–°åœ¨mutationé˜¶æ®µã€‚ mutationæ‰§è¡ŒDOMçš„ä¾æ®æ˜¯effectTagï¼Œ
æ‰€ä»¥Refæ›´æ–°ä¹Ÿä¼šèµ‹å€¼å¯¹åº”çš„effectTag</p> <p>refçš„å·¥ä½œæµç¨‹åˆ†ä¸ºä¸¤æ­¥</p> <ul><li>renderé˜¶æ®µä¸ºå«æœ‰refå±æ€§çš„fiber æ·»åŠ Ref effectTag</li> <li>commit é˜¶æ®µä¸ºåŒ…å«Ref effectTagçš„fiberæ‰§è¡Œå¯¹åº”çš„æ›´æ–°</li></ul> <h4 id="é˜¶æ®µä¸€-2"><a href="#é˜¶æ®µä¸€-2" class="header-anchor">#</a> é˜¶æ®µä¸€</h4> <p>åœ¨renderé˜¶æ®µ beginWorkä¸completeWorkä¸­  markRefæ–¹æ³•ä¸ºå«æœ‰refå±æ€§çš„fiberå¢åŠ Ref effectTag</p> <div class="language- extra-class"><pre class="language-text"><code>// beginWorkçš„markRef
function markRef(current: Fiber | null, workInProgress: Fiber) {
  const ref = workInProgress.ref;
  if (
    (current === null &amp;&amp; ref !== null) ||
    (current !== null &amp;&amp; current.ref !== ref)
  ) {
    // Schedule a Ref effect
    workInProgress.effectTag |= Ref;
  }
}
// completeWorkçš„markRef
function markRef(workInProgress: Fiber) {
  workInProgress.effectTag |= Ref;
}
</code></pre></div><p>ç»„ä»¶å¯¹åº”fiberè¢«èµ‹å€¼Ref effectTagéœ€è¦æ»¡è¶³çš„æ¡ä»¶ï¼š</p> <ul><li>mountæ—¶ï¼ŒworkInProgress.ref !== nullï¼Œå³å­˜åœ¨refå±æ€§</li> <li>updateæ—¶ï¼Œcurrent.ref !== ref refå±æ€§æ”¹å˜</li></ul> <h4 id="é˜¶æ®µäºŒ-2"><a href="#é˜¶æ®µäºŒ-2" class="header-anchor">#</a> é˜¶æ®µäºŒ</h4> <ul><li>é’ˆå¯¹å±æ€§æ”¹å˜çš„ï¼Œéœ€è¦å…ˆç§»é™¤ä¹‹å‰çš„ref</li></ul> <div class="language- extra-class"><pre class="language-text"><code>function commitMutationEffects(root: FiberRoot, renderPriorityLevel) {
  while (nextEffect !== null) {
    const effectTag = nextEffect.effectTag;
    if (effectTag &amp; Ref) {
      const current = nextEffect.alternate;
      if (current !== null) {
        // ç§»é™¤ä¹‹å‰çš„ref
        commitDetachRef(current);
      }
    }
  }
}

function commitDetachRef(current: Fiber) {
  const currentRef = current.ref;
  if (currentRef!== null) {
    if (typeof currentRef === 'function') {
      currentRef(null);
    } else {
      currentRef.current = null;
    }
  }

}
</code></pre></div><ul><li>ref èµ‹å€¼ï¼ˆcommitLayoutEffect æ‰§è¡Œ commitAttachRefï¼‰</li></ul> <div class="language- extra-class"><pre class="language-text"><code>function commitAttachRef(finishedWork: Fiber) {
   const ref = finishedWork.ref;
   if (ref !== null) {
    // è·å–refå±æ€§å¯¹åº”çš„Componentå®ä¾‹
    const instance = finishedWork.stateNode;
    let instanceToUse;
    switch (finishedWork.tag) {
      case HostComponent:
        instanceToUse = getPublicInstance(instance);
        break;
      default:
        instanceToUse = instance;
    }
    // èµ‹å€¼ref
    if (typeof ref === 'function') {
      ref(instanceToUse);
    } else {
      ref.current = instanceToUse;
    }
  }
}
</code></pre></div><h3 id="_11-usecallback-usememo"><a href="#_11-usecallback-usememo" class="header-anchor">#</a> 11. useCallback/useMemo</h3> <div class="language- extra-class"><pre class="language-text"><code>const memoizedCallback = useCallback(() =&gt; {
  do(depA, depB)
}, [depA, depB])
// è¿”å›ä¸€ä¸ª memoized å›è°ƒå‡½æ•° ã€‚
const memoizedValue = useMemo(() =&gt; {
  computeValue(depA, depB)
}, [depA, depV])
// è¿”å›ä¸€ä¸ª memoized å€¼ ã€‚

useCallback(fn, deps) ç±»ä¼¼äº useMemeo(()=&gt; fn,deps)
</code></pre></div><h4 id="mount"><a href="#mount" class="header-anchor">#</a> mount</h4> <div class="language- extra-class"><pre class="language-text"><code>function mountMemo&lt;T&gt; (
  nextCreate: () =&gt; T,
  deps: Array&lt;mixed&gt; | void | null
) : T {
  // åˆ›å»ºå¹¶è¿”å›å½“å‰hook
  const hook = mountWorkInProgress();
  const nextDeps = deps === undefined ? null : deps;

  // è®¡ç®—value
  const nextValue = nextCreate();

  // å°†valueä¸depsä¿å­˜åœ¨hook.memeoized
  hook.memoizedState = [nextValue, nextDeps];

  return nextValue;
}

function mountCallback&lt;T&gt;(callback: T, deps: Array&lt;mixed&gt; | void | null) : T {
  // åˆ›å»ºå¹¶è¿”å›hook
  const hook = mountWorkInProgress();
  const nextDeps = deps === undefined ? null : deps;

  // å°†valueä¸depsä¿å­˜åœ¨hook.memoizedStateä¸­
  hook.memoizedState = [callback,deps];
  return callback
}
</code></pre></div><h4 id="update"><a href="#update" class="header-anchor">#</a> update</h4> <div class="language- extra-class"><pre class="language-text"><code>function updateMemo&lt;T&gt; (
  nextCreate: () =&gt; T,
  deps: Array&lt;mixed&gt; | void | null
){
  // è¿”å›å½“å‰çš„hook
  const hook = updateWorkInProgress();
  const nextDeps = deps === undefined ? null : deps;
  const prevState = hook.memoizedState;

  if (prevState !== null) {
    if (nextDeps !== null) {
      const prevDeps: Array&lt;mixed&gt; | null = prevState[1];
      // åˆ¤æ–­updateå‰åvalueæ˜¯å¦å˜åŒ–
      if(areHookInputsEquql(nextDeps. prevDeps)) {
         // æœªå˜åŒ–
        return prevState[0];
      }
    }
  }
  // å˜åŒ–ã€‚ éœ€è¦é‡æ–°è®¡ç®—
  const nextValue = nextCreate();
  hook.memoizedState = [nextValue, nextDeps];
  return nextValue;
}

function updateCallback&lt;T&gt;(callback: T, deps: Array&lt;mixed&gt; | void | null): T {
  // è¿”å›å½“å‰hook
  const hook = updateWorkInProgressHook();
  const nextDeps = deps === undefined ? null : deps;
  const prevState = hook.memoizedState;

  if (prevState !== null) {
    if (nextDeps !== null) {
      const prevDeps: Array&lt;mixed&gt; | null = prevState[1];
      // åˆ¤æ–­updateå‰åvalueæ˜¯å¦å˜åŒ–
      if (areHookInputsEqual(nextDeps, prevDeps)) {
        // æœªå˜åŒ–
        return prevState[0];
      }
    }
  }

  // å˜åŒ–ï¼Œå°†æ–°çš„callbackä½œä¸ºvalue
  hook.memoizedState = [callback, nextDeps];
  return callback;
}
</code></pre></div><p>äºŒè€…åŒºåˆ«valueæ˜¯å›è°ƒå‡½æ•°æœ¬èº«è¿˜æ˜¯å›è°ƒå‡½æ•°çš„æ‰§è¡Œç»“æœã€‚</p></div></div> <!----> <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=react" title="æ ‡ç­¾">#react</a></div> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/1ac33a/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">react çŠ¶æ€æ›´æ–°</div></a> <a href="/pages/f67937/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Concurrent Mode</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/pages/1ac33a/" class="prev">react çŠ¶æ€æ›´æ–°</a></span> <span class="next"><a href="/pages/f67937/">Concurrent Mode</a>â†’
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">æœ€è¿‘æ›´æ–°</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/aiAgent/bacis/"><div>
            AgentåŸºç¡€
            <!----></div></a> <span class="date">01-13</span></dt></dl><dl><dd>02</dd> <dt><a href="/harmonyOS/state/"><div>
            ç»„ä»¶é€šä¿¡æ–¹å¼
            <!----></div></a> <span class="date">01-07</span></dt></dl><dl><dd>03</dd> <dt><a href="/harmonyOS/UIAbility/"><div>
            UIAbility
            <!----></div></a> <span class="date">01-07</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">æ›´å¤šæ–‡ç« &gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1730129114@qq.com" title="å‘é‚®ä»¶" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/wshuhua" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/my/m/music/playlist?id=7141103351" title="å¬éŸ³ä¹" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜">Vdoing</a> 
    | Copyright Â© 2022-2026
    <span>Wsh  | <a href="https://github.com/wshuhua" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7428c7eb.js" defer></script><script src="/assets/js/2.dc8a2400.js" defer></script><script src="/assets/js/61.9dbd8f8f.js" defer></script>
  </body>
</html>
